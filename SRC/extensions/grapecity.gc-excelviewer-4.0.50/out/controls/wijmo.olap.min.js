/*!
    *
    * Wijmo Library 5.20201.664
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var wijmo,__extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();!function(e){!function(e){"use strict";var t=function(){function _TextBuilder(){this._text=""}Object.defineProperty(_TextBuilder.prototype,"length",{get:function(){return this._text.length},enumerable:!0,configurable:!0});_TextBuilder.prototype.toString=function(){return this._text};_TextBuilder.prototype.append=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this._text=(e=this._text).concat.apply(e,t)};_TextBuilder.prototype.joinToList=function(e){for(var t,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var o=i.join();this.length>0&&o.length>0?this._text=(t=this._text).concat.apply(t,[e].concat(i)):o.length>0&&(this._text=o)};_TextBuilder.prototype.joinItemToList=function(e){this.joinToList(",",e)};_TextBuilder.prototype.wrap=function(e,t){this.length>0&&(this._text=e.concat(this._text,t))};_TextBuilder.wrap=function(e,t,i){return t.length>0?e.concat(t,i):""};return _TextBuilder}();e._TextBuilder=t}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(){function _Tally(){this._cntAll=0;this._cnt=0;this._cntn=0;this._sum=0;this._sum2=0;this._min=null;this._max=null;this._first=null;this._last=null}_Tally.prototype.add=function(t,i){if(t instanceof _Tally){this._sum+=t._sum;this._sum2+=t._sum2;this._max=this._max&&t._max?Math.max(this._max,t._max):this._max||t._max;this._min=this._min&&t._min?Math.min(this._min,t._min):this._min||t._min;this._cnt+=t._cnt;this._cntn+=t._cntn;this._cntAll+=t._cntAll}else{this._cntAll++;if(null!=t){this._cnt++;e.isBoolean(t)&&(t=t?1:0);(null==this._min||t<this._min)&&(this._min=t);(null==this._max||t>this._max)&&(this._max=t);null==this._first&&(this._first=t);this._last=t;if(e.isNumber(t)&&!isNaN(t)){e.isNumber(i)&&(t*=i);this._cntn++;this._sum+=t;this._sum2+=t*t}}}};_Tally.prototype.getAggregate=function(t){if(0==this._cnt)return null;var i=0==this._cntn?0:this._sum/this._cntn,n=e.Aggregate;switch(t){case n.None:return null;case n.CntAll:return this._cntAll;case n.Avg:return i;case n.Cnt:return this._cnt;case n.Max:return this._max;case n.Min:return this._min;case n.Rng:return this._max-this._min;case n.Sum:return this._sum;case n.VarPop:return this._cntn<=1?0:this._sum2/this._cntn-i*i;case n.StdPop:return this._cntn<=1?0:Math.sqrt(this._sum2/this._cntn-i*i);case n.Var:return this._cntn<=1?0:(this._sum2/this._cntn-i*i)*this._cntn/(this._cntn-1);case n.Std:return this._cntn<=1?0:Math.sqrt((this._sum2/this._cntn-i*i)*this._cntn/(this._cntn-1));case n.First:return this._first;case n.Last:return this._last}throw"Invalid aggregate type."};return _Tally}();t._Tally=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(){function _PivotKey(e,t,i,n,o){this._fields=e;this._fieldCount=t;this._valueFields=i;this._valueFieldIndex=n;this._item=o}Object.defineProperty(_PivotKey.prototype,"fields",{get:function(){return this._fields},enumerable:!0,configurable:!0});Object.defineProperty(_PivotKey.prototype,"valueFields",{get:function(){return this._valueFields},enumerable:!0,configurable:!0});Object.defineProperty(_PivotKey.prototype,"valueField",{get:function(){return this._valueFields[this._valueFieldIndex]},enumerable:!0,configurable:!0});Object.defineProperty(_PivotKey.prototype,"values",{get:function(){if(null==this._vals){this._vals=new Array(this._fieldCount);for(var e=0;e<this._fieldCount;e++){var t=this._fields[e];this._vals[e]=t._getValue(this._item,!1)}}return this._vals},enumerable:!0,configurable:!0});Object.defineProperty(_PivotKey.prototype,"fieldNames",{get:function(){if(!this._names){this._names=[];for(var e=0;e<this.fields.length;e++){var t=this._fields[e];this._names.push(t._getName())}}return this._names},enumerable:!0,configurable:!0});Object.defineProperty(_PivotKey.prototype,"aggregate",{get:function(){var t=this._valueFields,i=this._valueFieldIndex;e.assert(t&&i>-1&&i<t.length,"aggregate not available for this key");return t[i].aggregate},enumerable:!0,configurable:!0});_PivotKey.prototype.getValue=function(t,i){if(0==this.values.length)return e.culture.olap.PivotEngine.grandTotal;if(t>this.values.length-1)return e.culture.olap.PivotEngine.subTotal;var n=this.values[t];if(i&&!e.isString(n)){var o=this.fields[t],r=o?o.format:"";n=e.Globalize.format(this.values[t],r)}return n};Object.defineProperty(_PivotKey.prototype,"level",{get:function(){return this._fieldCount==this._fields.length?-1:this._fieldCount},enumerable:!0,configurable:!0});_PivotKey.prototype.compareTo=function(t){var i=0;if(null!=t&&t._fields==this._fields){for(var n=this.values,o=t.values,r=Math.min(n.length,o.length),s=0;s<r;s++){var l=null!=n[s]?e.getType(n[s]):null,a=n[s],d=o[s],u=this._fields[s];if(u.sortComparer){i=u.sortComparer(a,d);if(e.isNumber(i)){if(0!=i)return u.descending?-i:i;continue}}if(l==e.DataType.Date){var h=u.format;if(h&&"d"!=h&&"D"!=h){var c=u._getValue(this._item,!0),p=u._getValue(t._item,!0),g=e.Globalize.parseDate(c,h),_=e.Globalize.parseDate(p,h);if(g&&_){a=g;d=_}else{a=c;d=p}}}if(!(a==d||e.DateTime.equals(a,d))){if(null==a)return 1;if(null==d)return-1;i=a<d?-1:1;return u.descending?-i:i}}if(n.length==o.length&&0!=(i=this._valueFieldIndex-t._valueFieldIndex))return i;if(0!=(i=o.length-n.length))return i*(this.fields.engine.totalsBeforeData?-1:1)}return 0};_PivotKey.prototype.matchesItem=function(e){for(var t=0;t<this._vals.length;t++){if(this.getValue(t,!0)!=this._fields[t]._getValue(e,!0))return!1}return!0};_PivotKey.prototype.toString=function(e){if(!this._key||e){for(var t="",i=0;i<this._fieldCount;i++){var n=this._fields[i];t+=n._getName()+":"+n._getValue(this._item,!0)+";"}if(this._valueFields){t+=this._valueFields[this._valueFieldIndex]._getName()+":0;"}else t+="{total}";if(e)return t+e.toString();this._key=t}return this._key};_PivotKey._ROW_KEY_NAME="$rowKey";return _PivotKey}();t._PivotKey=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(i){__extends(PivotCollectionView,i);function PivotCollectionView(n){var o=i.call(this)||this;o.canAddNew=o.canRemove=!1;o._ng=e.asType(n,t.PivotEngine,!1);return o}Object.defineProperty(PivotCollectionView.prototype,"engine",{get:function(){return this._ng},enumerable:!0,configurable:!0});PivotCollectionView.prototype._performSort=function(e){var i=this._ng;if(i.sortableGroups&&i._getShowRowTotals()==t.ShowTotals.Subtotals){var n=0,o=e.length-1;0==this._getItemLevel(e[n])&&n++;0==this._getItemLevel(e[o])&&o--;this._sortGroups(e,1,n,o)}else this._sortData(e)};PivotCollectionView.prototype._performFilter=function(e){return this._ng&&0==this._ng.valueFields.length&&0==this._ng.rowFields.length?[]:this.canFilter&&this._filter?e.filter(this._filter,this):e};PivotCollectionView.prototype._getGroupRange=function(e,t){var i=this._ng,n=e.indexOf(t),o=n,r=this._getItemLevel(e[n]);if(i.totalsBeforeData)for(o=n;o<e.length-1;o++){if((s=this._getItemLevel(e[o+1]))>-1&&s<=r)break}else for(n=o;n;n--){var s;if((s=this._getItemLevel(e[n-1]))>-1&&s<=r)break}return[n,o]};PivotCollectionView.prototype._sortGroups=function(e,t,n,o){for(var r=[],s=n;s<=o;s++)this._getItemLevel(e[s])==t&&r.push(e[s]);if(r.length){i.prototype._performSort.call(this,r);var l=[];for(s=0;s<r.length;s++){for(var a=this._getGroupRange(e,r[s]),d=l.length,u=a[0];u<=a[1];u++)l.push(e[u]);t<this._ng.rowFields.length-1?this._sortGroups(l,t+1,n+d,l.length-1):this._sortSegment(l,n+d,l.length-1)}for(s=0;s<l.length;s++)e[n+s]=l[s]}else this._sortData(e)};PivotCollectionView.prototype._sortSegment=function(e,t,n){var o=e.slice(t,n);i.prototype._performSort.call(this,o);for(var r=0;r<o.length;r++)e[t+r]=o[r]};PivotCollectionView.prototype._sortData=function(e){for(var t=0;t<e.length;t++)if(!(this._getItemLevel(e[t])>-1)){for(var n=t;n<e.length-1&&!(this._getItemLevel(e[n+1])>-1);n++);if(n>t){var o=e.slice(t,n+1);i.prototype._performSort.call(this,o);for(var r=0;r<o.length;r++)e[t+r]=o[r]}t=n}};PivotCollectionView.prototype._getItemLevel=function(e){return e[t._PivotKey._ROW_KEY_NAME].level};return PivotCollectionView}(e.collections.CollectionView);t.PivotCollectionView=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(){function PivotField(i,n,o,r){this.propertyChanged=new e.Event;this._ng=i;this._binding=new e.Binding(n);this._header=o||e.toHeaderCase(n);this._aggregate=e.Aggregate.Sum;this._showAs=t.ShowAs.NoCalculation;this._isContentHtml=!1;this._visible=!0;this._format="";this._filter=new t.PivotFilter(this);this._updateDataType();r&&e.copy(this,r)}Object.defineProperty(PivotField.prototype,"binding",{get:function(){return this._binding?this._binding.path:null},set:function(t){if(t!=this.binding){var i=this.binding,n=e.asString(t);this._binding=n?new e.Binding(n):null;this._updateDataType();var o=new e.PropertyChangedEventArgs("binding",i,t);this.onPropertyChanged(o)}},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"getValue",{get:function(){return this._getValueFn},set:function(t){this._getValueFn=e.asFunction(t,!0)},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"header",{get:function(){return this._header},set:function(t){t=e.asString(t,!1);var i=this._ng.fields.getField(t);!t||i&&i!=this?e.assert(!1,"field headers must be unique and non-empty."):this._setProp("_header",e.asString(t))},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"aggregate",{get:function(){return this._aggregate},set:function(t){this._setProp("_aggregate",e.asEnum(t,e.Aggregate))},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"showAs",{get:function(){return this._showAs},set:function(i){this._setProp("_showAs",e.asEnum(i,t.ShowAs))},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"weightField",{get:function(){return this._weightField},set:function(t){this._setProp("_weightField",e.asType(t,PivotField,!0))},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"dataType",{get:function(){return this._dataType},set:function(t){this._setProp("_dataType",e.asEnum(t,e.DataType))},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"isMeasure",{get:function(){return this._dataType==e.DataType.Number},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"subFields",{get:function(){return this._subFields},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"format",{get:function(){return this._format},set:function(t){this._setProp("_format",e.asString(t))},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"align",{get:function(){return this._align},set:function(t){this._setProp("_align",e.asString(t))},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"width",{get:function(){return this._width},set:function(t){this._setProp("_width",e.asNumber(t,!0,!0))},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._setProp("_wordWrap",e.asBoolean(t))},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"descending",{get:function(){return!!this._descending},set:function(t){this._setProp("_descending",e.asBoolean(t))},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"isContentHtml",{get:function(){return this._isContentHtml},set:function(t){this._setProp("_isContentHtml",e.asBoolean(t))},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"visible",{get:function(){return this._visible},set:function(t){this._setProp("_visible",e.asBoolean(t))},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"sortComparer",{get:function(){return this._srtCmp},set:function(t){t!=this.sortComparer&&(this._srtCmp=e.asFunction(t))},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"engine",{get:function(){return this._ng},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"collectionView",{get:function(){return this.engine?this.engine.collectionView:null},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"isActive",{get:function(){return this._getIsActive()},set:function(e){this._setIsActive(e)},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"parentField",{get:function(){return this._parent},enumerable:!0,configurable:!0});Object.defineProperty(PivotField.prototype,"key",{get:function(){return this.header},enumerable:!0,configurable:!0});PivotField.prototype.onPropertyChanged=function(e){this.propertyChanged.raise(this,e);this._ng._fieldPropertyChanged(this,e)};PivotField.prototype._updateDataType=function(){if(!this._dataType&&this._ng&&this._binding){var t=this._ng.collectionView;if(t&&t.sourceCollection&&t.sourceCollection.length){var i=t.sourceCollection[0];this._dataType=e.getType(this._binding.getValue(i))}}};PivotField.prototype._copy=function(e,t){var i=this;if("subFields"==e){this._subFields?this._subFields.splice(0,this._subFields.length):this._subFields=[];t&&t.length&&t.forEach((function(e){var t=i.engine._createField(e,i._autoGenerated);i._subFields.push(t)}));return!0}return!1};PivotField.prototype._getIsActive=function(){if(this._ng&&!this._hasSubFields())for(var e=this._ng._viewLists,t=0;t<e.length;t++)if(e[t].indexOf(this)>-1)return!0;return!1};PivotField.prototype._setIsActive=function(t){if(this._ng&&!this._hasSubFields()){var i=this.isActive;if((t=e.asBoolean(t))!=i)if(t)this.isMeasure?this._ng.valueFields.push(this):this._ng.rowFields.push(this);else{for(var n=this._ng._viewLists,o=0;o<n.length;o++)for(var r=n[o],s=0;s<r.length;s++){if((a=r[s])==this||a.parentField==this){r.removeAt(s);s--}}var l=this._ng.fields;for(s=l.length-1;s>=0;s--){var a;if((a=l[s]).parentField==this){l.removeAt(s);s--}}}}};PivotField.prototype._hasSubFields=function(){return null!=this._subFields&&this._subFields.length>0};PivotField.prototype._clone=function(){var e=new PivotField(this._ng,this.binding);this._ng._copyProps(e,this,PivotField._props);e._autoGenerated=!0;e._parent=this;for(var t=this.header.replace(/\d+$/,""),i=2;;i++){var n=t+i.toString();if(null==this._ng.fields.getField(n)){e._header=n;break}}return e};PivotField.prototype._setProp=function(t,i,n){var o=this[t];if(i!=o){this[t]=i;var r=new e.PropertyChangedEventArgs(t.substr(1),o,i);this.onPropertyChanged(r)}};PivotField.prototype._getName=function(){return this.header||this.binding};PivotField.prototype._getValue=function(t,i){var n,o=this._binding;n=e.isFunction(this._getValueFn)?this._getValueFn.call(this,t):this._ng.isServer?t[this.key]:o._key?t[o._key]:o.getValue(t);return i&&"string"!=typeof n?e.Globalize.format(n,this._format):n};PivotField.prototype._getWeight=function(t){var i=this._weightField?this._weightField._getValue(t,!1):null;return e.isNumber(i)?i:null};PivotField._props=["dataType","format","width","wordWrap","aggregate","showAs","descending","isContentHtml","visible"];return PivotField}();t.PivotField=i;var n,o=function(t){__extends(CubePivotField,t);function CubePivotField(i,n,o,r){var s=t.call(this,i,n,o,r)||this;e.assert(null!=s.dimensionType,"CubePivotField objects must specify the field's dimensionType");return s}Object.defineProperty(CubePivotField.prototype,"header",{get:function(){return this._header},set:function(t){this._setProp("_header",e.asString(t))},enumerable:!0,configurable:!0});Object.defineProperty(CubePivotField.prototype,"dimensionType",{get:function(){return this._dimensionType},set:function(t){this._setProp("_dimensionType",e.asEnum(t,n,!1))},enumerable:!0,configurable:!0});Object.defineProperty(CubePivotField.prototype,"isMeasure",{get:function(){switch(this._dimensionType){case 1:case 8:return!0}return!1},enumerable:!0,configurable:!0});Object.defineProperty(CubePivotField.prototype,"key",{get:function(){return this.binding},enumerable:!0,configurable:!0});CubePivotField.prototype._clone=function(){throw"CubePivotField objects cannot be cloned"};return CubePivotField}(i);t.CubePivotField=o;!function(e){e[e.Dimension=0]="Dimension";e[e.Measure=1]="Measure";e[e.Kpi=2]="Kpi";e[e.NameSet=3]="NameSet";e[e.Attribute=4]="Attribute";e[e.Folder=5]="Folder";e[e.Hierarchy=6]="Hierarchy";e[e.Date=7]="Date";e[e.Currency=8]="Currency"}(n=t.DimensionType||(t.DimensionType={}))}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(i){__extends(Slicer,i);function Slicer(t,n){var o=i.call(this,t,null,e.isIE()&&!e.isEdge())||this;o._mSel=!1;o._updatingFilter=!1;o._propChanged=!1;o._fldPropChangeBnd=o._fldPropChange.bind(o);var r=o.getTemplate();o.applyTemplate("wj-slicer wj-nocheck wj-control wj-content",r,{_root:"root",_divHdr:"div-hdr",_divHdrText:"div-hdr-text",_btnMSel:"btn-msel",_btnClear:"btn-clear"});var s=e.culture.olap.Slicer,l=new e.Tooltip;e.setAttribute(o._btnMSel,"aria-label",s.multiSelect);e.setAttribute(o._btnClear,"aria-label",s.clearFilter);l.setTooltip(o._btnMSel,s.multiSelect);l.setTooltip(o._btnClear,s.clearFilter);o.addEventListener(o._btnClear,"click",(function(e){o._clear()}));o.addEventListener(o._btnMSel,"click",(function(e){o.multiSelect=!o.multiSelect}));o.initialize(n);return o}Object.defineProperty(Slicer.prototype,"field",{get:function(){return this._fld},set:function(i){var n=this;if(i!=this._fld){if(this._divListBox){e.removeChild(this._divListBox);this._divListBox=null;this._lbx.dispose();this._lbx=null}if(this._edt){this._clear();this._edt.dispose()}var o=this._fld;if(o){o.filter.filterType=this._originalFilterType;o.filter.valueFilter.uniqueValues=this._uniqueValues;o.propertyChanged.removeHandler(this._fldPropChangeBnd)}if(o=this._fld=e.asType(i,t.PivotField,!0)){this._originalFilterType=o.filter.filterType;o.filter.filterType=e.grid.filter.FilterType.Value;var r=o.engine;this._uniqueValues=o.filter.valueFilter.uniqueValues;if(r.isServer&&!this._uniqueValues){var s=r._getUniqueValues(o);o.filter.valueFilter.uniqueValues=s}o.propertyChanged.addHandler(this._fldPropChangeBnd);o.isActive||o.engine.filterFields.push(o);var l=document.createElement("div");this._edt=new e.grid.filter.ValueFilterEditor(l,o.filter.valueFilter)}if(this._edt){this._divListBox=this._edt.hostElement.querySelector(".wj-listbox");this._root.appendChild(this._divListBox);this._lbx=e.Control.getControl(this._divListBox);this._lbx.checkedItemsChanged.addHandler((function(e,t){if(!n._propChanged){var i=n._lbx.selectedItem;if(!n.multiSelect&&i){n._mSel=!0;n._lbx.checkedItems=[i];n._mSel=!1}}if(n._edt&&o){n._updateFilter();o.engine.invalidate()}}))}this._updateHeader();e.isIE()&&!e.isEdge()&&this.refresh()}},enumerable:!0,configurable:!0});Object.defineProperty(Slicer.prototype,"header",{get:function(){return this._hdr},set:function(t){if(t!=this._hdr){this._hdr=e.asString(t);this._updateHeader()}},enumerable:!0,configurable:!0});Object.defineProperty(Slicer.prototype,"showHeader",{get:function(){return"none"!=this._divHdr.style.display},set:function(t){this._divHdr.style.display=e.asBoolean(t)?"":"none"},enumerable:!0,configurable:!0});Object.defineProperty(Slicer.prototype,"showCheckboxes",{get:function(){return!e.hasClass(this.hostElement,"wj-nocheck")},set:function(t){e.toggleClass(this.hostElement,"wj-nocheck",!e.asBoolean(t))},enumerable:!0,configurable:!0});Object.defineProperty(Slicer.prototype,"multiSelect",{get:function(){return this._mSel},set:function(t){this._mSel=e.asBoolean(t);e.toggleClass(this._btnMSel,"wj-state-active",this._mSel)},enumerable:!0,configurable:!0});Slicer.prototype.refresh=function(t){var n=this;void 0===t&&(t=!0);e.isIE()&&!e.isEdge()&&this.hostElement&&setTimeout((function(){e.setCss(n._lbx.hostElement,{height:n.hostElement.clientHeight-n._divHdr.offsetHeight})}));i.prototype.refresh.call(this,t)};Slicer.prototype._fldPropChange=function(e,t){this._propChanged=!0;switch(t.propertyName){case"header":this._updateHeader();break;case"format":case"binding":e.filter.clear();this._edt.updateEditor();break;case"filter":this._updatingFilter||this._edt.updateEditor()}this._propChanged=!1};Slicer.prototype._updateHeader=function(){var e=this._hdr;e||null==this._fld||(e=this._fld.header);this._divHdrText.textContent=e};Slicer.prototype._clear=function(){if(this._edt){this._edt.clearEditor(!1);this._updateFilter();this._fld.engine.invalidate()}};Slicer.prototype._updateFilter=function(){this._updatingFilter=!0;this._edt.updateFilter();this._updatingFilter=!1};Slicer.controlTemplate='<div wj-part="root"><div wj-part="div-hdr" class="wj-header"><div wj-part="div-hdr-text"></div><button wj-part="btn-msel" class="wj-btn btn-msel" tabindex="-1"><span class="wj-glyph">&#8801;</span></button><button wj-part="btn-clear" class="wj-btn btn-clear" tabindex="-1"><span class="wj-glyph">&times;</span></button></div></div>';return Slicer}(e.Control);t.Slicer=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(i){__extends(_GridContextMenu,i);function _GridContextMenu(){var t=i.call(this,document.createElement("div"),{header:"PivotGrid Context Menu",displayMemberPath:"text",commandParameterPath:"parm",command:{executeCommand:function(e){t._execute(e)},canExecuteCommand:function(e){return t._canExecute(e)}}})||this;t.itemsSource=t._getMenuItems();e.addClass(t.dropDown,"context-menu wj-olap-context-menu");return t}_GridContextMenu.prototype.refresh=function(e){void 0===e&&(e=!0);this.itemsSource=this._getMenuItems();i.prototype.refresh.call(this,e)};_GridContextMenu.prototype.attach=function(i){var n=this;e.assert(i instanceof t.PivotGrid,"Expecting a PivotGrid control...");var o=i.hostElement;o.addEventListener("contextmenu",(function(t){if(i.customContextMenu){t.preventDefault();n.owner=o;if(n._selectField(t)){var r=n.dropDown;n.selectedIndex=-1;if(n.onIsDroppedDownChanging(new e.CancelEventArgs)){e.showPopup(r,t);n.onIsDroppedDownChanged();r.focus()}}}}))};_GridContextMenu.prototype._selectField=function(t){this._targetField=null;this._htDown=null;var i=e.Control.getControl(this.owner),n=i.engine,o=n.valueFields,r=n.columnFields,s=n.rowFields,l=i.hitTest(t),a=e.grid.CellType;switch(l.cellType){case a.Cell:i.select(l.range);this._targetField=o[l.col%o.length];this._htDown=l;break;case a.ColumnHeader:this._targetField=l.row<r.length?r[l.row]:o[l.col%o.length];break;case a.RowHeader:this._targetField=s[l.col];break;case a.TopLeft:l.row==l.panel.rows.length-1&&(this._targetField=s[l.col])}return null!=this._targetField};_GridContextMenu.prototype._getMenuItems=function(){for(var t=[{text:'<div class="menu-icon menu-icon-remove">&#10006;</div>Remove Field',parm:"remove"},{text:'<div class="menu-icon">&#9965;</div>Field Settings...',parm:"edit"},{text:'<div class="wj-separator"></div>'},{text:'<div class="menu-icon">&#8981;</div>Show Detail...',parm:"detail"}],i=0;i<t.length;i++){var n=t[i];if(n.parm){var o=e.culture.olap._ListContextMenu[n.parm];e.assert(o,"missing localized text for item "+n.parm);n.text=n.text.replace(/([^>]+$)/,o)}}return t};_GridContextMenu.prototype._execute=function(t){var i=e.Control.getControl(this.owner),n=this._targetField,o=this._htDown;switch(t){case"remove":i.engine.removeField(n);break;case"edit":i.engine.editField(n);break;case"detail":i.showDetail(o.row,o.col)}};_GridContextMenu.prototype._canExecute=function(i){var n=this._targetField,o=e.Control.getControl(this.owner),r=o?o.engine:null;switch(i){case"remove":return null!=n;case"edit":return null!=n&&r&&r.allowFieldEditing;case"detail":return null!=this._htDown&&r.valueFields.length&&null!=n&&!(n instanceof t.CubePivotField)}return!0};return _GridContextMenu}(e.input.Menu);t._GridContextMenu=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(i){__extends(PivotFieldCollection,i);function PivotFieldCollection(e){var t=i.call(this)||this;t._ng=e;return t}Object.defineProperty(PivotFieldCollection.prototype,"maxItems",{get:function(){return this._maxItems},set:function(t){this._maxItems=e.asInt(t,!0,!0)},enumerable:!0,configurable:!0});Object.defineProperty(PivotFieldCollection.prototype,"engine",{get:function(){return this._ng},enumerable:!0,configurable:!0});PivotFieldCollection.prototype.getField=function(e){return this._getField(this,e)};PivotFieldCollection.prototype._getField=function(e,t){for(var i=0;i<e.length;i++){var n=e[i];if(n.key==t)return n;if(n._hasSubFields()&&(n=this._getField(n.subFields,t)))return n}return null};PivotFieldCollection.prototype.push=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];for(var r=this._ng,s=0;n&&s<n.length;s++){var l=n[s];e.isString(l)&&(l=this==r.fields?new t.PivotField(r,l):r.fields.getField(l));e.assert(l instanceof t.PivotField,"This collection must contain PivotField objects only.");if(l.key&&this.getField(l.key)){e.assert(!1,"PivotField keys must be unique.");return-1}if(null!=this._maxItems&&this.length>=this._maxItems)break;i.prototype.push.call(this,l)}return this.length};return PivotFieldCollection}(e.collections.ObservableArray);t.PivotFieldCollection=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(e){"use strict";var t=function(){function _PivotNode(t,i,n,o,r,s){this._key=new e._PivotKey(t,i,n,o,r);this._nodes={};this._parent=s}_PivotNode.prototype.getNode=function(e,t,i,n,o){for(var r=this,s=0;s<t;s++){var l=e[s]._getValue(o,!0);if(!(a=r._nodes[l])){a=new _PivotNode(e,s+1,i,n,o,r);r._nodes[l]=a}r=a}if(i&&n>-1){var a;l=i[n].header;if(!(a=r._nodes[l])){a=new _PivotNode(e,t,i,n,o,r);r._nodes[l]=a}r=a}return r};Object.defineProperty(_PivotNode.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0});Object.defineProperty(_PivotNode.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0});Object.defineProperty(_PivotNode.prototype,"tree",{get:function(){this._tree||(this._tree=new _PivotNode(null,0,null,-1,null));return this._tree},enumerable:!0,configurable:!0});return _PivotNode}();e._PivotNode=t}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(){function _ServerConnection(i,n){this._ng=e.asType(i,t.PivotEngine);e.assert(this._isValidUrl(n),"Invalid service Url: "+n+")")}_ServerConnection.prototype.getFields=function(){var t=this,i=null;e.httpRequest(this._getUrl("Fields"),{async:!1,success:function(t){i=JSON.parse(t.responseText);e.isArray(i)||console.error("Failed to get fields from server: "+t.responseText)},error:function(e){t._handleError("Getting Fields",e)}});return i};_ServerConnection.prototype.getUniqueValues=function(t){var i=this,n=null;e.httpRequest(this._getUrl("UniqueValues",null,t.header),{method:"POST",async:!1,data:{view:this._ng.viewDefinition},success:function(t){n=JSON.parse(t.responseText);e.isArray(n)||console.error("Failed to get unique field values from server: "+t.responseText)},error:function(e){i._handleError("Getting Unique Field Values",e)}});return n};_ServerConnection.prototype.getOutputView=function(e){var t=this;this.clearPendingRequests();this._sendHttpRequest("Analyses",{method:"POST",data:{view:this._ng.viewDefinition},success:function(i){var n=JSON.parse(i.responseText);t._token=n.token;t._start=Date.now();t._handleResult(n.status,e)},error:function(e){t._handleError("Analyses",e)}})};_ServerConnection.prototype.getDetail=function(t,i){for(var n,o=[],r=this._ng.rowFields.length,s=t?t.values.length:0,l=0;l<r;l++)l<s?o.push(_ServerConnection._getRequestedValue(t.values[l])):o.push(null);r=this._ng.columnFields.length;s=i?i.values.length:0;for(l=0;l<r;l++)l<s?o.push(_ServerConnection._getRequestedValue(i.values[l])):o.push(null);n=new e.collections.ObservableArray;this._loadArray("Detail",n,{method:"POST",view:this._ng.viewDefinition,keys:o,max:this._ng.serverMaxDetail});return n};_ServerConnection._getRequestedValue=function(t){if(e.isDate(t)){var i=t;return new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()))}return t};_ServerConnection.prototype.clearPendingRequests=function(){this._clearRequest();this._clearTimeout();this._clearToken()};_ServerConnection.prototype.updateTallies=function(e){var i=this,o=this._ng,r=o.rowFields.length,s=o.columnFields.length,l=o.valueFields.length,a=new t._PivotNode(o.rowFields,0,null,-1,null);e.forEach((function(e,t,d){var u=i._getAggregatedFieldCount(e,o.rowFields),h=a.getNode(o.rowFields,r-u,null,-1,e),c=h.key,p=c.toString(null),g=o._tallies[p];if(!g){o._keys[p]=c;o._tallies[p]=g={}}u=i._getAggregatedFieldCount(e,o.columnFields);for(var _=0;_<l;_++){var f=h.tree.getNode(o.columnFields,s-u,o.valueFields,_,e).key,v=f.toString(),y=o.valueFields[_],m=g[v];if(!m){o._keys[v]=f;(m=g[v]=new n).add(i._getFieldValue(y,e,!1))}}}))};_ServerConnection.prototype._getFieldValue=function(t,i,n){var o=i[t.key];return n&&"string"!=typeof o?e.Globalize.format(o,t.format):o};_ServerConnection.prototype._getAggregatedFieldCount=function(e,t){for(var i=t.length,n=0,o=0;o<i;o++){var r=t[o];null==this._getFieldValue(r,e,!1)&&n++}return n};_ServerConnection.prototype._loadArray=function(t,i,n){var o=this;n||(n={});null==n.skip&&(n.skip=0);null==n.top&&(n.top=100);var r=e.isNumber(n.max)?n.max:1e6;this._request=e.httpRequest(this._getUrl(t),{data:n,method:n.method||"GET",success:function(e){var s=JSON.parse(e.responseText);i.deferUpdate((function(){s.value.forEach((function(e){i.push(e)}))}));if(s.value.length==n.top&&i.length<r){n.skip+=n.top;o._loadArray(t,i,n)}},error:function(e){o._handleError(t,e)}})};_ServerConnection.prototype._getUrl=function(t,i,n){void 0===i&&(i=this._token);var o=this._ng.itemsSource.toString(),r=o.lastIndexOf("/");o.substr(0,r);switch(t=t.toLowerCase()){case"rawdata":case"detail":return o;case"fields":case"analyses":return o+"/"+t;case"clear":return o+"/analyses/"+i+"/";case"result":case"status":return o+"/analyses/"+i+"/"+t;case"uniquevalues":return o+"/fields/"+n+"/"+t}e.assert(!1,"Unrecognized command")};_ServerConnection.prototype._isValidUrl=function(t){var i=document.createElement("a");i.href=e.asString(t);i.href=i.href;return i.protocol&&i.hostname&&i.pathname&&"/"!=t[t.length-1]};_ServerConnection.prototype._handleResult=function(e,i){var n=this;switch(e.executingStatus.toLowerCase()){case"executing":case"notset":if(Date.now()-this._start>this._ng.serverTimeout){this._handleError("Analyses",{status:500,statusText:"Analysis timed out"});return}this._progress=e.progress;this._ng.onUpdatingView(new t.ProgressEventArgs(this._progress));this._clearTimeout();this._toGetStatus=setTimeout((function(){n._waitUntilComplete(i)}),this._ng.serverPollInterval);break;case"completed":this._progress=100;this._ng.onUpdatingView(new t.ProgressEventArgs(this._progress));this._getResults(i);break;case"exception":this._getResults(i);break;default:this._handleError("Analyses",{status:500,statusText:"Unexpected result..."})}};_ServerConnection.prototype._waitUntilComplete=function(e){var t=this;this._sendHttpRequest("Status",{success:function(i){var n=JSON.parse(i.responseText);t._handleResult(n,e)},error:function(e){t._handleError("Status",e)}})};_ServerConnection.prototype._getResults=function(t){var i=this;this._sendHttpRequest("Result",{success:function(n){i._clearToken();var o=JSON.parse(n.responseText);e.assert(e.isArray(o),"Result array Expected.");var r=[];i._ng._viewLists.forEach((function(t){r=r.concat(t.filter((function(t){return t.dataType==e.DataType.Date})))}));r.length>0&&o.forEach((function(t){r.forEach((function(i){var n=i._binding,o=n.getValue(t);e.isString(o)&&n.setValue(t,new Date(o))}))}));e.asFunction(t)(o)},error:function(e){i._handleError("Result",e)}})};_ServerConnection.prototype._handleError=function(t,i){this.clearPendingRequests();t='** HttpRequest error on command "'+t+'"';this._ng.onError(new e.RequestErrorEventArgs(i,t))&&this._throwResponseError(t,i)};_ServerConnection.prototype._sendHttpRequest=function(t,i){var n=this._getUrl(t);this._request=e.httpRequest(n,i)};_ServerConnection.prototype._throwResponseError=function(e,t){e=e+"\r\n"+t.status+"\r\n";var i=t.responseText||"";if(500==t.status&&t.responseText){i=JSON.parse(t.responseText).ExceptionMessage}throw e+=i||t.statusText};_ServerConnection.prototype._clearToken=function(){if(this._token){this._clearRequest();this._clearTimeout();this._sendHttpRequest("Clear",{method:"DELETE"});this._token=null}};_ServerConnection.prototype._clearRequest=function(){if(this._request&&4!=this._request.readyState){this._request.abort();this._request=null}};_ServerConnection.prototype._clearTimeout=function(){if(this._toGetStatus){clearTimeout(this._toGetStatus);this._toGetStatus=null}};_ServerConnection._TIMEOUT=6e4;_ServerConnection._POLL_INTERVAL=500;_ServerConnection._MAXDETAIL=1e3;return _ServerConnection}();t._ServerConnection=i;var n=function(t){__extends(_ServerTally,t);function _ServerTally(){return null!==t&&t.apply(this,arguments)||this}_ServerTally.prototype.add=function(t,i){e.assert(0==this._cnt,"Server tallies have a single value.");this._aggregatedValue=t};_ServerTally.prototype.getAggregate=function(e){return this._aggregatedValue};return _ServerTally}(t._Tally)}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";e._addCultureInfo("olap",{PivotEngine:{grandTotal:"Grand Total",subTotal:"Subtotal"},PivotPanel:{fields:"Choose fields to add to report:",drag:"Drag fields between areas below:",filters:"Filters",cols:"Columns",rows:"Rows",vals:"Values",defer:"Defer Updates",update:"Update"},PivotFieldEditor:{dialogHeader:"Field settings:",header:"Header:",summary:"Summary:",showAs:"Show As:",weighBy:"Weigh by:",sort:"Sort:",filter:"Filter:",format:"Format:",sample:"Sample:",edit:"Edit...",clear:"Clear",ok:"OK",cancel:"Cancel",none:"(none)",sorts:{asc:"Ascending",desc:"Descending"},aggs:{sum:"Sum",cnt:"Count",avg:"Average",max:"Max",min:"Min",rng:"Range",std:"StdDev",var:"Var",stdp:"StdDevPop",varp:"VarPop",first:"First",last:"Last"},calcs:{noCalc:"No calculation",dRow:"Difference from previous row",dRowPct:"% Difference from previous row",dCol:"Difference from previous column",dColPct:"% Difference from previous column",dPctGrand:"% of grand total",dPctRow:"% of row total",dPrevRow:"% of value in the previous row",dPctCol:"% of column total",dPrevCol:"% of value in the previous column",dRunTot:"Running total",dRunTotPct:"% running total"},formats:{n0:"Integer (n0)",n2:"Float (n2)",c:"Currency (c)",p0:"Percentage (p0)",p2:"Percentage (p2)",n2c:"Thousands (n2,)",n2cc:"Millions (n2,,)",n2ccc:"Billions (n2,,,)",d:"Date (d)",MMMMddyyyy:"Month Day Year (MMMM dd, yyyy)",dMyy:"Day Month Year (d/M/yy)",ddMyy:"Day Month Year (dd/M/yy)",dMyyyy:"Day Month Year (dd/M/yyyy)",MMMyyyy:"Month Year (MMM yyyy)",MMMMyyyy:"Month Year (MMMM yyyy)",yyyy:"Year (yyyy)",yyyyQq:'Year Quarter (yyyy "Q"q)',FYEEEEQU:'Fiscal Year Quarter ("FY"EEEE "Q"U)'}},_ListContextMenu:{up:"Move Up",down:"Move Down",first:"Move to Beginning",last:"Move to End",filter:"Move to Report Filter",rows:"Move to Row Labels",cols:"Move to Column Labels",vals:"Move to Values",remove:"Remove Field",edit:"Field Settings...",detail:"Show Detail..."},DetailDialog:{header:"Detail View:",ok:"OK",items:"{cnt:n0} items",item:"{cnt} item",row:"Row",col:"Column"},PivotChart:{by:"by",and:"and"},Slicer:{multiSelect:"Multi-Select",clearFilter:"Clear Filter"}});var i,n;!function(e){e[e.None=0]="None";e[e.GrandTotals=1]="GrandTotals";e[e.Subtotals=2]="Subtotals"}(i=t.ShowTotals||(t.ShowTotals={}));!function(e){e[e.NoCalculation=0]="NoCalculation";e[e.DiffRow=1]="DiffRow";e[e.DiffRowPct=2]="DiffRowPct";e[e.DiffCol=3]="DiffCol";e[e.DiffColPct=4]="DiffColPct";e[e.PctGrand=5]="PctGrand";e[e.PctRow=6]="PctRow";e[e.PctCol=7]="PctCol";e[e.RunTot=8]="RunTot";e[e.RunTotPct=9]="RunTotPct";e[e.PctPrevRow=10]="PctPrevRow";e[e.PctPrevCol=11]="PctPrevCol"}(n=t.ShowAs||(t.ShowAs={}));var o=function(){function PivotEngine(n){this._autoGenFields=!0;this._allowFieldEditing=!0;this._showRowTotals=i.GrandTotals;this._showColTotals=i.GrandTotals;this._totalsBefore=!1;this._sortableGroups=!0;this._showZeros=!1;this._updating=0;this._cntTotal=0;this._cntFiltered=0;this._xValueSearch=!0;this._async=!0;this._serverParms={timeout:t._ServerConnection._TIMEOUT,pollInterval:t._ServerConnection._POLL_INTERVAL,maxDetail:t._ServerConnection._MAXDETAIL};this.itemsSourceChanged=new e.Event;this.viewDefinitionChanged=new e.Event;this.updatingView=new e.Event;this.updatedView=new e.Event;this.error=new e.Event;this._pivotView=new t.PivotCollectionView(this);this._fields=new t.PivotFieldCollection(this);this._rowFields=new t.PivotFieldCollection(this);this._columnFields=new t.PivotFieldCollection(this);this._valueFields=new t.PivotFieldCollection(this);this._filterFields=new t.PivotFieldCollection(this);this._viewLists=[this._rowFields,this._columnFields,this._valueFields,this._filterFields];var o=this._fieldListChanged.bind(this);this._fields.collectionChanged.addHandler(o);this._viewLists.forEach((function(e){e.collectionChanged.addHandler(o)}));this._defaultFilterType=null;n&&e.copy(this,n)}Object.defineProperty(PivotEngine.prototype,"itemsSource",{get:function(){return this._items},set:function(i){var n=this;if(this._items!=i){if(this._cv){this._cv.collectionChanged.removeHandler(this._cvCollectionChanged,this);this._cv=null}if(this._server){this._server.clearPendingRequests();this._server=null}this._items=i;e.isString(i)?this._server=new t._ServerConnection(this,i):e.isObject(i)&&!e.tryCast(i,"ICollectionView")?this._server=new t._SqlServerConnection(this,i):this._cv=e.asCollectionView(i);null!=this._cv&&this._cv.collectionChanged.addHandler(this._cvCollectionChanged,this);this.deferUpdate((function(){n.autoGenerateFields&&n._generateFields();n._updateFieldTypes()}));this.onItemsSourceChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"isServer",{get:function(){return null!=this._server},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"pivotView",{get:function(){return this._pivotView},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"showRowTotals",{get:function(){return this._showRowTotals},set:function(t){if((t=e.asEnum(t,i))!=this.showRowTotals){this._showRowTotals=t;this.onViewDefinitionChanged();this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"showColumnTotals",{get:function(){return this._showColTotals},set:function(t){if((t=e.asEnum(t,i))!=this.showColumnTotals){this._showColTotals=t;this.onViewDefinitionChanged();this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"totalsBeforeData",{get:function(){return this._totalsBefore},set:function(t){if(t!=this._totalsBefore){this._totalsBefore=e.asBoolean(t);this.onViewDefinitionChanged();this._updatePivotView()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"sortableGroups",{get:function(){return this._sortableGroups},set:function(t){if(t!=this._sortableGroups){this._sortableGroups=e.asBoolean(t);this.onViewDefinitionChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"sortOnServer",{get:function(){return this._sortOnServer},set:function(t){this._sortOnServer=e.asBoolean(t)},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"showZeros",{get:function(){return this._showZeros},set:function(t){if(t!=this._showZeros){this._showZeros=e.asBoolean(t);this.onViewDefinitionChanged();this._updatePivotView()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"defaultFilterType",{get:function(){return null!=this._defaultFilterType?this._defaultFilterType:this._server?e.grid.filter.FilterType.Condition:e.grid.filter.FilterType.Both},set:function(t){this._defaultFilterType=e.asEnum(t,e.grid.filter.FilterType)},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"exclusiveValueSearch",{get:function(){return this._xValueSearch},set:function(t){this._xValueSearch=e.asBoolean(t)},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"autoGenerateFields",{get:function(){return this._autoGenFields},set:function(t){this._autoGenFields=e.asBoolean(t)},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"allowFieldEditing",{get:function(){return this._allowFieldEditing},set:function(t){this._allowFieldEditing=e.asBoolean(t)},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"fields",{get:function(){return this._fields},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"rowFields",{get:function(){return this._rowFields},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"columnFields",{get:function(){return this._columnFields},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"filterFields",{get:function(){return this._filterFields},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"valueFields",{get:function(){return this._valueFields},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"viewDefinition",{get:function(){var e=this,t={showZeros:this.showZeros,showColumnTotals:this.showColumnTotals,showRowTotals:this.showRowTotals,defaultFilterType:this.defaultFilterType,totalsBeforeData:this.totalsBeforeData,sortableGroups:this.sortableGroups,fields:[],rowFields:this._getFieldCollectionProxy(this.rowFields),columnFields:this._getFieldCollectionProxy(this.columnFields),filterFields:this._getFieldCollectionProxy(this.filterFields),valueFields:this._getFieldCollectionProxy(this.valueFields)};this.fields.forEach((function(i){var n=e._getFieldDefinition(i);t.fields.push(n)}));return JSON.stringify(t)},set:function(t){var i=this,n=JSON.parse(t);n&&this.deferUpdate((function(){i._copyProps(i,n,PivotEngine._props);i.fields.clear();n.fields.forEach((function(e){var t=i._getFieldFromDefinition(e);i.fields.push(t)}));n.fields.forEach((function(t,n){e.isString(t.weightField)&&(i.fields[n].weightField=i.fields.getField(t.weightField))}));i._setFieldCollectionProxy(i.rowFields,n.rowFields);i._setFieldCollectionProxy(i.columnFields,n.columnFields);i._setFieldCollectionProxy(i.filterFields,n.filterFields);i._setFieldCollectionProxy(i.valueFields,n.valueFields)}))},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"isViewDefined",{get:function(){var e=this._valueFields.length,t=this._rowFields.length,i=this._columnFields.length;return this._server?e>0&&(t>0||i>0):e>0||t>0||i>0},enumerable:!0,configurable:!0});PivotEngine.prototype.beginUpdate=function(){this.cancelPendingUpdates();this._updating++};PivotEngine.prototype.endUpdate=function(){this._updating--;this._updating<=0&&this.refresh()};Object.defineProperty(PivotEngine.prototype,"isUpdating",{get:function(){return this._updating>0},enumerable:!0,configurable:!0});PivotEngine.prototype.deferUpdate=function(e){try{this.beginUpdate();e()}finally{this.endUpdate()}};PivotEngine.prototype.refresh=function(e){void 0===e&&(e=!1);this._updateView(e)};PivotEngine.prototype.invalidate=function(){var t=this;this._toInv&&(this._toInv=clearTimeout(this._toInv));this.isUpdating||(this._toInv=setTimeout((function(){t.refresh()}),e.Control._REFRESH_INTERVAL))};Object.defineProperty(PivotEngine.prototype,"async",{get:function(){return this._async},set:function(t){if(t!=this._async){this.cancelPendingUpdates();this._async=e.asBoolean(t)}},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"serverTimeout",{get:function(){return this._serverParms.timeout},set:function(t){this._serverParms.timeout=e.asNumber(t,!1,!0)},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"serverPollInterval",{get:function(){return this._serverParms.pollInterval},set:function(t){this._serverParms.pollInterval=e.asNumber(t,!1,!0)},enumerable:!0,configurable:!0});Object.defineProperty(PivotEngine.prototype,"serverMaxDetail",{get:function(){return this._serverParms.maxDetail},set:function(t){this._serverParms.maxDetail=e.asNumber(t,!1,!0)},enumerable:!0,configurable:!0});PivotEngine.prototype.cancelPendingUpdates=function(){if(this._toUpdateTallies){clearTimeout(this._toUpdateTallies);this._toUpdateTallies=null}};PivotEngine.prototype.getDetail=function(e,i){var n=this,o=e?e[t._PivotKey._ROW_KEY_NAME]:null,r=this._getKey(i);if(this._server)return this._server.getDetail(o,r);var s=this.collectionView.items,l=[];s.forEach((function(e){!n._applyFilter(e)||null!=o&&!o.matchesItem(e)||null!=r&&!r.matchesItem(e)||l.push(e)}));return l};PivotEngine.prototype.getDetailView=function(t,i){var n=this.getDetail(t,i);return new e.collections.CollectionView(n)};PivotEngine.prototype.getKeys=function(e,i){var n=e?e[t._PivotKey._ROW_KEY_NAME]:null,o=this._getKey(i);return{rowKey:{fields:n?n.fieldNames:[],values:n?n.values:[]},colKey:{fields:o?o.fieldNames:[],values:o?o.values:[]}}};PivotEngine.prototype.editField=function(i){if(this.allowFieldEditing){var n=new t.PivotFieldEditor(document.createElement("div"),{field:i});new e.input.Popup(document.createElement("div"),{content:n.hostElement}).show(!0)}};PivotEngine.prototype.removeField=function(e){for(var t=0;t<this._viewLists.length;t++){var i=this._viewLists[t],n=i.indexOf(e);if(n>-1){i.removeAt(n);return}}};PivotEngine.prototype.onItemsSourceChanged=function(e){this.itemsSourceChanged.raise(this,e)};PivotEngine.prototype.onViewDefinitionChanged=function(e){this.viewDefinitionChanged.raise(this,e)};PivotEngine.prototype.onUpdatingView=function(e){this.updatingView.raise(this,e)};PivotEngine.prototype.onUpdatedView=function(e){this.updatedView.raise(this,e)};PivotEngine.prototype.onError=function(e){this.error.raise(this,e);return!e.cancel};PivotEngine.prototype._copy=function(t,i){var n=this;switch(t){case"fields":this.fields.clear();this._viewLists.forEach((function(e){e.clear()}));e.asArray(i).forEach((function(e){var t=n._createField(e,!1);n.fields.push(t)}));this._updateFieldTypes();return!0;case"rowFields":case"columnFields":case"valueFields":case"filterFields":this[t].clear();if(!e.isArray(i)){this[t].maxItems=i.maxItems;i=i.items}e.asArray(i).forEach((function(e){var i=n.fields.getField(e);n[t].push(i)}));return!0}return!1};PivotEngine.prototype._getKey=function(e){return this._keys[e]};PivotEngine.prototype._getRowKey=function(i){var n=e.isNumber(i)?this._pivotView.items[i]:i;return n?n[t._PivotKey._ROW_KEY_NAME]:null};PivotEngine.prototype._getRowLevel=function(e){var t=this._getRowKey(e);return t?t.level:-1};PivotEngine.prototype._getColKey=function(i){e.isNumber(i)&&(i=this._colBindings[i]);if(e.isString(i))return this._getKey(i);e.assert(null==i||i instanceof t._PivotKey,"invalid parameter in call to _getColLevel");return i};PivotEngine.prototype._getColLevel=function(e){return(e=this._getColKey(e))?e.level:-1};PivotEngine.prototype._applyFilter=function(e){for(var t=this._activeFilterFields,i=0;i<t.length;i++){if(!t[i].filter.apply(e))return!1}return!0};PivotEngine.prototype._updateView=function(t){var i=this;void 0===t&&(t=!1);if(!this.isUpdating||t){this.cancelPendingUpdates();this._cntTotal=this._cntFiltered=0;this._tallies={};this._keys={};this._activeFilterFields=[];if(this._server&&this.isViewDefined){this._server.getOutputView((function(e){if(i.isViewDefined){i._server.updateTallies(e);i._updatePivotView(t)}}));return}this._viewLists.forEach((function(e){e.forEach((function(e){e.filter.isActive&&i._activeFilterFields.push(e)}))}));if(this.isViewDefined&&e.hasItems(this._cv)){this._batchStart=Date.now();this._updateTallies(this._cv.items,0,t)}else this._updatePivotView(t)}};PivotEngine.prototype._updateTallies=function(e,n,o){var s=this;void 0===o&&(o=!1);var l=e.length,a=new t._PivotNode(this._rowFields,0,null,-1,null),d=this.valueFields;0==d.length&&this.columnFields.length>0&&(d=new t.PivotFieldCollection(this)).push(new t.PivotField(this,""));for(var u=i,h=this._rowFields.length,c=this._getShowRowTotals(),p=c==u.None?h:0,g=c==u.GrandTotals?Math.max(1,h):1,_=this._columnFields.length,f=this._getShowColTotals(),v=f==u.None?_:0,y=f==u.GrandTotals?Math.max(1,_):1,m=d.length,_loop_1=function(i){if(w._async&&i-n>=PivotEngine._BATCH_SIZE&&Date.now()-w._batchStart>PivotEngine._BATCH_DELAY){w._toUpdateTallies=setTimeout((function(){s.onUpdatingView(new r(Math.round(i/e.length*100)));s._batchStart=Date.now();s._updateTallies(e,i,o)}),PivotEngine._BATCH_TIMEOUT);return{value:void 0}}w._cntTotal++;var l=e[i];if(!w._activeFilterFields.length||w._applyFilter(l)){w._cntFiltered++;for(var u=p;u<=h;u+=g){var c=a.getNode(w._rowFields,u,null,-1,l),f=c.key,b=f.toString(),P=w._tallies[b];if(!P){w._keys[b]=f;w._tallies[b]=P={}}for(var C=v;C<=_;C+=y)for(var F=0;F<m;F++){var S=c.tree.getNode(w._columnFields,C,d,F,l).key,x=S.toString(),T=P[x];if(!T){w._keys[x]=S;T=P[x]=new t._Tally}var E=d[F],M=E._getValue(l,!1),D=E._weightField?E._getWeight(l):null;T.add(M,D)}}}},w=this,b=n;b<l;b++){var P=_loop_1(b);if("object"==typeof P)return P.value}this._toUpdateTallies=null;this._updatePivotView(o)};PivotEngine.prototype._updatePivotView=function(e){var i=this;void 0===e&&(e=!1);if(!this.isUpdating||e){var n=this._pivotView;n.deferUpdate((function(){i.onUpdatingView(new r(100));var e=n.sourceCollection;e.length=0;var o={};for(var s in i._tallies)o[s]=!0;var l={};for(var s in i._tallies){var a=i._tallies[s];for(var d in a)l[d]=!0}for(var u=i._server&&i.sortOnServer,h=i._getSortedKeys(o,u),c=i._getSortedKeys(l,u),p=0;p<h.length;p++){var g=h[p],_=(a=i._tallies[g],{});_[t._PivotKey._ROW_KEY_NAME]=i._getKey(g);for(var f=0;f<c.length;f++){var v=c[f],y=a[v],m=i._getKey(v),w=y?y.getAggregate(m.aggregate):null;null==w&&i._showZeros&&(w=0);_[v]=w}e.push(_)}i._colBindings=c;i._updateFieldValues(e);n.sortDescriptions.clear();n.refresh()}));this.onUpdatedView()}};PivotEngine.prototype._getSortedKeys=function(e,t){var i=this,n=Object.keys(e);t||n.sort((function(e,t){return i._keys[e].compareTo(i._keys[t])}));return n};PivotEngine.prototype._updateFieldValues=function(t){for(var i=this.valueFields.length,_loop_2=function(r){var s=o.valueFields[r];switch(s.showAs){case n.RunTot:case n.RunTotPct:for(var l=r;l<o._colBindings.length;l+=i){for(var a=0;a<t.length;a++){(c=t[a])[_=o._colBindings[l]]=o._getRunningTotal(t,a,l,s.showAs)}if(s.showAs==n.RunTotPct)for(a=0;a<t.length;a++){var d=(c=t[a])[_=o._colBindings[l]];if(e.isNumber(d)){var u=o._getLastValueInRowGroup(t,a,l);0!=u&&(c[_]=d/u)}}}break;case n.PctGrand:case n.PctCol:var h=0;if(s.showAs==n.PctGrand)for(l=r;l<o._colBindings.length;l+=i)-1==o._getColLevel(l)&&(h+=o._getColTotal(t,l));var _loop_3=function(i){s.showAs==n.PctCol&&(h=o._getColTotal(t,i));var r=o._colBindings[i];t.forEach((function(t){var i=t[r];e.isNumber(i)&&(t[r]=0!=h?i/h:null)}))};for(l=r;l<o._colBindings.length;l+=i)_loop_3(l);break;case n.PctRow:for(a=0;a<t.length;a++){var c=t[a],p=0;for(l=r;l<o._colBindings.length;l+=i)if(-1==o._getColLevel(l)){var g=c[_=o._colBindings[l]];e.isNumber(g)&&(p+=g)}for(l=r;l<o._colBindings.length;l+=i){g=c[_=o._colBindings[l]];e.isNumber(g)&&(c[_]=0!=p?g/p:null)}}break;case n.DiffRow:case n.DiffRowPct:case n.PctPrevRow:for(l=r;l<o._colBindings.length;l+=i)for(a=t.length-1;a>=0;a--){(c=t[a])[_=o._colBindings[l]]=o._getRowDifference(t,a,l,s.showAs)}break;case n.DiffCol:case n.DiffColPct:case n.PctPrevCol:for(a=0;a<t.length;a++)for(l=o._colBindings.length-i+r;l>=0;l-=i){var _;(c=t[a])[_=o._colBindings[l]]=o._getColDifference(t,a,l,s.showAs)}}},o=this,r=0;r<i;r++)_loop_2(r)};PivotEngine.prototype._getColTotal=function(t,i){var n=this,o=this._colBindings[i],r=0;t.forEach((function(t){if(-1==n._getRowLevel(t)){var i=t[o];e.isNumber(i)&&(r+=i)}}));return r};PivotEngine.prototype._getRunningTotal=function(e,t,n,o){var r=this._getRowLevel(t);if(0==r)return null;for(var s=this._colBindings[n],l=e[t][s],a=this._getShowRowTotals(),d=this.rowFields.length-2,u=t-1;u>=0;u--){var h=this._getRowLevel(u);if(h==r){if(d>-1&&r<0&&a!=i.Subtotals){var c=e[t].$rowKey,p=e[u].$rowKey;if(c.values[d]!=p.values[d])return null}l+=e[u][s];break}if(h>r)break}return l};PivotEngine.prototype._getLastValueInRowGroup=function(e,t,n){for(var o=this._colBindings[n],r=e[t][o],s=this._getRowLevel(t),l=this.rowFields.length-2,a=this._getShowRowTotals(),d=t+1;d<e.length;d++){var u=this._getRowLevel(d);if(u==s){if(l>-1&&s<0&&a!=i.Subtotals){var h=e[t].$rowKey,c=e[d].$rowKey;if(h.values[l]!=c.values[l])return r}r=e[d][o]}if(u>s)break}return r};PivotEngine.prototype._getRowDifference=function(e,t,o,r){var s=this._getRowLevel(t);if(0==s)return null;for(var l=this._colBindings[o],a=e[t][l],d=this.rowFields.length-2,u=this._getShowRowTotals(),h=t-1;h>=0;h--){var c=this._getRowLevel(h);if(c==s){if(d>-1&&s<0&&u!=i.Subtotals){var p=e[t].$rowKey,g=e[h].$rowKey;if(p.values[d]!=g.values[d])return null}var _=e[h][l];switch(r){case n.DiffRow:a-=_;break;case n.DiffRowPct:a=(a-_)/_;break;case n.PctPrevRow:a/=_}return a}if(c>s)break}return r==n.PctPrevRow?1:null};PivotEngine.prototype._getColDifference=function(e,t,o,r){var s=this._getColLevel(o);if(0==s)return null;for(var l=e[t],a=l[this._colBindings[o]],d=this.valueFields.length,u=this.columnFields.length-2,h=this._getShowColTotals(),c=o-d;c>=0;c-=d){var p=this._getColLevel(c);if(p==s){if(u>-1&&s<0&&h!=i.Subtotals){var g=this._getKey(this._colBindings[o]),_=this._getKey(this._colBindings[c]);if(g.values[u]!=_.values[u])return null}var f=l[this._colBindings[c]];switch(r){case n.DiffCol:a-=f;break;case n.DiffColPct:a=(a-f)/f;break;case n.PctPrevCol:a/=f}return a}if(p>s)break}return r==n.PctPrevCol?1:null};PivotEngine.prototype._getShowRowTotals=function(){return this._valueFields.length?this._showRowTotals:i.None};PivotEngine.prototype._getShowColTotals=function(){return this._valueFields.length?this._showColTotals:i.None};PivotEngine.prototype._getUniqueValues=function(e){return this._server?this._server.getUniqueValues(e):null};PivotEngine.prototype._generateFields=function(){var t=this;this._viewLists.forEach((function(e){e.clear()}));for(var i=0;i<this.fields.length;i++){if(this.fields[i]._autoGenerated){this.fields.removeAt(i);i--}}if(this._server){this._server.getFields().forEach((function(e){var i=t._createField(e,!0);t.fields.getField(i.header)||t.fields.push(i)}))}else{var n=this.collectionView,o=n?n.sourceCollection:null;o&&o.length&&this.autoGenerateFields&&e.getTypes(o).forEach((function(i){var n=t._createField({binding:i.binding,header:e.toHeaderCase(i.binding),dataType:i.dataType},!0);t.fields.getField(n.header)||t.fields.push(n)}))}};PivotEngine.prototype._updateFieldTypes=function(){var e=this,t=this.collectionView,i=t?t.sourceCollection:null;i&&i.length&&this.fields.forEach((function(t){e._updateFieldType(t,i)}))};PivotEngine.prototype._updateFieldType=function(t,i){var n=this;if(t._hasSubFields())t.subFields.forEach((function(e){n._updateFieldType(e,i)}));else{if(null==t.dataType&&t.binding)for(var o=0;o<i.length&&o<1e3;o++){var r=t._binding.getValue(i[o]);if(null!=r){t.dataType=e.isPrimitive(r)?e.getType(r):null;break}}if(null!=t.dataType){t.format||(t.format=t.dataType==e.DataType.Date?"d":"n0");t.aggregate==e.Aggregate.Sum&&t.dataType!=e.DataType.Number&&(t.aggregate=e.Aggregate.Cnt)}}};PivotEngine.prototype._createField=function(i,n){var o;if(e.isString(i))o=new t.PivotField(this,i);else if(i){i.key&&delete i.key;o=null!=i.dimensionType?new t.CubePivotField(this,i.binding,i.header,i):new t.PivotField(this,i.binding,i.header,i);null!=i.dataType&&(o.dataType=i.dataType)}o._autoGenerated=n;if(n||e.isString(i)){o.format=o.dataType==e.DataType.Date?"d":"n0";o.aggregate=o.dataType==e.DataType.Number?e.Aggregate.Sum:e.Aggregate.Cnt}i&&!e.isString(i)&&e.copy(o,i);return o};PivotEngine.prototype._cvCollectionChanged=function(e,t){this.invalidate()};PivotEngine.prototype._fieldListChanged=function(t,i){if(i.action==e.collections.NotifyCollectionChangedAction.Add){for(var n=t,o=0;o<n.length-1;o++)if(n[o].key)for(var r=o+1;r<n.length;r++)if(n[o].key==n[r].key){n.removeAt(r);r--}if(n!=this._fields)if(this._fields.getField(i.item.key)){for(o=0;o<this._viewLists.length;o++)if(this._viewLists[o]!=n){var s=this._viewLists[o];(l=s.indexOf(i.item))>-1&&s.removeAt(l)}}else n.removeAt(i.index);if(e.isNumber(n.maxItems)&&n.maxItems>-1)for(;n.length>n.maxItems;){var l;n[l=n.length-1]==i.item&&l>0&&l--;n.removeAt(l)}}this.onViewDefinitionChanged();this.invalidate()};PivotEngine.prototype._fieldPropertyChanged=function(e,t){this.onViewDefinitionChanged();if(e.isActive){var i=t.propertyName;"visible"!=i&&("width"!=i&&"wordWrap"!=i&&"isContentHtml"!=i?"format"==i&&this.valueFields.indexOf(e)>-1?this._pivotView.refresh():"showAs"!=i?"descending"!=i?"aggregate"!=i?this.invalidate():this.valueFields.indexOf(e)>-1&&!this.isUpdating&&(this._server?this._updateView():this._updatePivotView()):this._updatePivotView():this.valueFields.indexOf(e)>-1&&!this.isUpdating&&this._updatePivotView():this._pivotView.refresh())}};PivotEngine.prototype._copyProps=function(e,t,i){for(var n=0;n<i.length;n++){var o=i[n];null!=t[o]&&(e[o]=t[o])}};PivotEngine.prototype._getFieldFromDefinition=function(e){var t=e.filter;e.filter&&delete e.filter;var i=this._createField(e,!0);if(t){this._setFilterProxy(i,t);e.filter=t}return i};PivotEngine.prototype._getFieldDefinition=function(e){var i=this,n={binding:e.binding,header:e.header,dataType:e.dataType,aggregate:e.aggregate,showAs:e.showAs,descending:e.descending,format:e.format,align:e.align,wordWrap:e.wordWrap,width:e.width,isContentHtml:e.isContentHtml};e.weightField&&(n.weightField=e.weightField._getName());e.key&&(n.key=e.key);e.filter.isActive&&(n.filter=this._getFilterProxy(e));if(e._hasSubFields()){n.subFields=[];e.subFields.forEach((function(e){n.subFields.push(i._getFieldDefinition(e))}))}e instanceof t.CubePivotField&&(n.dimensionType=e.dimensionType);return n};PivotEngine.prototype._getFieldCollectionProxy=function(t){var i={items:[]};e.isNumber(t.maxItems)&&t.maxItems>-1&&(i.maxItems=t.maxItems);for(var n=0;n<t.length;n++){var o=t[n];i.items.push(o.key)}return i};PivotEngine.prototype._setFieldCollectionProxy=function(t,i){t.clear();t.maxItems=e.isNumber(i.maxItems)?i.maxItems:null;for(var n=0;n<i.items.length;n++)t.push(i.items[n])};PivotEngine.prototype._getFilterProxy=function(t){var i=t.filter;if(i.conditionFilter.isActive){var n=i.conditionFilter,o={type:"condition",condition1:{operator:n.condition1.operator,value:n.condition1.value},and:n.and,condition2:{operator:n.condition2.operator,value:n.condition2.value}};n.condition1.isActive||delete o.condition1;n.condition2.isActive||delete o.condition2;return o}if(i.valueFilter.isActive){var r=i.valueFilter;return{type:"value",filterText:r.filterText,showValues:r.showValues}}e.assert(!1,"inactive filters shouldn't be persisted.");return null};PivotEngine.prototype._setFilterProxy=function(t,i){var n=t.filter;n.clear();switch(i.type){case"condition":var o=n.conditionFilter;if(i.condition1){var r=e.changeType(i.condition1.value,t.dataType,t.format);o.condition1.value=r||i.condition1.value;o.condition1.operator=i.condition1.operator}e.isBoolean(i.and)&&(o.and=i.and);if(i.condition2){r=e.changeType(i.condition2.value,t.dataType,t.format);o.condition2.value=r||i.condition2.value;o.condition2.operator=i.condition2.operator}break;case"value":var s=n.valueFilter;s.filterText=i.filterText;s.showValues=i.showValues}};PivotEngine._BATCH_SIZE=1e4;PivotEngine._BATCH_TIMEOUT=0;PivotEngine._BATCH_DELAY=100;PivotEngine._props=["showZeros","showRowTotals","showColumnTotals","totalsBeforeData","sortableGroups","defaultFilterType"];return PivotEngine}();t.PivotEngine=o;var r=function(t){__extends(ProgressEventArgs,t);function ProgressEventArgs(i){var n=t.call(this)||this;n._progress=e.asNumber(i);return n}Object.defineProperty(ProgressEventArgs.prototype,"progress",{get:function(){return this._progress},enumerable:!0,configurable:!0});return ProgressEventArgs}(e.EventArgs);t.ProgressEventArgs=r}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(i){__extends(_ListContextMenu,i);function _ListContextMenu(t){var n=i.call(this,document.createElement("div"),{header:"Field Context Menu",displayMemberPath:"text",commandParameterPath:"parm",command:{executeCommand:function(e){n._execute(e)},canExecuteCommand:function(e){return n._canExecute(e)}}})||this;n._full=t;n.itemsSource=n._getMenuItems(t);e.addClass(n.dropDown,"context-menu wj-olap-context-menu");return n}_ListContextMenu.prototype.refresh=function(e){void 0===e&&(e=!0);this.itemsSource=this._getMenuItems(this._full);i.prototype.refresh.call(this,e)};_ListContextMenu.prototype.attach=function(t){var i=this;e.assert(t instanceof e.grid.FlexGrid,"Expecting a FlexGrid control...");var n=t.hostElement;n.addEventListener("contextmenu",(function(e){if(i._selectField(t,e)){e.preventDefault();i.owner=n;i.show(e)}}))};_ListContextMenu.prototype._selectField=function(e,i){var n=e.hitTest(i);if(n.panel!=e.cells||!n.range.isValid)return!1;var o=e.rows[n.row].dataItem;if(o instanceof t.CubePivotField&&o.subFields&&o.subFields.length)return!1;e.select(n.range,!0);return!0};_ListContextMenu.prototype._getMenuItems=function(t){var i;i=t?[{text:'<div class="menu-icon"></div>*',parm:"up"},{text:'<div class="menu-icon"></div>*',parm:"down"},{text:'<div class="menu-icon"></div>*',parm:"first"},{text:'<div class="menu-icon"></div>*',parm:"last"},{text:'<div class="wj-separator"></div>'},{text:'<div class="menu-icon"><span class="wj-glyph-filter"></span></div>*',parm:"filter"},{text:'<div class="menu-icon">&#8801;</div>*',parm:"rows"},{text:'<div class="menu-icon">&#10996;</div>*',parm:"cols"},{text:'<div class="menu-icon">&#931;</div>*',parm:"vals"},{text:'<div class="wj-separator"></div>'},{text:'<div class="menu-icon menu-icon-remove">&#10006;</div>*',parm:"remove"},{text:'<div class="wj-separator"></div>'},{text:'<div class="menu-icon">&#9965;</div>*',parm:"edit"}]:[{text:'<div class="menu-icon"><span class="wj-glyph-filter"></span></div>*',parm:"filter"},{text:'<div class="menu-icon">&#8801;</div>*',parm:"rows"},{text:'<div class="menu-icon">&#10996;</div>*',parm:"cols"},{text:'<div class="menu-icon">&#931;</div>*',parm:"vals"},{text:'<div class="wj-separator"></div>'},{text:'<div class="menu-icon">&#9965;</div>*',parm:"edit"}];for(var n=0;n<i.length;n++){var o=i[n];if(o.parm){var r=e.culture.olap._ListContextMenu[o.parm];e.assert(r,"missing localized text for item "+o.parm);o.text=o.text.replace(/([^>]+$)/,r)}}return i};_ListContextMenu.prototype._execute=function(t){var i=e.Control.getControl(this.owner),n=i.itemsSource,o=i.selection.row,r=i.rows[o].dataItem,s=r?r.engine:null,l=this._getTargetList(s,t);switch(t){case"up":case"first":case"down":case"last":if(s){var a=n.indexOf(r),d="up"==t?a-1:"first"==t?0:"down"==t?a+1:"last"==t?n.length:-1;s.deferUpdate((function(){n.removeAt(a);n.insert(d,r)}))}break;case"filter":case"rows":case"cols":case"vals":l&&r&&l.push(r);break;case"remove":r&&s.removeField(r);break;case"edit":r&&s.editField(r)}};_ListContextMenu.prototype._canExecute=function(i){var n=e.Control.getControl(this.owner);if(!n)return!1;var o=n.selection.row,r=o>-1?n.rows[o].dataItem:null,s=r?r.engine:null,l=this._getTargetList(s,i),a=!!r&&r instanceof t.CubePivotField,d=!!r&&r.isMeasure;switch(i){case"up":case"first":return o>0;case"down":case"last":return o<n.rows.length-1;case"filter":case"rows":case"cols":return!d&&l&&l.indexOf(r)<0;case"vals":return(!a||d)&&l&&l.indexOf(r)<0;case"edit":return s&&s.allowFieldEditing;case"detail":return r&&!a}return!0};_ListContextMenu.prototype._getTargetList=function(e,t){if(e)switch(t){case"filter":return e.filterFields;case"rows":return e.rowFields;case"cols":return e.columnFields;case"vals":return e.valueFields}return null};return _ListContextMenu}(e.input.Menu);t._ListContextMenu=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(i){__extends(PivotPanel,i);function PivotPanel(n,o){var r=i.call(this,n,null,!0)||this;r._showIcons=!0;r._restrictDrag=null;r.itemsSourceChanged=new e.Event;r.viewDefinitionChanged=new e.Event;r.updatingView=new e.Event;r.updatedView=new e.Event;var s=r.getTemplate();r.applyTemplate("wj-control wj-content wj-pivotpanel",s,{_dFields:"d-fields",_dFilters:"d-filters",_dRows:"d-rows",_dCols:"d-cols",_dVals:"d-vals",_dProgress:"d-prog",_btnUpdate:"btn-update",_chkDefer:"chk-defer",_gFlds:"g-flds",_gDrag:"g-drag",_gFlt:"g-flt",_gCols:"g-cols",_gRows:"g-rows",_gVals:"g-vals",_gDefer:"g-defer"});r._globalize();var l=r.hostElement;r.addEventListener(l,"dragstart",r._dragstart.bind(r));r.addEventListener(l,"dragover",r._dragover.bind(r));r.addEventListener(l,"dragleave",r._dragover.bind(r));r.addEventListener(l,"drop",r._drop.bind(r));r.addEventListener(l,"dragend",r._dragend.bind(r));r._lbFields=r._createFieldGrid(r._dFields);r._lbFilters=r._createFieldGrid(r._dFilters);r._lbRows=r._createFieldGrid(r._dRows);r._lbCols=r._createFieldGrid(r._dCols);r._lbVals=r._createFieldGrid(r._dVals);var a=r._ctxMenuShort=new t._ListContextMenu(!1);a.attach(r._lbFields);(a=r._ctxMenuFull=new t._ListContextMenu(!0)).attach(r._lbFilters);a.attach(r._lbRows);a.attach(r._lbCols);a.attach(r._lbVals);r._dMarker=e.createElement('<div class="wj-marker" style="display:none">&nbsp;</div>');r.hostElement.appendChild(r._dMarker);r.addEventListener(r._btnUpdate,"click",(function(e){r._ng.refresh(!0);r._lbFields.refresh();e.preventDefault()}));r.addEventListener(r._chkDefer,"click",(function(t){e.enable(r._btnUpdate,r._chkDefer.checked);if(r._chkDefer.checked)r._ng.beginUpdate();else{r._ng.endUpdate();r._lbFields.refresh()}}));r.engine=new t.PivotEngine;r.initialize(o);return r}PivotPanel.prototype._getProductInfo=function(){return"D6F4,PivotPanel"};Object.defineProperty(PivotPanel.prototype,"engine",{get:function(){return this._ng},set:function(i){var n=this;if(this._ng){this._ng.itemsSourceChanged.removeHandler(this._itemsSourceChanged);this._ng.viewDefinitionChanged.removeHandler(this._viewDefinitionChanged);this._ng.updatingView.removeHandler(this._updatingView);this._ng.updatedView.removeHandler(this._updatedView);this._ng.error.removeHandler(this._requestError)}i=e.asType(i,t.PivotEngine,!1);this._ng=i;this._ng.itemsSourceChanged.addHandler(this._itemsSourceChanged,this);this._ng.viewDefinitionChanged.addHandler(this._viewDefinitionChanged,this);this._ng.updatingView.addHandler(this._updatingView,this);this._ng.updatedView.addHandler(this._updatedView,this);this._ng.error.addHandler(this._requestError,this);this._lbFields.itemsSource=i.fields;this._lbFilters.itemsSource=i.filterFields;this._lbRows.itemsSource=i.rowFields;this._lbCols.itemsSource=i.columnFields;this._lbVals.itemsSource=i.valueFields;this._lbFields.collectionView.filter=function(e){return e.visible&&null==e.parentField};"Filters,Rows,Cols,Vals".split(",").forEach((function(e){n["_lb"+e].collectionView.filter=function(e){return e.visible}}))},enumerable:!0,configurable:!0});Object.defineProperty(PivotPanel.prototype,"itemsSource",{get:function(){return this._ng.itemsSource},set:function(e){e instanceof t.PivotEngine?this.engine=e:this._ng.itemsSource=e},enumerable:!0,configurable:!0});Object.defineProperty(PivotPanel.prototype,"collectionView",{get:function(){return this._ng.collectionView},enumerable:!0,configurable:!0});Object.defineProperty(PivotPanel.prototype,"pivotView",{get:function(){return this._ng.pivotView},enumerable:!0,configurable:!0});Object.defineProperty(PivotPanel.prototype,"autoGenerateFields",{get:function(){return this.engine.autoGenerateFields},set:function(e){this._ng.autoGenerateFields=e},enumerable:!0,configurable:!0});Object.defineProperty(PivotPanel.prototype,"fields",{get:function(){return this._ng.fields},enumerable:!0,configurable:!0});Object.defineProperty(PivotPanel.prototype,"rowFields",{get:function(){return this._ng.rowFields},enumerable:!0,configurable:!0});Object.defineProperty(PivotPanel.prototype,"columnFields",{get:function(){return this._ng.columnFields},enumerable:!0,configurable:!0});Object.defineProperty(PivotPanel.prototype,"valueFields",{get:function(){return this._ng.valueFields},enumerable:!0,configurable:!0});Object.defineProperty(PivotPanel.prototype,"filterFields",{get:function(){return this._ng.filterFields},enumerable:!0,configurable:!0});Object.defineProperty(PivotPanel.prototype,"viewDefinition",{get:function(){return this._ng.viewDefinition},set:function(e){this._ng.viewDefinition=e},enumerable:!0,configurable:!0});Object.defineProperty(PivotPanel.prototype,"isViewDefined",{get:function(){return this._ng.isViewDefined},enumerable:!0,configurable:!0});Object.defineProperty(PivotPanel.prototype,"showFieldIcons",{get:function(){return this._showIcons},set:function(t){if(t!=this._showIcons){this._showIcons=e.asBoolean(t);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotPanel.prototype,"restrictDragging",{get:function(){return this._restrictDrag},set:function(t){this._restrictDrag=e.asBoolean(t,!0)},enumerable:!0,configurable:!0});PivotPanel.prototype.onItemsSourceChanged=function(e){this.itemsSourceChanged.raise(this,e)};PivotPanel.prototype.onViewDefinitionChanged=function(e){this.viewDefinitionChanged.raise(this,e)};PivotPanel.prototype.onUpdatingView=function(e){this.updatingView.raise(this,e)};PivotPanel.prototype.onUpdatedView=function(e){this.updatedView.raise(this,e)};PivotPanel.prototype.refresh=function(e){var t=this;void 0===e&&(e=!0);"Fields,Filters,Rows,Cols,Vals".split(",").forEach((function(e){var i=t["_lb"+e];i.refresh();i.collectionView.refresh()}));if(e){this._globalize();this._ctxMenuShort.refresh();this._ctxMenuFull.refresh()}i.prototype.refresh.call(this,e)};PivotPanel.prototype._copy=function(e,t){switch(e){case"engine":this.engine=t;return!0}return!1};PivotPanel.prototype._globalize=function(){var t=e.culture.olap.PivotPanel;e.setText(this._gFlds,t.fields);e.setText(this._gDrag,t.drag);e.setText(this._gFlt,t.filters);e.setText(this._gCols,t.cols);e.setText(this._gRows,t.rows);e.setText(this._gVals,t.vals);e.setText(this._gDefer,t.defer);e.setText(this._btnUpdate,t.update)};PivotPanel.prototype._itemsSourceChanged=function(e,t){this.onItemsSourceChanged(t)};PivotPanel.prototype._viewDefinitionChanged=function(e,t){this.invalidate();this.onViewDefinitionChanged(t)};PivotPanel.prototype._updatingView=function(t,i){var n=e.clamp(i.progress,5,100)%100;this._dProgress.style.width=n+"%";this.onUpdatingView(i)};PivotPanel.prototype._updatedView=function(e,t){this.onUpdatedView(t)};PivotPanel.prototype._requestError=function(e,t){this._dProgress.style.width="0"};PivotPanel.prototype._createFieldGrid=function(i){var n=this,o=new e.grid.FlexGrid(i,{autoGenerateColumns:!1,childItemsPath:"subFields",columns:[{binding:"header",width:"*"}],headersVisibility:"None",selectionMode:"Cell",alternatingRowStep:0});o.cells.hostElement.parentElement.style.overflowX="hidden";o.formatItem.addHandler((function(i,o){var r=i.rows[o.row].dataItem;e.assert(r instanceof t.PivotField,"PivotField expected...");var s=r._hasSubFields();e.toggleClass(o.cell,"wj-header",s);o.cell.setAttribute("draggable",(!s).toString());var l=o.cell.innerHTML;r.filter.isActive&&(l+='&nbsp;&nbsp;<span class="wj-glyph-filter"></span>');i==n._lbVals&&(l+=' <span class="wj-aggregate">('+e.Aggregate[r.aggregate]+")</span>");if(i==n._lbFields&&!s){if(n._showIcons){l='<span class="wj-glyph-'+(r.isMeasure?"measure":"dimension")+'"></span> '+l}l='<label><input type="checkbox"'+(r.isActive?" checked":"")+"> "+l+"</label>"}o.cell.innerHTML=l}));o.addEventListener(i,"click",(function(e){var i=e.target;if(i instanceof HTMLInputElement&&"checkbox"==i.type){var r=n._hitTestField(o,e);r instanceof t.PivotField&&(r.isActive=i.checked)}}));return o};PivotPanel.prototype._dragstart=function(i){var n=this._getFlexGridTarget(i);if(n){this._dragField=this._hitTestField(n,i);this._dragSource=this._dragField instanceof t.PivotField?n.hostElement:null;if(this._dragSource&&i.dataTransfer){e._startDrag(i.dataTransfer,"copyMove");i.stopPropagation()}}};PivotPanel.prototype._dragover=function(e){var i=!1,n=this._getFlexGridTarget(e);if(n&&this._dragField){if(this._dragSource==this._dFields&&n!=this._lbFields){var o=n.itemsSource;if(null==o.maxItems||o.length<o.maxItems){var r=this._dragField;n.itemsSource.indexOf(r)<0?i=!0:n==this._lbVals&&(i=!(r instanceof t.CubePivotField))}}this._dragSource&&this._dragSource!=this._dFields&&(i=!0)}if(i&&this._getRestrictDrag()&&this._dragSource!=n.hostElement){var s=this._dragField.isMeasure;n==this._lbVals?i=s:n!=this._lbRows&&n!=this._lbCols||(i=!s)}if(i){this._updateDropMarker(n,e);e.dataTransfer.dropEffect=this._dragSource==this._dFields?"copy":"move";e.preventDefault();e.stopPropagation()}else this._updateDropMarker()};PivotPanel.prototype._drop=function(t){var i=this,n=this._getFlexGridTarget(t);if(n&&this._dragField){var o=e.Control.getControl(this._dragSource),r=this._dragField;if(o==this._lbFields&&n==this._lbVals&&n.itemsSource.indexOf(r)>-1){r=r._clone();this.engine.fields.push(r)}n==this._lbFields?r.isActive=!1:this._ng.deferUpdate((function(){var e=n.itemsSource,t=e.indexOf(r);if(t!=i._dropIndex){if(t>-1){e.removeAt(t);t<i._dropIndex&&i._dropIndex--}e.insert(i._dropIndex,r)}}))}this._resetMouseState()};PivotPanel.prototype._dragend=function(e){this._resetMouseState()};PivotPanel.prototype._hitTestField=function(e,t){var i=e.hitTest(t.target);if(i.panel==e.cells&&i.range.isValid){e.select(i.range,!0);return e.rows[i.row].dataItem}return null};PivotPanel.prototype._getRestrictDrag=function(){var e=this._restrictDrag;null==e&&this.fields.length&&(e=this.fields[0]instanceof t.CubePivotField);return e};PivotPanel.prototype._resetMouseState=function(){this._dragSource=null;this._updateDropMarker()};PivotPanel.prototype._getFlexGridTarget=function(t){var i=e.Control.getControl(e.closest(t.target,".wj-flexgrid"));return i instanceof e.grid.FlexGrid?i:null};PivotPanel.prototype._updateDropMarker=function(t,i){if(i){var n,o=this.hostElement,r=o.getBoundingClientRect();if(t.rows.length){var s=t.hitTest(i),l=s.row;if(l>-1){n=t.getCellBoundingRect(l,0);if(s.point.y>o.scrollTop+n.top+n.height/2&&l<t.rows.length-1){n.top+=n.height;l++}this._dropIndex=l}else{l=t.viewRange.bottomRow;(n=t.getCellBoundingRect(l,0)).top+=n.height;this._dropIndex=l+1}}else{(n=e.Rect.fromBoundingRect(t.hostElement.getBoundingClientRect())).top+=4;this._dropIndex=0}e.setCss(this._dMarker,{left:Math.round(n.left-r.left)+o.scrollLeft,top:Math.round(n.top-r.top-2)+o.scrollTop,width:Math.round(n.width),height:4,display:""})}else this._dMarker.style.display="none"};PivotPanel.controlTemplate='<div><label wj-part="g-flds"></label><div wj-part="d-fields"></div><label wj-part="g-drag"></label><table><tr><td width="50%"><label><span class="wj-glyph wj-glyph-filter"></span> <span wj-part="g-flt"></span></label><div wj-part="d-filters"></div></td><td width= "50%" style="border-left-style:solid"><label><span class="wj-glyph">&#10996;</span> <span wj-part="g-cols"></span></label><div wj-part="d-cols"></div></td></tr><tr style="border-top-style:solid"><td width="50%"><label><span class="wj-glyph">&#8801;</span> <span wj-part="g-rows"></span></label><div wj-part="d-rows"></div></td><td width= "50%" style="border-left-style:solid"><label><span class="wj-glyph">&#931;</span> <span wj-part="g-vals"></span></label><div wj-part="d-vals"></div></td></tr></table><div wj-part="d-prog" class="wj-state-selected" style="width:0px;height:3px"></div><div style="display:table"><label style="display:table-cell;vertical-align:middle"><input wj-part="chk-defer" type="checkbox"/> <span wj-part="g-defer"></span></label><button wj-part="btn-update" class="wj-btn wj-state-disabled" style="float:right;margin:6px" disabled></button></div></div>';return PivotPanel}(e.Control);t.PivotPanel=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(i){__extends(PivotGrid,i);function PivotGrid(n,o){var r=i.call(this,n)||this;r._showDetailOnDoubleClick=!0;r._collapsibleSubtotals=!0;r._customCtxMenu=!0;r._showRowFldSort=!1;r._showRowFldHdrs=!0;r._showColFldHdrs=!0;r._showValFldHdrs=!1;r._centerVert=!0;r._collapsedKeys={};r._resizingColumn=!1;r._outlineMode=!1;e.addClass(r.hostElement,"wj-pivotgrid");r.isReadOnly=!0;r.copyHeaders=e.grid.HeadersVisibility.All;r.deferResizing=!0;r.alternatingRowStep=0;r.autoGenerateColumns=!1;r.allowDragging=e.grid.AllowDragging.None;r.allowMerging=e.grid.AllowMerging.All;r.mergeManager=new t._PivotMergeManager(r);r.customContextMenu=!0;r.treeIndent=32;r.initialize(o);r.formatItem.addHandler(r._formatItem,r);var s=r.hostElement;r.addEventListener(s,"mousedown",r._mousedown.bind(r),!0);r.addEventListener(s,"mouseup",r._mouseup.bind(r),!0);r.addEventListener(s,"dblclick",r._dblclick.bind(r),!0);r.addEventListener(s,"keydown",r._keydown.bind(r),!0);r._ctxMenu=new t._GridContextMenu;r._ctxMenu.attach(r);return r}PivotGrid.prototype._getProductInfo=function(){return"D6F4,PivotGrid"};Object.defineProperty(PivotGrid.prototype,"engine",{get:function(){return this._ng},enumerable:!0,configurable:!0});Object.defineProperty(PivotGrid.prototype,"showDetailOnDoubleClick",{get:function(){return this._showDetailOnDoubleClick},set:function(t){this._showDetailOnDoubleClick=e.asBoolean(t)},enumerable:!0,configurable:!0});Object.defineProperty(PivotGrid.prototype,"detailDialog",{get:function(){this._dlgDetail||(this._dlgDetail=new t.DetailDialog(document.createElement("div")));return this._dlgDetail},enumerable:!0,configurable:!0});Object.defineProperty(PivotGrid.prototype,"showRowFieldHeaders",{get:function(){return this._showRowFldHdrs},set:function(t){if(t!=this._showRowFldHdrs){this._showRowFldHdrs=e.asBoolean(t);this._updateFixedContent()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotGrid.prototype,"showColumnFieldHeaders",{get:function(){return this._showColFldHdrs},set:function(t){if(t!=this._showColFldHdrs){this._showColFldHdrs=e.asBoolean(t);this._updateFixedContent()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotGrid.prototype,"showValueFieldHeaders",{get:function(){return this._showValFldHdrs},set:function(t){if(t!=this._showValFldHdrs){this._showValFldHdrs=e.asBoolean(t);this._updateFixedCounts();this._updateFixedContent()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotGrid.prototype,"showRowFieldSort",{get:function(){return this._showRowFldSort},set:function(t){if(t!=this._showRowFldSort){this._showRowFldSort=e.asBoolean(t);this._updateFixedContent()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotGrid.prototype,"customContextMenu",{get:function(){return this._customCtxMenu},set:function(t){this._customCtxMenu=e.asBoolean(t)},enumerable:!0,configurable:!0});Object.defineProperty(PivotGrid.prototype,"collapsibleSubtotals",{get:function(){return this._collapsibleSubtotals},set:function(t){if(t!=this._collapsibleSubtotals){this._collapsibleSubtotals=e.asBoolean(t);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotGrid.prototype,"centerHeadersVertically",{get:function(){return this._centerVert},set:function(t){if(t!=this._centerVert){this._centerVert=e.asBoolean(t);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotGrid.prototype,"outlineMode",{get:function(){return this._outlineMode},set:function(t){if(t!=this._outlineMode){this._outlineMode=e.asBoolean(t);this._bindGrid(!0)}},enumerable:!0,configurable:!0});PivotGrid.prototype.getKeys=function(t,i){var n=this.rows[e.asInt(t)],o=this.columns[e.asInt(i)],r=n?n.dataItem:null,s=o?o.binding:null;return this._ng.getKeys(r,s)};PivotGrid.prototype.getDetail=function(t,i){var n=this.rows[e.asInt(t)].dataItem,o=this.columns[e.asInt(i)].binding;return this._ng.getDetail(n,o)};PivotGrid.prototype.getDetailView=function(t,i){var n=this.rows[e.asInt(t)].dataItem,o=this.columns[e.asInt(i)].binding;return this._ng.getDetailView(n,o)};PivotGrid.prototype.showDetail=function(t,i){if(this._ng.valueFields.length){var n=this.detailDialog;n.showDetail(this,new e.grid.CellRange(t,i));n.show(!0)}};PivotGrid.prototype.collapseRowsToLevel=function(e){this._collapseRowsToLevel(e)};PivotGrid.prototype.collapseColumnsToLevel=function(e){this._collapseColsToLevel(e)};PivotGrid.prototype._getQuickAutoSize=function(){return e.isBoolean(this.quickAutoSize)?this.quickAutoSize:this.formatItem.handlerCount<=1&&null==this.itemFormatter};PivotGrid.prototype._bindGrid=function(n){var o=this;this.deferUpdate((function(){var r=o.preserveOutlineState,s=o._collapsedKeys,l=o.rows,a=o.columns;r||(s=o._collapsedKeys={});i.prototype._bindGrid.call(o,n);if(o._ng&&r&&!e.isEmpty(s)){for(var d=o._ng.totalsBeforeData,u=d?l.length-1:0,h=d?-1:l.length,c=d?-1:1,p=u;p!=h;p+=c){var g=l[p].dataItem;(_=g?g[t._PivotKey._ROW_KEY_NAME]:null)&&_.level>0&&s[_.toString()]&&o._setRowCollapsed(new e.grid.CellRange(p,_.level-1),!0)}u=d?a.length-1:0;h=d?-1:a.length;c=d?-1:1;for(p=u;p!=h;p+=c){var _,f=a[p].binding;(_=o._ng._getKey(f))&&_.level>0&&s[_.toString()]&&o._setColCollapsed(new e.grid.CellRange(_.level-1,p),!0)}}}))};PivotGrid.prototype._getCollectionView=function(i){i instanceof t.PivotPanel?i=i.engine.pivotView:i instanceof t.PivotEngine&&(i=i.pivotView);return e.asCollectionView(i)};PivotGrid.prototype.refresh=function(e){void 0===e&&(e=!0);this._ctxMenu.refresh();i.prototype.refresh.call(this,e)};PivotGrid.prototype.onItemsSourceChanged=function(e){if(this._ng){this._ng.updatingView.removeHandler(this._updatingView,this);this._ng.viewDefinitionChanged.removeHandler(this._viewDefinitionChanged,this)}this._collapsedKeys={};var n=this.collectionView;this._ng=n instanceof t.PivotCollectionView?n.engine:null;if(this._ng){this._ng.updatingView.addHandler(this._updatingView,this);this._ng.viewDefinitionChanged.addHandler(this._viewDefinitionChanged,this)}this._updatingView();this._bindGrid(!0);i.prototype.onItemsSourceChanged.call(this,e)};PivotGrid.prototype.onResizedColumn=function(e){var t=this._ng;if(t){this._resizingColumn=!0;if(e.panel.columns==this.rowHeaders.columns){var n=t.rowFields;if(e.col<n.length){n[e.col].width=e.panel.columns[e.col].renderWidth}}if(e.panel.columns==this.columnHeaders.columns){var o=t.valueFields;if(o.length>0){o[e.col%o.length].width=e.panel.columns[e.col].renderWidth}}this._resizingColumn=!1}i.prototype.onResizedColumn.call(this,e)};PivotGrid.prototype.onSortingColumn=function(e){var t=this._ng;return(!t||!t.isUpdating)&&i.prototype.onSortingColumn.call(this,e)};PivotGrid.prototype.onDraggingColumn=function(e){var t=this._ng;return(!t||!t.isUpdating)&&i.prototype.onDraggingColumn.call(this,e)};PivotGrid.prototype.onDraggedColumn=function(e){var t=this._ng;if(t&&e.panel.columns==this.topLeftCells.columns){var n=t.rowFields,o=n[e.data.col];t.deferUpdate((function(){n.removeAt(e.data.col);n.insert(e.col,o)}))}i.prototype.onDraggedColumn.call(this,e)};PivotGrid.prototype._updatingView=function(){this._updateFixedCounts();this.columns.clear();this.rows.clear()};PivotGrid.prototype._viewDefinitionChanged=function(){this._resizingColumn||(this._collapsedKeys={})};PivotGrid.prototype.onLoadedRows=function(n){if(0==this.columns.length){var o=this.collectionView,r=o?o.sourceCollection:null;if(r&&r.length){var s=r[0];for(var l in s)if(l!=t._PivotKey._ROW_KEY_NAME){var a=new e.grid.Column({binding:l,dataType:null!=s[l]?e.getType(s[l]):e.DataType.Number});this.columns.push(a)}}}this._updateFixedContent();i.prototype.onLoadedRows.call(this,n)};PivotGrid.prototype._updateFixedCounts=function(){var e,t=this._ng,i=t&&t.isViewDefined;e=Math.max(1,i?t.rowFields.length:1);this._setLength(this.topLeftCells.columns,e);e=Math.max(1,i?t.columnFields.length:1);t&&t.columnFields.length&&(t.valueFields.length>1||this.showValueFieldHeaders)&&e++;this._setLength(this.topLeftCells.rows,e)};PivotGrid.prototype._setLength=function(t,i){for(;t.length<i;)t.push(t instanceof e.grid.ColumnCollection?new e.grid.Column:new e.grid.Row);for(;t.length>i;)t.removeAt(t.length-1)};PivotGrid.prototype._updateFixedContent=function(){var i=this._ng;if(i&&i.isViewDefined){for(var n=i.rowFields,o=i.columnFields,r=i.valueFields,s=this.outlineMode?n.map((function(e){return e.header})).join(" / "):"",l=this.topLeftCells,a=0;a<l.rows.length;a++)for(var d=0;d<l.columns.length;d++){var u="";this.showRowFieldHeaders&&d<n.length&&a==l.rows.length-1&&(u=this.outlineMode?s:n[d].header);this.showColumnFieldHeaders&&!u&&a<o.length&&0==d&&(u=o[a].header+":");l.setCellData(a,d,u,!1,!1)}l=this.rowHeaders;for(a=0;a<l.rows.length;a++){var h=l.rows[a].dataItem[t._PivotKey._ROW_KEY_NAME];e.assert(h instanceof t._PivotKey,"missing PivotKey for row...");for(d=0;d<l.columns.length;d++){u=h.getValue(d,!0);l.setCellData(a,d,u,!1,!1)}}l=this.columnHeaders;for(d=0;d<l.columns.length;d++){h=i._getKey(l.columns[d].binding);e.assert(h instanceof t._PivotKey,"missing PivotKey for column...");for(a=0;a<l.rows.length;a++){u=h.getValue(a,!0);a==l.rows.length-1&&r.length&&(r.length>1||0==o.length||h.level>-1||this.showValueFieldHeaders)&&(u=r[d%r.length].header);l.setCellData(a,d,u,!1,!1)}}l=this.topLeftCells;for(d=0;d<l.columns.length;d++){var c=l.columns[d],p=d<n.length?n[d]:null;c.wordWrap=p?p.wordWrap:null;c.align=p?p.align:null;if(this.outlineMode&&d<l.columns.length-1){c.width=this.treeIndent;c.allowResizing=!1}else{c.allowResizing=!0;c.width=p&&e.isNumber(p.width)?p.width:this.columns.defaultSize}}l=this.cells;for(d=0;d<l.columns.length;d++){c=l.columns[d],p=r.length?r[d%r.length]:null;c.width=p&&e.isNumber(p.width)?p.width:this.columns.defaultSize;c.wordWrap=p?p.wordWrap:null;c.format=p?p.format:null;c.align=p?p.align:null}}else this.topLeftCells.setCellData(0,0,null)};PivotGrid.prototype._formatItem=function(i,n){var o=this._ng,r=n.panel,s=n.cell;if(o){if(r==this.topLeftCells){var l=0==o.rowFields.length||n.row<r.rows.length-1||n.row==r.rows.length-1&&!this.showRowFieldHeaders;e.toggleClass(s,"wj-col-field-hdr",l);e.toggleClass(s,"wj-row-field-hdr",!l)}var a,d=null;r==this.topLeftCells&&n.row==r.rows.length-1&&this.allowDragging&e.grid.AllowDragging.Columns&&(d=!0);e.setAttribute(s,"draggable",d);switch(r){case this.rowHeaders:a=o.rowFields[n.col%o.rowFields.length];break;case this.columnHeaders:a=o.columnFields[n.row];break;case this.cells:a=o.valueFields[n.col]}a&&a.isContentHtml&&(s.innerHTML=s.textContent);var u=r.columns[n.col].binding,h=r.rows==this.rows?o._getRowLevel(n.row):-1,c=r.columns==this.columns?o._getColLevel(u):-1;e.toggleClass(s,"wj-aggregate",h>-1||c>-1);if(this._collapsibleSubtotals){if(r==this.rowHeaders&&o._getShowRowTotals()==t.ShowTotals.Subtotals)if(this.outlineMode){var p=this._getGroupedRows(n.range);if(n.col<o.rowFields.length-1){if(!p.containsRow(n.row)){var g=this._getRowCollapsed(n.range);s.innerHTML=this._getCollapsedGlyph(g)+s.innerHTML}}}else{p=this.getMergedRange(r,n.row,n.col,!1)||n.range;if(n.col<o.rowFields.length-1&&p.rowSpan>1){g=this._getRowCollapsed(p);s.innerHTML=this._getCollapsedGlyph(g)+s.innerHTML}}this.outlineMode&&r==this.rowHeaders&&n.range.rightCol<r.columns.length-1&&(s.innerHTML="");if(r==this.columnHeaders&&o._getShowColTotals()==t.ShowTotals.Subtotals){p=this.getMergedRange(r,n.row,n.col,!1)||n.range;if(n.row<o.columnFields.length-1&&p.columnSpan>1){var _=this._getColCollapsed(p);s.innerHTML=this._getCollapsedGlyph(_)+s.innerHTML}}}if(r==this.topLeftCells&&this.showRowFieldSort&&n.col<o.rowFields.length&&n.row==this._getSortRowIndex()){a=o.rowFields[n.col];e.toggleClass(s,"wj-sort-asc",!a.descending);e.toggleClass(s,"wj-sort-desc",a.descending);s.innerHTML+=' <span class="wj-glyph-'+(a.descending?"down":"up")+'"></span>'}r!=this.cells&&e.toggleClass(s,"wj-align-vcenter",this._centerVert)}};PivotGrid.prototype._getCollapsedGlyph=function(e){return'<div class="'+PivotGrid._WJC_COLLAPSE+'"><span class="wj-glyph-'+(e?"plus":"minus")+'"></span></div>'};PivotGrid.prototype._mousedown=function(t){if(t.defaultPrevented||0!=t.button)this._htDown=null;else{this._htDown=this.hitTest(t);if(null!=e.closestClass(t.target,PivotGrid._WJC_COLLAPSE)&&null!=this._htDown.panel){var i=this._htDown.range,n=void 0;switch(this._htDown.panel.cellType){case e.grid.CellType.RowHeader:n=this._getRowCollapsed(i);t.shiftKey||t.ctrlKey?this._collapseRowsToLevel(i.col+(n?2:1)):this._setRowCollapsed(i,!n);break;case e.grid.CellType.ColumnHeader:n=this._getColCollapsed(i);t.shiftKey||t.ctrlKey?this._collapseColsToLevel(i.row+(n?2:1)):this._setColCollapsed(i,!n)}this._htDown=null;t.preventDefault();this.focus()}}};PivotGrid.prototype._mouseup=function(t){if(this._htDown&&!t.defaultPrevented&&!this._mouseHdl._szRowCol){var i=this.hitTest(t);if(this._htDown.panel==i.panel&&i.range.equals(this._htDown.range)){var n=this._ng,o=this.topLeftCells;if(i.panel==o&&i.row==o.rows.length-1&&i.col>-1){if(this.allowSorting&&i.panel.columns[i.col].allowSorting){var r=n.rowFields[i.col];if(r&&!n.isUpdating){var s=new e.grid.CellRangeEventArgs(i.panel,i.range);if(this.onSortingColumn(s)){n.pivotView.sortDescriptions.clear();r.descending=!r.descending;this.onSortedColumn(s)}}}t.preventDefault()}}}};PivotGrid.prototype._dblclick=function(e){if(!e.defaultPrevented&&this._showDetailOnDoubleClick){var i=this._htDown;if(i&&i.panel==this.cells){var n=this._ng;n&&n.fields.length>0&&(n.fields[0]instanceof t.CubePivotField||this.showDetail(i.row,i.col))}}};PivotGrid.prototype._keydown=function(t){if(!t.defaultPrevented&&!t.ctrlKey&&t.altKey&&this.collapsibleSubtotals){var i=this._getKeyCode(t),n=this.selection;if(n.isValid){var o=this._getRowLevel(n.topRow);o<0&&(o=this.rowHeaders.columns.length-1);switch(i){case e.Key.Left:case e.Key.Right:var r=new e.grid.CellRange(n.row,o-1);this._setRowCollapsed(r,i==e.Key.Left);t.preventDefault()}}}};PivotGrid.prototype._getRowLevel=function(e){return this._ng._getRowLevel(e)};PivotGrid.prototype._getGroupedRows=function(t){var i,n=this._getRowLevel.bind(this),o=t.col+1,r=this.rows.length,s=this._ng.totalsBeforeData,l=t.row;if(0==n(l)){l=s?1:0;i=s?r-1:r-2}else{if(s)for(;l<r&&!(n(l)<0);l++);else for(;l>=0&&!(n(l)<0);l--);for(;l>0;l--){if((a=n(l-1))>0&&a<=o)break}for(i=l;i<r-1;i++){var a;if((a=n(i+1))>0&&a<=o)break}}e.assert(i>=l,"group end < start?");return i>=l?new e.grid.CellRange(l,t.col,i,t.col2):t};PivotGrid.prototype._toggleRowCollapsed=function(e){this._setRowCollapsed(e,!this._getRowCollapsed(e))};PivotGrid.prototype._getRowCollapsed=function(e){e=this._getGroupedRows(e);var i=this._ng.totalsBeforeData?e.row-1:e.row2+1,n=this.rows[i]||this.rows[e.row],o=n?n.dataItem[t._PivotKey._ROW_KEY_NAME]:null;return!!o&&this._collapsedKeys[o.toString()]};PivotGrid.prototype._setRowCollapsed=function(i,n){var o=this;i=this._getGroupedRows(i);var r=this._ng.totalsBeforeData?i.row-1:i.row2+1,s=this.rows[r]||this.rows[i.row],l=s?s.dataItem[t._PivotKey._ROW_KEY_NAME]:null;l&&(this._collapsedKeys[l.toString()]=n);this.deferUpdate((function(){for(var t=i.row;t<=i.row2;t++)o.rows[t].visible=!n;s&&(s.visible=!0);if(!n){var l=o._getRowLevel(r),a=[];for(t=i.row;t<=i.row2;t++)if(o._getRowLevel(t)>-1){var d=o._getGroupedRows(new e.grid.CellRange(t,l));e.assert(d.row>=i.row&&d.row2<=i.row2,"child range overflow");a.push(d);t++}a.forEach((function(e){var t=o._getRowCollapsed(e);o._setRowCollapsed(e,t)}))}}))};PivotGrid.prototype._collapseRowsToLevel=function(e){var i=this;e>=this._ng.rowFields.length&&(e=-1);this.deferUpdate((function(){for(var n=0;n<i.rows.length;n++){var o=i._getRowLevel(n);if(o>0){var r=i.rows[n].dataItem[t._PivotKey._ROW_KEY_NAME];i._collapsedKeys[r.toString()]=e>0&&o>=e}if(e<0)i.rows[n].visible=!0;else{var s=o>-1&&o<=e;s||(i._ng.totalsBeforeData?0==n&&(s=!0):n==i.rows.length-1&&(s=!0));i.rows[n].visible=s}}}))};PivotGrid.prototype._getColLevel=function(e){return this._ng._getColLevel(this.columns[e].binding)};PivotGrid.prototype._getGroupedCols=function(t){var i,n=this._getColLevel.bind(this),o=t.row+1,r=this.columns.length,s=this._ng.totalsBeforeData,l=t.col;if(0==n(l)){l=s?1:0;i=s?r-1:r-2}else{if(this._ng.totalsBeforeData)for(l=t.col;l<r&&!(n(l)<0);l++);else for(l=t.col;l>=0&&!(n(l)<0);l--);for(;l>0;l--){if((a=n(l-1))>0&&a<=o)break}for(i=l;i<r-1;i++){var a;if((a=n(i+1))>0&&a<=o)break}}e.assert(i>=l,"group end < start?");return i>=l?new e.grid.CellRange(t.row,l,t.row2,i):t};PivotGrid.prototype._toggleColCollapsed=function(e){this._setColCollapsed(e,!this._getColCollapsed(e))};PivotGrid.prototype._getColCollapsed=function(e){e=this._getGroupedCols(e);var t=this._ng,i=t.totalsBeforeData?e.col-t.valueFields.length:e.col2+1,n=this.columns[i],o=n?n.binding:null;return!!o&&this._collapsedKeys[o.toString()]};PivotGrid.prototype._setColCollapsed=function(t,i){var n=this;t=this._getGroupedCols(t);var o=this._ng,r=o.totalsBeforeData?t.col-o.valueFields.length:t.col2+1,s=this.columns[r],l=s?s.binding:null;l&&(this._collapsedKeys[l.toString()]=i);this.deferUpdate((function(){for(var s=1;s<=o.valueFields.length;s++)n.columns[o.totalsBeforeData?t.col-s:t.col2+s].visible=!0;for(var l=t.col;l<=t.col2;l++)n.columns[l].visible=!i;if(!i){var a=n._getColLevel(r),d=[];for(l=t.col;l<=t.col2;l++)if(n._getColLevel(l)>-1){var u=n._getGroupedCols(new e.grid.CellRange(a,l));e.assert(u.col>=t.col&&u.col2<=t.col2,"child range overflow");d.push(u);l+=o.valueFields.length-1}d.forEach((function(e){var t=n._getColCollapsed(e);n._setColCollapsed(e,t)}))}}))};PivotGrid.prototype._collapseColsToLevel=function(e){var t=this;e>=this._ng.columnFields.length&&(e=-1);this.deferUpdate((function(){for(var i=0;i<t.columns.length;i++){var n=t._getColLevel(i);if(n>0){var o=t._ng._getKey(t.columns[i].binding);t._collapsedKeys[o.toString()]=e>0&&n>=e}if(e<0)t.columns[i].visible=!0;else{var r=n>-1&&n<=e;t.columns[i].visible=r}}}))};PivotGrid._WJC_COLLAPSE="wj-pivot-collapse";return PivotGrid}(e.grid.FlexGrid);t.PivotGrid=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(i){__extends(DetailDialog,i);function DetailDialog(t,n){var o=i.call(this,t,null)||this,r=o.getTemplate();o.applyTemplate("wj-control wj-detaildialog",r,{_sCnt:"sp-cnt",_dSummary:"div-summary",_dGrid:"div-grid",_btnOK:"btn-ok",_gHdr:"g-hdr"});var s=e.culture.olap.DetailDialog;o._gHdr.textContent=s.header;o._btnOK.textContent=s.ok;o._g=new e.grid.FlexGrid(o._dGrid,{isReadOnly:!0});o.initialize(n);return o}DetailDialog.prototype.showDetail=function(i,n){var o=this,r=i.getDetailView(n.row,n.col);this._g.itemsSource=r;var s=e.tryCast(r,"IPagedCollectionView");this._updateDetailCount(s?s.totalItemCount:r.items.length);r.collectionChanged.addHandler((function(){o._updateDetailCount(r.items.length)}));var l=i.engine,a=e.culture.olap.DetailDialog,d="",u=i.rows[n.row].dataItem[t._PivotKey._ROW_KEY_NAME];this._rowHdr=e.escapeHtml(this._getHeader(u));this._rowHdr&&(d+=a.row+": <b>"+this._rowHdr+"</b><br>");var h=l._getKey(i.columns[n.col].binding);this._colHdr=e.escapeHtml(this._getHeader(h));this._colHdr&&(d+=a.col+": <b>"+this._colHdr+"</b><br>");var c=l.valueFields,p=c[n.col%c.length],g=i.getCellData(n.row,n.col,!0);this._cellHdr=e.escapeHtml(p.header);this._cellValue=e.escapeHtml(g);d+=this._cellHdr+": <b>"+this._cellValue+"</b>";this._dSummary.innerHTML=d};Object.defineProperty(DetailDialog.prototype,"rowHeader",{get:function(){return this._rowHdr},enumerable:!0,configurable:!0});Object.defineProperty(DetailDialog.prototype,"columnHeader",{get:function(){return this._colHdr},enumerable:!0,configurable:!0});Object.defineProperty(DetailDialog.prototype,"cellHeader",{get:function(){return this._cellHdr},enumerable:!0,configurable:!0});Object.defineProperty(DetailDialog.prototype,"cellValue",{get:function(){return this._cellValue},enumerable:!0,configurable:!0});Object.defineProperty(DetailDialog.prototype,"detailCount",{get:function(){return this._detailCount},enumerable:!0,configurable:!0});DetailDialog.prototype._updateDetailCount=function(t){var i=e.culture.olap.DetailDialog;this._sCnt.textContent=e.format(1==t?i.item:i.items,{cnt:t});this._detailCount=t};DetailDialog.prototype._getHeader=function(e){if(e&&e.values&&e.values.length){for(var t=[],i=0;i<e.values.length;i++)t.push(e.getValue(i,!0));return t.join(" - ")}return null};DetailDialog.controlTemplate='<div><div class="wj-dialog-header"><span wj-part="g-hdr">Detail View:</span> <span wj-part="sp-cnt"></span></div><div class="wj-dialog-body"><div wj-part="div-summary" class="wj-summary"></div><div wj-part="div-grid"></div></div><div class="wj-dialog-footer"><button wj-part="btn-ok"class="wj-hide wj-btn">OK</button>&nbsp;&nbsp;</div></div>';return DetailDialog}(e.input.Popup);t.DetailDialog=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(i){__extends(_PivotMergeManager,i);function _PivotMergeManager(){return null!==i&&i.apply(this,arguments)||this}_PivotMergeManager.prototype.getMergedRange=function(n,o,r,s){void 0===s&&(s=!0);var l=n.grid.collectionView;this._ng=l instanceof t.PivotCollectionView?l.engine:null;if(!this._ng)return i.prototype.getMergedRange.call(this,n,o,r,s);if(o<0||o>=n.rows.length||r<0||r>=n.columns.length)return null;var a=n.grid.allowMerging,d=e.grid.AllowMerging;switch(n.cellType){case e.grid.CellType.TopLeft:return 0!=(a&d.AllHeaders)?this._getMergedTopLeftRange(n,o,r):null;case e.grid.CellType.RowHeader:return 0!=(a&d.RowHeaders)?this._getMergedRowHeaderRange(n,o,r,s?n.viewRange:null):null;case e.grid.CellType.ColumnHeader:return 0!=(a&d.ColumnHeaders)?this._getMergedColumnHeaderRange(n,o,r,s?n.viewRange:null):null}return null};_PivotMergeManager.prototype._getMergedTopLeftRange=function(t,i,n){var o=new e.grid.CellRange(i,n),r=t.grid;if(r.outlineMode&&r.showRowFieldHeaders&&o.row==t.rows.length-1){o.col=0;o.col2=t.columns.length-1;return o}for(;o.col>0&&!t.getCellData(i,o.col,!0);)o.col--;for(;o.col2<t.columns.length-1&&!t.getCellData(i,o.col2+1,!0);)o.col2++;return o.isSingleCell?null:o};_PivotMergeManager.prototype._getMergedRowHeaderRange=function(t,i,n,o){var r=t.grid;if(r.outlineMode){if(this._isSubtotal(t,i,n)||this._isSubtotal(t,i,n+1)){var s=this._getOutlineRange(t,i,n);return s.isSingleCell?null:s}if(n<t.columns.length-1){var l=r._getGroupedRows(new e.grid.CellRange(i,n));return l.isSingleCell?null:l}return null}var a=this._ng._getRowLevel(i);if(a>-1&&n>=a){var d=t.getCellData(i,n,!1),u=void 0,h=void 0,c=o?o.col:0,p=o?o.col2:t.columns.length-1;for(u=n;u>c&&t.getCellData(i,u-1,!1)==d;u--);for(h=n;h<p&&t.getCellData(i,h+1,!1)==d;h++);return u!=h?new e.grid.CellRange(i,u,i,h):null}var g,_,f=o?o.row:0,v=o?o.row2:t.rows.length-1;for(g=i;g>f&&this._sameColumnValues(t,i,g-1,n);g--);for(_=i;_<v&&this._sameColumnValues(t,i,_+1,n);_++);return g!=_?new e.grid.CellRange(g,n,_,n):null};_PivotMergeManager.prototype._sameColumnValues=function(e,t,i,n){for(;n>=0;n--){if(e.getCellData(t,n,!1)!=e.getCellData(i,n,!1))return!1}return!0};_PivotMergeManager.prototype._isSubtotal=function(e,i,n){var o=e.rows[i].dataItem,r=o?o[t._PivotKey._ROW_KEY_NAME]:null;return o&&n>r.values.length-1&&n<e.columns.length};_PivotMergeManager.prototype._getOutlineRange=function(t,i,n){var o=new e.grid.CellRange(i,n);o.col2=t.columns.length-1;for(;o.col&&this._isSubtotal(t,i,o.col);)o.col--;return o};_PivotMergeManager.prototype._getMergedColumnHeaderRange=function(t,i,n,o){var r=this._ng._getKey(t.columns[n].binding),s=t.getCellData(i,n,!1),l=this._ng._getColLevel(r);if(l>-1&&i>=l){var a=void 0,d=void 0,u=o?o.row:0,h=o?o.row2:t.rows.length-1;for(a=i;a>u&&t.getCellData(a-1,n,!1)==s;a--);for(d=i;d<h&&t.getCellData(d+1,n,!1)==s;d++);if(a!=d)return new e.grid.CellRange(a,n,d,n)}var c,p,g=o?o.col:0,_=o?o.col2:t.columns.length-1;for(c=n;c>g&&this._sameRowValues(t,i,n,c-1);c--);for(p=n;p<_&&this._sameRowValues(t,i,n,p+1);p++);return c!=p?new e.grid.CellRange(i,c,i,p):null};_PivotMergeManager.prototype._sameRowValues=function(e,t,i,n){for(;t>=0;t--){if(e.getCellData(t,i,!1)!=e.getCellData(t,n,!1))return!1}return!0};return _PivotMergeManager}(e.grid.MergeManager);t._PivotMergeManager=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i,n;!function(e){e[e.Column=0]="Column";e[e.Bar=1]="Bar";e[e.Scatter=2]="Scatter";e[e.Line=3]="Line";e[e.Area=4]="Area";e[e.Pie=5]="Pie"}(i=t.PivotChartType||(t.PivotChartType={}));!function(e){e[e.Always=0]="Always";e[e.Never=1]="Never";e[e.Auto=2]="Auto"}(n=t.LegendVisibility||(t.LegendVisibility={}));var o=function(o){__extends(PivotChart,o);function PivotChart(t,r){var s=o.call(this,t)||this;s._chartType=i.Column;s._showHierarchicalAxes=!0;s._showTotals=!1;s._showTitle=!0;s._showLegend=n.Always;s._legendPosition=e.chart.Position.Right;s._maxSeries=PivotChart.MAX_SERIES;s._maxPoints=PivotChart.MAX_POINTS;s._stacking=e.chart.Stacking.None;s._colItms=[];s._dataItms=[];s._lblsSrc=[];s._grpLblsSrc=[];e.addClass(s.hostElement,"wj-pivotchart");s._isPieChart()?s._createFlexPie():s._createFlexChart();o.prototype.initialize.call(s,r);return s}PivotChart.prototype._getProductInfo=function(){return"D6F4,PivotChart"};Object.defineProperty(PivotChart.prototype,"engine",{get:function(){return this._ng},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"itemsSource",{get:function(){return this._itemsSource},set:function(i){if(i&&this._itemsSource!==i){var n=this._itemsSource;i instanceof t.PivotPanel?i=i.engine.pivotView:i instanceof t.PivotEngine&&(i=i.pivotView);this._itemsSource=e.asCollectionView(i);this._onItemsSourceChanged(n)}},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"chartType",{get:function(){return this._chartType},set:function(t){if((t=e.asEnum(t,i))!=this._chartType){var n=this._chartType;this._chartType=t;this._changeChartType();t!==i.Bar&&n!==i.Bar||this._updatePivotChart()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"showHierarchicalAxes",{get:function(){return this._showHierarchicalAxes},set:function(t){if(t!=this._showHierarchicalAxes){this._showHierarchicalAxes=e.asBoolean(t,!0);!this._isPieChart()&&this._flexChart&&this._updateFlexChart(this._dataItms,this._lblsSrc,this._grpLblsSrc)}},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"showTotals",{get:function(){return this._showTotals},set:function(t){if(t!=this._showTotals){this._showTotals=e.asBoolean(t,!0);this._updatePivotChart()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"showTitle",{get:function(){return this._showTitle},set:function(t){if(t!=this._showTitle){this._showTitle=e.asBoolean(t,!0);this._updatePivotChart()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"showLegend",{get:function(){return this._showLegend},set:function(t){if((t=e.asEnum(t,n))!=this.showLegend){this._showLegend=t;this._updatePivotChart()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"legendPosition",{get:function(){return this._legendPosition},set:function(t){if((t=e.asEnum(t,e.chart.Position))!=this.legendPosition){this._legendPosition=t;this._updatePivotChart()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"stacking",{get:function(){return this._stacking},set:function(t){if((t=e.asEnum(t,e.chart.Stacking))!=this._stacking){this._stacking=t;if(this._flexChart){this._flexChart.stacking=this._stacking;this._updatePivotChart()}}},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"maxSeries",{get:function(){return this._maxSeries},set:function(t){if(t!=this._maxSeries){this._maxSeries=e.asNumber(t);this._updatePivotChart()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"maxPoints",{get:function(){return this._maxPoints},set:function(t){if(t!=this._maxPoints){this._maxPoints=e.asNumber(t);this._updatePivotChart()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"flexChart",{get:function(){return this._flexChart},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"flexPie",{get:function(){return this._flexPie},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"header",{get:function(){return this._header},set:function(t){if(t!=this._header){this._header=e.asString(t,!0);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"footer",{get:function(){return this._footer},set:function(t){if(t!=this._footer){this._footer=e.asString(t,!0);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"headerStyle",{get:function(){return this._headerStyle},set:function(e){if(e!=this._headerStyle){this._headerStyle=e;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(PivotChart.prototype,"footerStyle",{get:function(){return this._footerStyle},set:function(e){if(e!=this._footerStyle){this._footerStyle=e;this.invalidate()}},enumerable:!0,configurable:!0});PivotChart.prototype.refresh=function(e){void 0===e&&(e=!0);o.prototype.refresh.call(this,e);this._isPieChart()?this._flexPie&&this._flexPie.refresh(e):this._flexChart&&this._flexChart.refresh(e);this._updatePivotChart()};PivotChart.prototype.saveImageToDataUrl=function(e,t){this._isPieChart()?this._flexPie&&this._flexPie.saveImageToDataUrl(e,t):this._flexChart&&this._flexChart.saveImageToDataUrl(e,t)};PivotChart.prototype.saveImageToFile=function(e){this._isPieChart()?this._flexPie&&this._flexPie.saveImageToFile(e):this._flexChart&&this._flexChart.saveImageToFile(e)};PivotChart.prototype._onItemsSourceChanged=function(e){this._ng&&this._ng.updatedView.removeHandler(this._updatePivotChart,this);e&&e.collectionChanged.removeHandler(this._updatePivotChart,this);var i=this._itemsSource;this._ng=i instanceof t.PivotCollectionView?i.engine:null;this._ng&&this._ng.updatedView.addHandler(this._updatePivotChart,this);this._itemsSource&&this._itemsSource.collectionChanged.addHandler(this._updatePivotChart,this);this._updatePivotChart()};PivotChart.prototype._createFlexChart=function(){var i=this,n=document.createElement("div");this.hostElement.appendChild(n);this._flexChart=new e.chart.FlexChart(n);this._flexChart._bindingSeparator=null;this._flexChart.legend.position=e.chart.Position.Right;this._flexChart.bindingX=t._PivotKey._ROW_KEY_NAME;this._flexChart.stacking=this._stacking;this._flexChart.tooltip.content=function(e){var t=e.name?"<b>"+e.name+"</b> <br/>":"";return t+=i._getLabel(e.x)+" "+i._getValue(e)};this._flexChart.hostElement.style.visibility="hidden"};PivotChart.prototype._createFlexPie=function(){var i=this,n=document.createElement("div");this.hostElement.appendChild(n);this._colMenu=new e.input.MultiSelect(n,{displayMemberPath:"text",placeholder:e.culture.olap.PivotPanel.cols,selectedValuePath:"prop",showSelectAllCheckbox:!0});this._colMenu.hostElement.style.visibility="hidden";this._colMenu.checkedItemsChanged.addHandler((function(e,t){return i._updateFlexPieBinding()}));var o=document.createElement("div");this.hostElement.appendChild(o);this._flexPie=new e.chart.FlexPie(o);this._flexPie.bindingName=t._PivotKey._ROW_KEY_NAME;this._flexPie.tooltip.content=function(e){return"<b>"+i._getLabel(i._dataItms[e.pointIndex][t._PivotKey._ROW_KEY_NAME])+"</b> <br/>"+i._getValue(e)};this._flexPie.rendering.addHandler(this._updatePieInfo,this)};PivotChart.prototype._updatePivotChart=function(){if(this._ng&&this._ng.pivotView){for(var e,i=[],n=[],o=[],r=0,s=this._ng.pivotView,l=this._ng.rowFields,a=0;a<s.items.length;a++){var d=s.items[a],u=d.$rowKey;0==a&&this._getColumns(d);if(i.length>=this._maxPoints)break;if(!this._isTotalRow(d[t._PivotKey._ROW_KEY_NAME])){i.push(d);n.push({value:i.length-1,text:this._getLabel(d[t._PivotKey._ROW_KEY_NAME])});for(var h=0;h<l.length;h++){o.length<=h&&o.push([]);if(this._getMergeIndex(u,e)<h){r=o[h].length-1;var c=o[h][r];0===r&&h<l.length-1&&(c.value=(c.width-1)/2);if(r>0&&h<l.length-1){var p=this._getOffsetWidth(o[h]);c.value=p+(c.width-1)/2}o[h].push({value:i.length-1,text:u.getValue(h,!0),width:1})}else{r=o[h].length-1;o[h][r].width++}}e=u}}for(h=0;h<l.length;h++)if(h<o.length){r=o[h].length-1;o[h][r].value=this._getOffsetWidth(o[h])+(o[h][r].width-1)/2}this._dataItms=i;this._lblsSrc=n;this._grpLblsSrc=o;this._updateFlexChartOrPie()}};PivotChart.prototype._updateFlexChartOrPie=function(){var e=this._isPieChart();!e&&this._flexChart?this._updateFlexChart(this._dataItms,this._lblsSrc,this._grpLblsSrc):e&&this._flexPie&&this._updateFlexPie(this._dataItms,this._lblsSrc)};PivotChart.prototype._updateFlexChart=function(t,i,n){var o,r=this._flexChart,s=r?r.hostElement:null;if(this._ng&&r&&s){r.beginUpdate();r.itemsSource=t;this._createSeries();r.series&&r.series.length>0&&t.length>0?s.style.visibility="visible":s.style.visibility="hidden";r.header=this.header||this._getChartTitle();this.headerStyle&&(r.headerStyle=this.headerStyle);this.footer&&(r.footer=this.footer);this.footerStyle&&(r.footerStyle=this.footerStyle);if(this._isRotatedChart()){if(this._showHierarchicalAxes&&n.length>0){r.axisY.itemsSource=n[n.length-1];r.axisX.labelAngle=void 0;if(n.length>=2)for(var l=n.length-2;l>=0;l--)this._createGroupAxes(n[l])}else{r.axisY.labelAngle=void 0;r.axisY.itemsSource=i}r.axisX.itemsSource=void 0}else{if(this._showHierarchicalAxes&&n.length>0){r.axisX.itemsSource=n[n.length-1];if(n.length>=2)for(l=n.length-2;l>=0;l--)this._createGroupAxes(n[l])}else{r.axisX.labelAngle=void 0;r.axisX.itemsSource=i}r.axisY.itemsSource=void 0}r.axisX.labelPadding=6;r.axisY.labelPadding=6;if(this._isRotatedChart()){o=r.axisX;r.axisY.reversed=!0}else{o=r.axisY;r.axisY.reversed=!1}r.stacking!==e.chart.Stacking.Stacked100pc&&this._ng.valueFields.length>0&&this._ng.valueFields[0].format?o.format=this._ng.valueFields[0].format:o.format="";r.legend.position=this._getLegendPosition();r.endUpdate()}};PivotChart.prototype._updateFlexPie=function(e,i){var n=this._flexPie,o=n?n.hostElement:null,r=this._colMenu;if(this._ng&&n&&o){this._colItms.length>0&&e.length>0?o.style.visibility="visible":o.style.visibility="hidden";n.beginUpdate();n.itemsSource=e;n.bindingName=t._PivotKey._ROW_KEY_NAME;this._colItms&&this._colItms.length>0&&(n.binding=this._colItms[0].prop);n.header=this.header||this._getChartTitle();this.headerStyle&&(n.headerStyle=this.headerStyle);this.footer&&(n.footer=this.footer);this.footerStyle&&(n.footerStyle=this.footerStyle);n.legend.position=this._getLegendPosition();n.endUpdate();var s=this._getTitle(this._ng.columnFields);""!==s&&(s="<b>"+s+": </b>");if(this._colItms&&this._colItms.length>1&&e.length>0){r.hostElement.style.visibility="visible";r.itemsSource=this._colItms;r.checkedItems=[this._colItms[0]];r.invalidate()}else r.hostElement.style.visibility="hidden"}};PivotChart.prototype._getLegendPosition=function(){var t=this.legendPosition;if(this.showLegend==n.Never)t=e.chart.Position.None;else if(this.showLegend==n.Auto&&this.flexChart&&this.flexChart.series){var i=0;this.flexChart.series.forEach((function(t){var n=t.visibility;t.name&&n!=e.chart.SeriesVisibility.Hidden&&n!=e.chart.SeriesVisibility.Plot&&i++}));i<2&&(t=e.chart.Position.None)}return t};PivotChart.prototype._createSeries=function(){this._flexChart&&(this._flexChart.series.length=0);for(var t=1==this._ng.valueFields.length,i=0;i<this._colItms.length;i++){var n=new e.chart.Series,o=this._colItms[i].prop,r=this._colItms[i].text;if(t){var s=r.lastIndexOf(";");s>-1&&(r=r.substr(0,s))}n.binding=o;n.name=r;this._flexChart.series.push(n)}};PivotChart.prototype._getColumns=function(e){var i,n=0;if(e){this._colItms=[];for(var o in e)if(e.hasOwnProperty(o)&&o!==t._PivotKey._ROW_KEY_NAME&&n<this._maxSeries&&this._isValidColumn(o)){i=this._ng._getKey(o);this._getLabel(i);this._colItms.push({prop:o,text:this._getLabel(i)});n++}}};PivotChart.prototype._createGroupAxes=function(t){var i,n=this,o=this._flexChart,r=this._isRotatedChart()?o.axisY:o.axisX;if(t){(i=new e.chart.Axis).labelAngle=0;i.labelPadding=6;i.position=this._isRotatedChart()?e.chart.Position.Left:e.chart.Position.Bottom;i.majorTickMarks=e.chart.TickMark.None;i.itemsSource=t;i.reversed=r.reversed;i.itemFormatter=function(e,o){if(i._axrect){var r=.5*t.filter((function(e){return e.value==o.val}))[0].width;if(n._isRotatedChart()){var s=i.reversed?-1:1,l=i.convert(o.val+r)+5*s,a=i.convert(o.val-r)-5*s,d=i._axrect.left+i._axrect.width-5;e.drawLine(d,l,d,a,PivotChart.HRHAXISCSS);e.drawLine(d,l,d+5,l,PivotChart.HRHAXISCSS);e.drawLine(d,a,d+5,a,PivotChart.HRHAXISCSS);e.drawLine(d,o.pos.y,d-5,o.pos.y,PivotChart.HRHAXISCSS)}else{var u=i.convert(o.val-r)+5,h=i.convert(o.val+r)-5,c=i._axrect.top;e.drawLine(u,c,h,c,PivotChart.HRHAXISCSS);e.drawLine(u,c,u,c-5,PivotChart.HRHAXISCSS);e.drawLine(h,c,h,c-5,PivotChart.HRHAXISCSS);e.drawLine(o.pos.x,c,o.pos.x,c+5,PivotChart.HRHAXISCSS)}}return o};i.min=r.actualMin;i.max=r.actualMax;r.rangeChanged.addHandler((function(){isNaN(i.min)&&isNaN(r.actualMin)||i.min==r.actualMin||(i.min=r.actualMin);isNaN(i.max)&&isNaN(r.actualMax)||i.max==r.actualMax||(i.max=r.actualMax)}));var s=new e.chart.Series;s.visibility=e.chart.SeriesVisibility.Hidden;this._isRotatedChart()?s.axisY=i:s.axisX=i;o.series.push(s)}};PivotChart.prototype._updateFlexPieBinding=function(){var e="",t=[];this._colMenu.checkedItems.forEach((function(i){e.length>0&&(e+=",");e+=i.prop;t.push(i.text)}));this._flexPie.binding=e;this._flexPie.titles=t.length>1?t:null};PivotChart.prototype._updatePieInfo=function(){var e=this;this._flexPie&&(this._flexPie._labels=this._flexPie._labels.map((function(t,i){return e._lblsSrc[i].text})))};PivotChart.prototype._changeChartType=function(){var t=null;if(this.chartType===i.Pie){this._flexPie||this._createFlexPie();this._updateFlexPie(this._dataItms,this._lblsSrc);this._swapChartAndPie(!1)}else{switch(this.chartType){case i.Column:t=e.chart.ChartType.Column;break;case i.Bar:t=e.chart.ChartType.Bar;break;case i.Scatter:t=e.chart.ChartType.Scatter;break;case i.Line:t=e.chart.ChartType.Line;break;case i.Area:t=e.chart.ChartType.Area}if(this._flexChart)"none"!==this._flexChart.hostElement.style.display&&t!==i.Bar&&this._flexChart.chartType!==e.chart.ChartType.Bar||this._updateFlexChart(this._dataItms,this._lblsSrc,this._grpLblsSrc);else{this._createFlexChart();this._updateFlexChart(this._dataItms,this._lblsSrc,this._grpLblsSrc)}this._flexChart.chartType=t;this._swapChartAndPie(!0)}};PivotChart.prototype._swapChartAndPie=function(e){var t=this;this._flexChart&&(this._flexChart.hostElement.style.display=e?"block":"none");this._flexPie&&(this._flexPie.hostElement.style.display=e?"none":"block");if(this._colMenu&&this._colMenu.hostElement){this._colMenu.hostElement.style.display=e?"none":"block";this._colMenu.hostElement.style.top="0";setTimeout((function(){t._colMenu.hostElement.style.top=""}),0)}};PivotChart.prototype._getLabel=function(e){var t="";if(!e||!e.values)return t;var i=e.valueFields?e.valueField:null;switch(e.values.length){case 0:i&&(t+=i.header);break;case 1:t+=e.getValue(0,!0);i&&(t+="; "+i.header);break;default:for(var n=0;n<e.values.length;n++){n>0&&(t+="; ");t+=e.getValue(n,!0)}i&&(t+="; "+i.header)}return t};PivotChart.prototype._getValue=function(t){var i=this._ng.valueFields,n=t.series?t.series.chart.series.indexOf(t.series):0,o=n<i.length?i[n].format:i.length?i[0].format:"";return o?e.Globalize.format(t.y,o):t._yfmt};PivotChart.prototype._getChartTitle=function(){if(!this.showTitle||!this._ng.valueFields.length)return null;var t=this._ng,i=this._getTitle(t.valueFields),n=this._getTitle(t.rowFields),o=this._getTitle(t.columnFields),r=i,s=e.culture.olap.PivotChart;if(i&&this._dataItms.length>0){n&&(r+=e.format(" {by} {rows}",{by:s.by,rows:n}));o&&(r+=e.format(" {and} {cols}",{and:n?s.and:s.by,cols:o}))}return r};PivotChart.prototype._getTitle=function(e){for(var t="",i=0;i<e.length;i++){t.length>0&&(t+="; ");t+=e[i].header}return t};PivotChart.prototype._isValidColumn=function(e){var t=e.split(";"),i=this._showTotals;return 0===this._ng.columnFields.length||(t&&2===t.length?i:!(!t||t.length-2!==this._ng.columnFields.length)&&!i)};PivotChart.prototype._isTotalRow=function(e){return e.values.length<this._ng.rowFields.length};PivotChart.prototype._isPieChart=function(){return this._chartType==i.Pie};PivotChart.prototype._isRotatedChart=function(){return!this._isPieChart()&&this._chartType==i.Bar!==this._flexChart.rotated};PivotChart.prototype._getMergeIndex=function(e,t){var i=-1;if(null!=e&&null!=t&&e.values.length==t.values.length&&e.values.length==e.fields.length&&t.values.length==t.fields.length)for(var n=0;n<e.values.length;n++){if(e.getValue(n,!0)!=t.getValue(n,!0))return i;i=n}return i};PivotChart.prototype._getOffsetWidth=function(e){var t=0;if(e.length<=1)return t;for(var i=0;i<e.length-1;i++)t+=e[i].width;return t};PivotChart.MAX_SERIES=100;PivotChart.MAX_POINTS=100;PivotChart.HRHAXISCSS="wj-hierarchicalaxes-line";return PivotChart}(e.Control);t.PivotChart=o}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(){function _MdxQueryBuilder(e,t){this._ng=null;this._cubeName=null;this._ng=e;this._cubeName=t}_MdxQueryBuilder.prototype.buildQuery=function(){var e=new t._TextBuilder,i=this.buildWhereSection(this._ng.valueFields);e.append("SELECT ",this.buildAxes()," FROM ",this.buildCubeName(),i);e.append(" CELL PROPERTIES VALUE, FORMAT_STRING");return e.toString()};_MdxQueryBuilder.prototype.buildWhereSection=function(e){var i=new t._TextBuilder;if(1==e.length){i.append(this.buildSetForMeasuresShelf(e));i.wrap(" WHERE ","")}return i.toString()};_MdxQueryBuilder.prototype.buildCubeName=function(){var e=new t._TextBuilder;e.append(this.buildSubcubeExpression());var i=e.length>0;i&&e.wrap("SELECT "," FROM ");e.append("[",this._cubeName,"]");i&&e.wrap("(",")");return e.toString()};_MdxQueryBuilder.prototype.buildSubcubeExpression=function(){var e=new t._TextBuilder,i=this.getMeasureFilterExpressions(this._ng.valueFields),n=this.buildFilterAttributeSet(this._ng.filterFields),o=this.buildFilterAttributeSet(this._ng.rowFields,i),r=this.buildFilterAttributeSet(this._ng.columnFields,0==o.length?i:null);e.joinItemToList(n);e.joinItemToList(o);e.joinItemToList(r);if(e.length>0){e.wrap("(",")");e.append(" ON COLUMNS")}return e.toString()};_MdxQueryBuilder.prototype.buildFilterAttributeSet=function(e,i){for(var n=new t._TextBuilder,o=0;o<e.length;o++){var r=e[o],s=this.buildFilterString(r,0==o?i:null);n.joinItemToList(s)}return n.toString()};_MdxQueryBuilder.prototype.buildFilterString=function(e,i){var n=new t._TextBuilder;e.filter.isActive?e.filter.conditionFilter.isActive?n.append(this.getConditionFilterString(e,i)):e.filter.valueFilter.isActive&&n.append(this.getValueFilterString(e)):i&&n.append(this.getConditionFilterString(e,i));return n.toString()};_MdxQueryBuilder.prototype.getValueFilterString=function(e){var i=new t._TextBuilder,n=e.filter.valueFilter,o=Object.keys(n.showValues).map((function(t){return e.key+".["+t+"]"}));i.append(o.join(","));i.length>0&&i.wrap("{","}");return i.toString()};_MdxQueryBuilder.prototype.getConditionFilterString=function(e,i){var n=new t._TextBuilder,o=e.key+".LEVELS(1).ALLMEMBERS",r=e.filter.conditionFilter.condition1,s=e.filter.conditionFilter.condition2;if(r.isActive){n.append(this.getConditionFilterExpression(e,r));s.isActive&&n.append(e.filter.conditionFilter.and?" AND ":" OR ")}s.isActive&&n.append(this.getConditionFilterExpression(e,s));if(i&&i.length>0){n.length>0&&n.append(" AND ");n.append(i.join(" AND "))}n.length>0&&n.wrap("Filter("+o+",(","))");return n.toString()};_MdxQueryBuilder.prototype.getMeasureFilterExpressions=function(e){for(var i=[],n=0;n<e.length;n++){var o=new t._TextBuilder,r=e[n],s=(r.dimensionType,t.DimensionType.Measure,r.filter.conditionFilter.condition1),l=r.filter.conditionFilter.condition2;if(s.isActive){o.append(this.getConditionFilterExpression(r,s));l.isActive&&o.append(r.filter.conditionFilter.and?" AND ":" OR ")}l.isActive&&o.append(this.getConditionFilterExpression(r,l));if(o.length>0){o.wrap("(",")");i.push(o.toString())}}return i};_MdxQueryBuilder.prototype.getConditionFilterExpression=function(i,n){if(!n.isActive)return"";var o=i.dimensionType==t.DimensionType.Measure,r=i.dataType==e.DataType.Number,s=i.dataType==e.DataType.Date,l=r||s?"member_value":"member_caption",a=o?i.key:i.key+".CurrentMember."+l,d=s?"CDate('"+e.Globalize.formatDate(n.value,"d")+"')":n.value.toString(),u=new t._TextBuilder;switch(n.operator){case e.grid.filter.Operator.BW:u.append("(Left(",a,",",d.length.toString(),')="',d,'")');break;case e.grid.filter.Operator.EW:u.append("(Right(",a,",",d.length.toString(),')="',d,'")');break;case e.grid.filter.Operator.EQ:o||r||s?u.append("(",a,")=",d):u.append("(",a,')="',d,'"');break;case e.grid.filter.Operator.NE:o||r||s?u.append("(",a,")<>",d):u.append("(",a,')<>"',d,'"');break;case e.grid.filter.Operator.CT:u.append("(InStr(1,",a,',"',d,'")>0)');break;case e.grid.filter.Operator.NC:u.append("(InStr(1,",a,',"',d,'")=0))');break;case e.grid.filter.Operator.GT:u.append("(",a,")>",d);break;case e.grid.filter.Operator.LT:u.append("(",a,")<",d);break;case e.grid.filter.Operator.GE:u.append("(",a,")>=",d);break;case e.grid.filter.Operator.LE:u.append("(",a,")<=",d)}return u.toString()};_MdxQueryBuilder.prototype.buildAxes=function(){var e=new t._TextBuilder,i=this.buildSetForAttributesShelf(this._ng.rowFields);e.joinItemToList(i);this._ng.rowFields.length>0&&(this._ng.columnFields.length>0||this._ng.valueFields.length>1?e.append(" ON ROWS"):e.append(" ON COLUMNS"));i=this.buildSetForAttributesColumnShelf(this._ng.columnFields);e.joinItemToList(i);this._ng.columnFields.length>0&&e.append(" ON COLUMNS");if(this._ng.valueFields.length>1&&0==this._ng.columnFields.length){i=this.buildSetForMeasuresShelf(this._ng.valueFields);e.joinItemToList(i);e.append(" ON COLUMNS")}return e.toString()};_MdxQueryBuilder.prototype.buildSetForAttributesShelf=function(e){for(var i=new t._TextBuilder,n=0;n<e.length;n++){var o=e[n];o.dimensionType!=t.DimensionType.Attribute&&o.dimensionType!=t.DimensionType.Hierarchy||i.joinItemToList(this.buildAttributeSetForAxis(o));n>0&&i.wrap("CrossJoin(",")")}i.wrap("NON EMPTY ","");return i.toString()};_MdxQueryBuilder.prototype.buildSetForAttributesColumnShelf=function(e){for(var i=new t._TextBuilder,n=0;n<e.length;n++){var o=e[n];o.dimensionType!=t.DimensionType.Attribute&&o.dimensionType!=t.DimensionType.Hierarchy||i.joinItemToList(this.buildAttributeSetForAxis(o))}this._ng.valueFields.length>1&&e.length>0&&i.joinItemToList(this.buildSetForMeasuresShelf(this._ng.valueFields));(this._ng.valueFields.length>1&&e.length>0||e.length>1)&&i.wrap("CrossJoin(",")");i.wrap("NON EMPTY ","");return i.toString()};_MdxQueryBuilder.prototype.buildSetForMeasuresShelf=function(e){for(var i=new t._TextBuilder,n=0;n<e.length;n++){var o=e[n];o.dimensionType!=t.DimensionType.Measure&&o.dimensionType!=t.DimensionType.Kpi||i.joinItemToList(this.buildMeasureSetForAxis(o))}i.wrap("{","}");return i.toString()};_MdxQueryBuilder.prototype.buildAttributeSetForAxis=function(e){var i=new t._TextBuilder;if(e.dimensionType==t.DimensionType.Hierarchy){i.append(e.key);i.append(".ALLMEMBERS");i.wrap("{","}");i.wrap("HIERARCHIZE(",")")}return i.toString()};_MdxQueryBuilder.prototype.buildMeasureSetForAxis=function(e){var i=new t._TextBuilder;e.dimensionType!=t.DimensionType.Measure&&e.dimensionType!=t.DimensionType.Kpi||i.append(e.key);return i.toString()};return _MdxQueryBuilder}();t._MdxQueryBuilder=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(i){__extends(_SqlServerConnection,i);function _SqlServerConnection(t,n){var o=i.call(this,t,n.url)||this;o._jsonResult=null;o._dataTypes=null;o._debug=!1;e.assert(e.isString(n.cube)&&!e.isNullOrWhiteSpace(n.cube),"Cube name required.");o._cubeName=n.cube;o._catalogName=e.isString(n.catalog)&&!e.isNullOrWhiteSpace(n.catalog)?n.catalog:"";o._url=n.url;o._user=n.user;o._password=n.password;return o}_SqlServerConnection.prototype.getFields=function(){this._getSession();this._jsonResult=null;this._dataTypes=null;this._getProperties(this._token);this._getDimensions(this._token);this._endSession();return this._jsonResult};_SqlServerConnection.prototype.getOutputView=function(i){var n=this;this._ng.onUpdatingView(new t.ProgressEventArgs(0));var o=new t._MdxQueryBuilder(this._ng,this._cubeName).buildQuery();this._jsonResult=[];this._getSession();this._execQuery(this._token,o,(function(o){e.asFunction(i)(n._jsonResult);n._ng.onUpdatedView(new t.ProgressEventArgs(100))}))};_SqlServerConnection.prototype.getDetail=function(e,t){throw"getDetail method not supported"};_SqlServerConnection.prototype._getSession=function(){var t=this,i=this._url;return e.httpRequest(i,{async:!1,data:n,method:"POST",user:this._user,password:this._password,requestHeaders:{"Content-Type":"text/xml"},success:function(e){var i=e.responseXML.getElementsByTagName("Session");t._token=i[0].getAttribute("SessionId")},error:function(e){t._handleError("Begin Session",e)}})};_SqlServerConnection.prototype._endSession=function(){var t=this,i=this._url;return e.httpRequest(i,{async:!1,data:_ENV_ENDSESSION(this._token),method:"POST",user:this._user,password:this._password,requestHeaders:{"Content-Type":"text/xml"},error:function(e){t._handleError("End Session",e)},complete:function(e){t._token=void 0}})};_SqlServerConnection.prototype._getProperties=function(t){var i=this,n=this._url;return e.httpRequest(n,{async:!1,data:_ENV_PROPERTIES(t,this._catalogName,this._cubeName),method:"POST",user:this._user,password:this._password,requestHeaders:{"Content-Type":"text/xml"},success:function(t){for(var n={},o=t.responseXML.getElementsByTagName("row"),r=0;r<o.length;r++){var s=_getTagValue(o[r],"HIERARCHY_UNIQUE_NAME");switch(Number(_getTagValue(o[r],"DATA_TYPE"))){case 2:case 3:case 4:case 5:case 6:n[s]=e.DataType.Number;break;case 7:n[s]=e.DataType.Date}}i._dataTypes=n},error:function(e){i._handleError("Get Properties",e)}})};_SqlServerConnection.prototype._getDimensions=function(i){var n=this,o=this._url;return e.httpRequest(o,{async:!1,data:_ENV_DIMENSIONS(i,this._catalogName,this._cubeName),method:"POST",user:this._user,password:this._password,requestHeaders:{"Content-Type":"text/xml"},success:function(o){for(var r=[],s=o.responseXML.getElementsByTagName("row"),l=0;l<s.length;l++){if("2"!==_getTagValue(s[l],"DIMENSION_TYPE")){var a=_getTagValue(s[l],"DIMENSION_UNIQUE_NAME"),d={header:_getTagValue(s[l],"DIMENSION_CAPTION"),dataType:e.DataType.Object,dimensionType:t.DimensionType.Dimension,subFields:[]};n._getSubFolders(i,a,d);r.push(d)}else n._getMeasures(i,r)}var u={header:"KPIs",dataType:e.DataType.Object,dimensionType:t.DimensionType.Kpi,subFields:[]};n._getKPIs(i,u);r.push(u);n._jsonResult=r},error:function(e){n._handleError("Get Dimensions",e)}})};_SqlServerConnection.prototype._getSubFolders=function(i,n,o){var r=this,s=this._url;e.httpRequest(s,{async:!1,data:_ENV_HIERARCHIES(i,this._catalogName,this._cubeName,n),method:"POST",user:this._user,password:this._password,requestHeaders:{"Content-Type":"text/xml"},success:function(i){for(var n=i.responseXML.getElementsByTagName("row"),s=0;s<n.length;s++){var l={header:_getTagValue(n[s],"HIERARCHY_NAME"),binding:_getTagValue(n[s],"HIERARCHY_UNIQUE_NAME"),dataType:e.DataType.String,dimensionType:t.DimensionType.Hierarchy};r._dataTypes[l.binding]&&(l.dataType=r._dataTypes[l.binding]);for(var a=_getTagValue(n[s],"HIERARCHY_DISPLAY_FOLDER").split("\\"),d=o,u=0;u<a.length;u++)if(""!=a[u]){var h={header:a[u],dataType:e.DataType.Object,dimensionType:t.DimensionType.Folder,subFields:[]};if(_containsFolder(d,a[u]))d=_findSubFieldByName(d,a[u]);else{d.subFields.push(h);d=h}}d.subFields.push(l)}},error:function(e){r._handleError("Get Hierarchies",e)}})};_SqlServerConnection.prototype._getMeasures=function(i,n){var o=this,r=this._url;return e.httpRequest(r,{async:!1,data:_ENV_MEASURES(i,this._catalogName,this._cubeName),method:"POST",user:this._user,password:this._password,requestHeaders:{"Content-Type":"text/xml"},success:function(i){for(var o=i.responseXML.getElementsByTagName("row"),r={},s=0;s<o.length;s++){var l=_getTagValue(o[s],"MEASUREGROUP_NAME"),a={header:_getTagValue(o[s],"MEASURE_CAPTION"),binding:_getTagValue(o[s],"MEASURE_UNIQUE_NAME"),dataType:e.DataType.Number,dimensionType:t.DimensionType.Measure};if(Object.keys(r).indexOf(l)<0){var d={header:l,dataType:e.DataType.Number,dimensionType:t.DimensionType.Measure,subFields:[]};d.subFields.push(a);n.push(d);r[l]=d}else r[l].subFields.push(a)}},error:function(e){o._handleError("Get Measures",e)}})};_SqlServerConnection.prototype._getKPIs=function(i,n){var o=this,r=this._url;return e.httpRequest(r,{async:!1,data:_ENV_KPIS(i,this._catalogName,this._cubeName),method:"POST",user:this._user,password:this._password,requestHeaders:{"Content-Type":"text/xml"},success:function(i){for(var o=i.responseXML.getElementsByTagName("row"),r=0;r<o.length;r++){for(var s=_getTagValue(o[r],"KPI_DISPLAY_FOLDER").split("\\"),l=n,a=0;a<s.length;a++){var d={header:s[a],dataType:e.DataType.Object,dimensionType:t.DimensionType.Folder,subFields:[]};if(_containsFolder(l,s[a]))l=_findSubFieldByName(l,s[a]);else{l.subFields.push(d);l=d}}var u={header:_getTagValue(o[r],"KPI_CAPTION"),binding:_getTagValue(o[r],"KPI_VALUE"),dataType:e.DataType.Number,dimensionType:t.DimensionType.Kpi};l.subFields.push(u)}},error:function(e){o._handleError("Get KPIs",e)}})};_SqlServerConnection.prototype._execQuery=function(t,i,n){var o=this,r=this._url;return e.httpRequest(r,{async:!0,data:_ENV_QUERY(t,this._catalogName,i),method:"POST",user:this._user,password:this._password,requestHeaders:{"Content-Type":"text/xml"},success:function(t){var r=t.responseXML,s=r.querySelector("Error");if(s){throw"SSAS Error\r\n"+s.getAttribute("Description")+"\r\n"+i}o._createPivotKeys(r);e.asFunction(n)(t)},error:function(e){o._handleError("Execute Query",e)},complete:function(){o._endSession()}})};_SqlServerConnection.prototype._createPivotKeys=function(e){var t=null,i=null,n=e.querySelector("CellData");if(this._ng.columnFields.length>0||this._ng.valueFields.length>1){i=e.querySelector("Axis[name='Axis0']");this._ng.rowFields.length>0&&(t=e.querySelector("Axis[name='Axis1']"))}else this._ng.rowFields.length>0&&(t=e.querySelector("Axis[name='Axis0']"));var o=t&&this._ng.rowFields.length>0,r=i&&this._ng.columnFields.length>0;o&&r?this._createRowKeys(n,t,i):o?this._createRowOnlyKeys(n,t):r&&this._createColumnOnlyKeys(n,i)};_SqlServerConnection.prototype._createRowKeys=function(e,i,n){for(var o=i.getElementsByTagName("Tuple"),r=n.getElementsByTagName("Tuple"),s=this._ng.showRowTotals!==t.ShowTotals.None?0:1,l=this._ng.showColumnTotals!==t.ShowTotals.None?0:this._ng.valueFields.length,a=s;a<o.length;a++){var d=a*r.length,u=o[a],h=this._validateTuple(u,this._ng.showRowTotals);if(h)for(var c=l;c<r.length;c++){var p=r[c],g=this._validateTuple(p,this._ng.showColumnTotals);if(g){for(var _ in h)g[_]=h[_];for(var f=0;f<this._ng.valueFields.length;f++){g[this._ng.valueFields[f].key]=_getCellValue(e,d+c+f)}this._jsonResult.push(g)}}}};_SqlServerConnection.prototype._createRowOnlyKeys=function(e,i){for(var n=i.getElementsByTagName("Tuple"),o=this._ng.valueFields.length,r=this._ng.showRowTotals!==t.ShowTotals.None?0:1,s=r*o,l=r;l<n.length;l++){var a=n[l],d=this._validateTuple(a,this._ng.showRowTotals);if(d){for(var u=0;u<this._ng.valueFields.length;u++){d[this._ng.valueFields[u].key]=_getCellValue(e,s++)}this._jsonResult.push(d)}}};_SqlServerConnection.prototype._createColumnOnlyKeys=function(e,i){for(var n=i.getElementsByTagName("Tuple"),o=this._ng.valueFields.length,r=this._ng.showColumnTotals!==t.ShowTotals.None?0:1,s=r;s<n.length;s+=o){var l=n[s],a=this._validateTuple(l,this._ng.showColumnTotals);if(a){for(var d=0;d<this._ng.valueFields.length;d++){a[this._ng.valueFields[d].key]=_getCellValue(e,s-r+d)}this._jsonResult.push(a)}}};_SqlServerConnection.prototype._validateTuple=function(e,i){for(var n,o=e.getElementsByTagName("Member"),r=void 0,s={},l=0;l<o.length;l++){var a=o[l],d=_getLevelNumber(a),u=a.getAttribute("Hierarchy"),h=_getLevelNumber(n=a)>0?_getTagValue(n,"Caption"):null;if(0==l)r=d;else{if(d>r)return null;if(i!==t.ShowTotals.Subtotals&&d!==r&&"[Measures]"!==u)return null;r=d}u.indexOf(".")>=0?s[u]=h:null!==h&&(s[h]=null)}return s};return _SqlServerConnection}(t._ServerConnection);t._SqlServerConnection=i;function _getTagValue(e,t){var i=e.querySelector(t);return i?i.innerHTML||i.textContent:null}function _getLevelNumber(e){return Number(_getTagValue(e,"LNum"))}function _getCellValue(e,t){var i="Cell[CellOrdinal='"+t.toString()+"']",n=e.querySelector(i);if(n){var o=_getTagValue(n,"Value");if(o)return Number(o)}return null}function _findSubFieldByName(e,t){if(e.subFields)for(var i=0;i<e.subFields.length;i++){var n=e.subFields[i];if(n.header==t)return n}return e}function _containsFolder(e,t){if(e.subFields)for(var i=0;i<e.subFields.length;i++){if(e.subFields[i].header==t)return!0}return!1}var n='\n    <Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">\n        <Header>\n            <BeginSession soap:mustUnderstand="1" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns="urn:schemas-microsoft-com:xml-analysis" />\n        </Header>\n        <Body>\n            <Execute xmlns="urn:schemas-microsoft-com:xml-analysis">\n                <Command>\n                    <Statement />\n                </Command>\n                <Properties>\n                </Properties>\n            </Execute>\n        </Body>\n    </Envelope>',_ENV_ENDSESSION=function(e){return'\n    <Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">\n        <Header>\n            <XA:EndSession soap:mustUnderstand="1" SessionId="'+e+'" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:XA="urn:schemas-microsoft-com:xml-analysis" />\n        </Header>\n        <Body>\n            <Execute xmlns="urn:schemas-microsoft-com:xml-analysis">\n                <Command>\n                    <Statement />\n                </Command>\n                <Properties>\n                </Properties>\n            </Execute>\n        </Body>\n    </Envelope>'},_ENV_DIMENSIONS=function(e,t,i){return'\n    <Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">\n        <Header>\n            <XA:Session soap:mustUnderstand="1" SessionId="'+e+'" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:XA="urn:schemas-microsoft-com:xml-analysis" />\n        </Header>\n        <Body>\n            <Discover xmlns="urn:schemas-microsoft-com:xml-analysis">\n                <RequestType>MDSCHEMA_DIMENSIONS</RequestType>\n                <Restrictions>\n                    <RestrictionList>\n                        <CATALOG_NAME>'+t+"</CATALOG_NAME>\n                        <CUBE_NAME>"+i+"</CUBE_NAME>\n                    </RestrictionList>\n                </Restrictions>\n                <Properties>\n                </Properties>\n            </Discover>\n        </Body>\n    </Envelope>"},_ENV_HIERARCHIES=function(e,t,i,n){return'\n    <Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">\n        <Header>\n            <XA:Session soap:mustUnderstand="1" SessionId="'+e+'" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:XA="urn:schemas-microsoft-com:xml-analysis" />\n        </Header>\n        <Body>\n            <Discover xmlns="urn:schemas-microsoft-com:xml-analysis">\n                <RequestType>MDSCHEMA_HIERARCHIES</RequestType>\n                <Restrictions>\n                    <RestrictionList>\n                        <CATALOG_NAME>'+t+"</CATALOG_NAME>\n                        <CUBE_NAME>"+i+"</CUBE_NAME>\n                        <DIMENSION_UNIQUE_NAME>"+n+"</DIMENSION_UNIQUE_NAME>\n                    </RestrictionList>\n                </Restrictions>\n                <Properties>\n                </Properties>\n            </Discover>\n        </Body>\n    </Envelope>"},_ENV_MEASURES=function(e,t,i){return'\n    <Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">\n        <Header>\n            <XA:Session soap:mustUnderstand="1" SessionId="'+e+'" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:XA="urn:schemas-microsoft-com:xml-analysis" />\n        </Header>\n        <Body>\n            <Discover xmlns="urn:schemas-microsoft-com:xml-analysis">\n                <RequestType>MDSCHEMA_MEASURES</RequestType>\n                <Restrictions>\n                    <RestrictionList>\n                        <CATALOG_NAME>'+t+"</CATALOG_NAME>\n                        <CUBE_NAME>"+i+"</CUBE_NAME>\n                    </RestrictionList>\n                </Restrictions>\n                <Properties>\n                </Properties>\n            </Discover>\n        </Body>\n    </Envelope>"},_ENV_KPIS=function(e,t,i){return'\n    <Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">\n        <Header>\n            <XA:Session soap:mustUnderstand="1" SessionId="'+e+'" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:XA="urn:schemas-microsoft-com:xml-analysis" />\n        </Header>\n        <Body>\n            <Discover xmlns="urn:schemas-microsoft-com:xml-analysis">\n                <RequestType>MDSCHEMA_KPIS</RequestType>\n                <Restrictions>\n                    <RestrictionList>\n                        <CATALOG_NAME>'+t+"</CATALOG_NAME>\n                        <CUBE_NAME>"+i+"</CUBE_NAME>\n                    </RestrictionList>\n                </Restrictions>\n                <Properties>\n                </Properties>\n            </Discover>\n        </Body>\n    </Envelope>"},_ENV_PROPERTIES=function(e,t,i){return'\n    <Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">\n        <Header>\n            <XA:Session soap:mustUnderstand="1" SessionId="'+e+'" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:XA="urn:schemas-microsoft-com:xml-analysis" />\n        </Header>\n        <Body>\n            <Discover xmlns="urn:schemas-microsoft-com:xml-analysis">\n                <RequestType>MDSCHEMA_PROPERTIES</RequestType>\n                <Restrictions>\n                    <RestrictionList>\n                        <CATALOG_NAME>'+t+"</CATALOG_NAME>\n                        <CUBE_NAME>"+i+"</CUBE_NAME>\n                        <PROPERTY_NAME>MEMBER_VALUE</PROPERTY_NAME>\n                    </RestrictionList>\n                </Restrictions>\n                <Properties>\n                </Properties>\n            </Discover>\n        </Body>\n    </Envelope>"},_ENV_QUERY=function(e,t,i){return'\n    <Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">\n        <Header>\n            <XA:Session soap:mustUnderstand="1" SessionId="'+e+'" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:XA="urn:schemas-microsoft-com:xml-analysis" />\n        </Header>\n        <Body>\n            <Execute xmlns="urn:schemas-microsoft-com:xml-analysis">\n                <Command>\n                    <Statement>\n                        <![CDATA[\n                        '+i+"\n                        ]]>\n                    </Statement>\n                </Command>\n                <Properties>\n                    <PropertyList>\n                        <Catalog>"+t+"</Catalog>\n                        <Content>Data</Content>\n                    </PropertyList>\n                </Properties>\n            </Execute>\n        </Body>\n    </Envelope>"}}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(){function PivotFilter(t){this._fld=t;var i=t;this._valueFilter=new e.grid.filter.ValueFilter(i);this._valueFilter.exclusiveValueSearch=this._fld.engine.exclusiveValueSearch;this._conditionFilter=new e.grid.filter.ConditionFilter(i)}Object.defineProperty(PivotFilter.prototype,"filterType",{get:function(){return null!=this._filterType?this._filterType:this._fld.engine.defaultFilterType},set:function(t){if((t=e.asEnum(t,e.grid.filter.FilterType,!0))!=this._filterType){this._filterType=t;this.clear()}},enumerable:!0,configurable:!0});PivotFilter.prototype.apply=function(e){return this._conditionFilter.apply(e)&&this._valueFilter.apply(e)};Object.defineProperty(PivotFilter.prototype,"isActive",{get:function(){return this._conditionFilter.isActive||this._valueFilter.isActive},enumerable:!0,configurable:!0});PivotFilter.prototype.clear=function(){var t=!1;if(this._valueFilter.isActive){this._valueFilter.clear();t=!0}if(this._conditionFilter.isActive){this._valueFilter.clear();t=!0}t&&this._fld.onPropertyChanged(new e.PropertyChangedEventArgs("filter",null,null))};Object.defineProperty(PivotFilter.prototype,"valueFilter",{get:function(){return this._valueFilter},enumerable:!0,configurable:!0});Object.defineProperty(PivotFilter.prototype,"conditionFilter",{get:function(){return this._conditionFilter},enumerable:!0,configurable:!0});return PivotFilter}();t.PivotFilter=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(t){__extends(PivotFilterEditor,t);function PivotFilterEditor(i,n,o){var r=t.call(this,i)||this;r.finishEditing=new e.Event;r.hostElement.tabIndex=-1;var s=r.getTemplate();r.applyTemplate("wj-control wj-content wj-pivotfiltereditor",s,{_divType:"div-type",_aVal:"a-val",_aCnd:"a-cnd",_divEdtVal:"div-edt-val",_divEdtCnd:"div-edt-cnd",_btnOk:"btn-ok"});e.setText(r._aVal,e.culture.FlexGridFilter.values);e.setText(r._aCnd,e.culture.FlexGridFilter.conditions);e.setText(r._btnOk,e.culture.olap.PivotFieldEditor.ok);var l=r._btnClicked.bind(r);r.addEventListener(r._btnOk,"click",l);r.addEventListener(r._aVal,"click",l);r.addEventListener(r._aCnd,"click",l);r.addEventListener(r.hostElement,"keydown",(function(t){switch(t.keyCode){case e.Key.Enter:switch(t.target.tagName){case"A":case"BUTTON":r._btnClicked(t);break;default:r.onFinishEditing(new e.CancelEventArgs)}t.preventDefault();break;case e.Key.Escape:r.onFinishEditing(new e.CancelEventArgs);t.preventDefault();break;case e.Key.Tab:e.moveFocus(r.hostElement,t.shiftKey?-1:1);t.preventDefault()}}));r._fld=n;r._uniqueValues=n.filter.valueFilter.uniqueValues;r.initialize(o);r.updateEditor();return r}Object.defineProperty(PivotFilterEditor.prototype,"field",{get:function(){return this._fld},enumerable:!0,configurable:!0});Object.defineProperty(PivotFilterEditor.prototype,"filter",{get:function(){return this._fld?this._fld.filter:null},enumerable:!0,configurable:!0});Object.defineProperty(PivotFilterEditor.prototype,"isEditorClear",{get:function(){switch(this._getFilterType()){case e.grid.filter.FilterType.Value:return!this._edtVal||this._edtVal.isEditorClear;case e.grid.filter.FilterType.Condition:return!this._edtCnd||this._edtCnd.isEditorClear}e.assert(!1,"unknown filter type?");return!1},enumerable:!0,configurable:!0});PivotFilterEditor.prototype.updateEditor=function(){var t=e.grid.filter.FilterType.None;if(this.filter){t=this.filter.conditionFilter.isActive||0==(this.filter.filterType&e.grid.filter.FilterType.Value)?e.grid.filter.FilterType.Condition:e.grid.filter.FilterType.Value;this._showFilter(t)}if(this._edtVal){var i=this._fld,n=i.engine;if(n.isServer&&!this._uniqueValues){var o=n._getUniqueValues(i);i.filter.valueFilter.uniqueValues=o}this._edtVal.updateEditor()}this._edtCnd&&this._edtCnd.updateEditor()};PivotFilterEditor.prototype.updateFilter=function(){switch(this._getFilterType()){case e.grid.filter.FilterType.Value:this._edtVal.updateFilter();this.filter.conditionFilter.clear();break;case e.grid.filter.FilterType.Condition:this._edtCnd.updateFilter();this.filter.valueFilter.clear()}this.field.onPropertyChanged(new e.PropertyChangedEventArgs("filter",null,null))};PivotFilterEditor.prototype.clearEditor=function(){this._edtVal&&this._edtVal.clearEditor();this._edtCnd&&this._edtCnd.clearEditor()};PivotFilterEditor.prototype.onFinishEditing=function(e){this.finishEditing.raise(this,e);return!e.cancel};PivotFilterEditor.prototype._showFilter=function(t){t==e.grid.filter.FilterType.Value&&null==this._edtVal&&(this._edtVal=new e.grid.filter.ValueFilterEditor(this._divEdtVal,this.filter.valueFilter));t==e.grid.filter.FilterType.Condition&&null==this._edtCnd&&(this._edtCnd=new e.grid.filter.ConditionFilterEditor(this._divEdtCnd,this.filter.conditionFilter));if(0!=(t&this.filter.filterType))if(t==e.grid.filter.FilterType.Value){this._divEdtVal.style.display="";this._divEdtCnd.style.display="none";this._enableLink(this._aVal,!1);this._enableLink(this._aCnd,!0)}else{this._divEdtVal.style.display="none";this._divEdtCnd.style.display="";this._enableLink(this._aVal,!0);this._enableLink(this._aCnd,!1)}switch(this.filter.filterType){case e.grid.filter.FilterType.None:case e.grid.filter.FilterType.Condition:case e.grid.filter.FilterType.Value:this._divType.style.display="none";break;default:this._divType.style.display=""}};PivotFilterEditor.prototype._enableLink=function(t,i){t.style.textDecoration=i?"":"none";t.style.fontWeight=i?"":"bold";e.setAttribute(t,"href",i?"":null)};PivotFilterEditor.prototype._getFilterType=function(){var t=e.grid.filter.FilterType;return"none"!=this._divEdtVal.style.display?t.Value:t.Condition};PivotFilterEditor.prototype._btnClicked=function(t){t.preventDefault();t.stopPropagation();if(!e.hasClass(t.target,"wj-state-disabled"))if(t.target!=this._aVal)if(t.target!=this._aCnd)this.onFinishEditing(new e.CancelEventArgs);else{this._showFilter(e.grid.filter.FilterType.Condition);e.moveFocus(this._edtCnd.hostElement,0)}else{this._showFilter(e.grid.filter.FilterType.Value);e.moveFocus(this._edtVal.hostElement,0)}};PivotFilterEditor.controlTemplate='<div><div wj-part="div-type" style="text-align:center;margin-bottom:12px;font-size:80%"><a wj-part="a-cnd" href="" tabindex="-1" draggable="false"></a>&nbsp;|&nbsp;<a wj-part="a-val" href="" tabindex="-1" draggable="false"></a></div><div wj-part="div-edt-val" tabindex="-1"></div><div wj-part="div-edt-cnd" tabindex="-1"></div><div style="text-align:right;margin-top:10px"><button wj-part="btn-ok" class="wj-btn"></button></div></div>';return PivotFilterEditor}(e.Control);t.PivotFilterEditor=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){!function(t){"use strict";var i=function(i){__extends(PivotFieldEditor,i);function PivotFieldEditor(t,n){var o=i.call(this,t,null,!0)||this;o.hostElement.tabIndex=-1;var r=o.getTemplate();o.applyTemplate("wj-control wj-pivotfieldeditor",r,{_dBnd:"sp-bnd",_dHdr:"div-hdr",_dAgg:"div-agg",_dShw:"div-shw",_dWFl:"div-wfl",_dSrt:"div-srt",_btnFltEdt:"btn-flt-edt",_btnFltClr:"btn-flt-clr",_dFmt:"div-fmt",_dSmp:"div-smp",_btnApply:"btn-apply",_btnCancel:"btn-cancel",_gDlg:"g-dlg",_gHdr:"g-hdr",_gAgg:"g-agg",_gShw:"g-shw",_gWfl:"g-wfl",_gSrt:"g-srt",_gFlt:"g-flt",_gFmt:"g-fmt",_gSmp:"g-smp"});o._pvDate=new Date;var s=e.culture.olap.PivotFieldEditor;e.setText(o._gDlg,s.dialogHeader);e.setText(o._gHdr,s.header);e.setText(o._gAgg,s.summary);e.setText(o._gShw,s.showAs),e.setText(o._gWfl,s.weighBy);e.setText(o._gSrt,s.sort);e.setText(o._gFlt,s.filter);e.setText(o._gFmt,s.format);e.setText(o._gSmp,s.sample);e.setText(o._btnFltEdt,s.edit);e.setText(o._btnFltClr,s.clear);e.setText(o._btnApply,s.ok);e.setText(o._btnCancel,s.cancel);o._cmbHdr=new e.input.ComboBox(o._dHdr);o._cmbAgg=new e.input.ComboBox(o._dAgg);o._cmbShw=new e.input.ComboBox(o._dShw);o._cmbWFl=new e.input.ComboBox(o._dWFl);o._cmbSrt=new e.input.ComboBox(o._dSrt);o._cmbFmt=new e.input.ComboBox(o._dFmt);o._cmbSmp=new e.input.ComboBox(o._dSmp);o._initAggregateOptions();o._initShowAsOptions();o._initFormatOptions();o._initSortOptions();o._updatePreview();o._cmbShw.textChanged.addHandler(o._updateFormat,o);o._cmbFmt.textChanged.addHandler(o._updatePreview,o);o.addEventListener(o._btnFltEdt,"click",(function(e){o._editFilter();e.preventDefault()}));o.addEventListener(o._btnFltClr,"click",(function(t){o._createFilterEditor();setTimeout((function(){o._eFlt.clearEditor();o._btnFltEdt.focus();e.enable(o._btnFltClr,!1)}));t.preventDefault()}));o.addEventListener(o._btnApply,"click",(function(e){o.updateField()}));o.initialize(n);return o}Object.defineProperty(PivotFieldEditor.prototype,"field",{get:function(){return this._fld},set:function(i){if(i!=this._fld){this._fld=e.asType(i,t.PivotField);this.updateEditor()}},enumerable:!0,configurable:!0});PivotFieldEditor.prototype.updateEditor=function(){if(this._fld){this._dBnd.textContent=this._fld.binding;this._cmbHdr.text=this._fld.header;this._cmbAgg.collectionView.refresh();this._cmbAgg.selectedValue=this._fld.aggregate;this._cmbSrt.selectedValue=this._fld.descending;this._cmbShw.selectedValue=this._fld.showAs;this._initWeighByOptions();e.enable(this._btnFltClr,this._fld.filter.isActive);this._cmbFmt.collectionView.refresh();this._cmbFmt.selectedValue=this._fld.format;this._cmbFmt.selectedValue||(this._cmbFmt.text=this._fld.format);var i=this._fld instanceof t.CubePivotField;this._cmbAgg.isDisabled=i;this._cmbWFl.isDisabled=i}};PivotFieldEditor.prototype.updateField=function(){if(this._fld){var t=this._cmbHdr.text.trim();this._fld.header=t||e.toHeaderCase(this._fld.binding);this._fld.aggregate=this._cmbAgg.selectedValue;this._fld.showAs=this._cmbShw.selectedValue;this._fld.weightField=this._cmbWFl.selectedValue;this._fld.descending=this._cmbSrt.selectedValue;this._eFlt&&this._eFlt.updateFilter();this._fld.format=this._cmbFmt.selectedValue||this._cmbFmt.text}};PivotFieldEditor.prototype._initAggregateOptions=function(){var t=this,i=e.culture.olap.PivotFieldEditor.aggs,n=e.Aggregate,o=[{key:i.sum,val:n.Sum,all:!1},{key:i.cnt,val:n.Cnt,all:!0},{key:i.avg,val:n.Avg,all:!1},{key:i.max,val:n.Max,all:!0},{key:i.min,val:n.Min,all:!0},{key:i.rng,val:n.Rng,all:!1},{key:i.std,val:n.Std,all:!1},{key:i.var,val:n.Var,all:!1},{key:i.stdp,val:n.StdPop,all:!1},{key:i.varp,val:n.VarPop,all:!1},{key:i.first,val:n.First,all:!0},{key:i.last,val:n.Last,all:!0}];this._cmbAgg.itemsSource=o;this._cmbAgg.collectionView.filter=function(i){if(i&&i.all)return!0;if(t._fld){var n=t._fld.dataType;return n==e.DataType.Number||n==e.DataType.Boolean}return!1};this._cmbAgg.initialize({displayMemberPath:"key",selectedValuePath:"val"})};PivotFieldEditor.prototype._initShowAsOptions=function(){var i=e.culture.olap.PivotFieldEditor.calcs,n=[{key:i.noCalc,val:t.ShowAs.NoCalculation},{key:i.dRow,val:t.ShowAs.DiffRow},{key:i.dRowPct,val:t.ShowAs.DiffRowPct},{key:i.dCol,val:t.ShowAs.DiffCol},{key:i.dColPct,val:t.ShowAs.DiffColPct},{key:i.dPctGrand,val:t.ShowAs.PctGrand},{key:i.dPctRow,val:t.ShowAs.PctRow},{key:i.dPrevRow,val:t.ShowAs.PctPrevRow},{key:i.dPctCol,val:t.ShowAs.PctCol},{key:i.dPrevCol,val:t.ShowAs.PctPrevCol},{key:i.dRunTot,val:t.ShowAs.RunTot},{key:i.dRunTotPct,val:t.ShowAs.RunTotPct}];this._cmbShw.itemsSource=n;this._cmbShw.initialize({displayMemberPath:"key",selectedValuePath:"val"})};PivotFieldEditor.prototype._initFormatOptions=function(){var t=this,i=e.culture.olap.PivotFieldEditor.formats,n=[{key:i.n0,val:"n0",all:!0},{key:i.n2,val:"n2",all:!0},{key:i.c,val:"c",all:!0},{key:i.p0,val:"p0",all:!0},{key:i.p2,val:"p2",all:!0},{key:i.n2c,val:"n2,",all:!0},{key:i.n2cc,val:"n2,,",all:!0},{key:i.n2ccc,val:"n2,,,",all:!0},{key:i.d,val:"d",all:!1},{key:i.MMMMddyyyy,val:"MMMM dd, yyyy",all:!1},{key:i.dMyy,val:"d/M/yy",all:!1},{key:i.ddMyy,val:"dd/M/yy",all:!1},{key:i.dMyyyy,val:"dd/M/yyyy",all:!1},{key:i.MMMyyyy,val:"MMM yyyy",all:!1},{key:i.MMMMyyyy,val:"MMMM yyyy",all:!1},{key:i.yyyy,val:"yyyy",all:!1},{key:i.yyyyQq,val:'yyyy "Q"q',all:!1},{key:i.FYEEEEQU,val:'"FY"EEEE "Q"U',all:!1}];this._cmbFmt.itemsSource=n;this._cmbFmt.isEditable=!0;this._cmbFmt.isRequired=!1;this._cmbFmt.collectionView.filter=function(i){return!(!i||!i.all)||!!t._fld&&t._fld.dataType==e.DataType.Date};this._cmbFmt.initialize({displayMemberPath:"key",selectedValuePath:"val"})};PivotFieldEditor.prototype._initWeighByOptions=function(){var t=this,i=[{key:e.culture.olap.PivotFieldEditor.none,val:null}];if(this._fld){this._fld.engine.fields.forEach((function(n){n!=t._fld&&n.dataType==e.DataType.Number&&i.push({key:n.header,val:n})}))}this._cmbWFl.initialize({displayMemberPath:"key",selectedValuePath:"val",itemsSource:i,selectedValue:this._fld.weightField})};PivotFieldEditor.prototype._initSortOptions=function(){var t=e.culture.olap.PivotFieldEditor.sorts,i=[{key:t.asc,val:!1},{key:t.desc,val:!0}];this._cmbSrt.itemsSource=i;this._cmbSrt.initialize({displayMemberPath:"key",selectedValuePath:"val"})};PivotFieldEditor.prototype._updateFormat=function(){switch(this._cmbShw.selectedValue){case t.ShowAs.DiffRowPct:case t.ShowAs.DiffColPct:this._cmbFmt.selectedValue="p0";break;default:this._cmbFmt.selectedValue="n0"}};PivotFieldEditor.prototype._updatePreview=function(){var t=this._cmbFmt.selectedValue||this._cmbFmt.text,i=e.Globalize.format,n="";if(t){var o=t[0].toLowerCase();n="nfgxc".indexOf(o)>-1?i(1234.5678,t):i("p"==o?.12345678:this._pvDate,t)}this._cmbSmp.text=n};PivotFieldEditor.prototype._editFilter=function(){this._createFilterEditor();e.showPopup(this._dFlt,this._btnFltEdt,!1,!1,!1);e.moveFocus(this._dFlt,0)};PivotFieldEditor.prototype._createFilterEditor=function(){var i=this;if(!this._dFlt){this._dFlt=document.createElement("div");this._eFlt=new t.PivotFilterEditor(this._dFlt,this._fld);e.addClass(this._dFlt,"wj-dropdown-panel");this._eFlt.lostFocus.addHandler((function(){setTimeout((function(){var t=e.Control.getControl(i._dFlt);t&&!t.containsFocus()&&i._closeFilter()}),10)}));this._eFlt.finishEditing.addHandler((function(){i._closeFilter();e.enable(i._btnFltClr,!i._eFlt.isEditorClear)}))}};PivotFieldEditor.prototype._closeFilter=function(){if(this._dFlt){e.hidePopup(this._dFlt,!0);this.focus()}};PivotFieldEditor.controlTemplate='<div><div class="wj-dialog-header" tabindex="-1"><span wj-part="g-dlg"></span> <span wj-part="sp-bnd"></span></div><div class="wj-dialog-body"><table style="table-layout:fixed"><tr><td wj-part="g-hdr"></td><td><div wj-part="div-hdr"></div></td></tr><tr class="wj-separator"><td wj-part="g-agg"></td><td><div wj-part="div-agg"></div></td></tr><tr class="wj-separator"><td wj-part="g-shw"></td><td><div wj-part="div-shw"></div></td></tr><tr><td wj-part="g-wfl"></td><td><div wj-part="div-wfl"></div></td></tr><tr><td wj-part="g-srt"></td><td><div wj-part="div-srt"></div></td></tr><tr class="wj-separator"><td wj-part="g-flt"></td><td><div><button wj-part="btn-flt-edt" class="wj-btn"></button>&nbsp;&nbsp;<button wj-part="btn-flt-clr" class="wj-btn"></button></div></td></tr><tr class="wj-separator"><td wj-part="g-fmt"></td><td><div wj-part="div-fmt"></div></td></tr><tr><td wj-part="g-smp"></td><td><div wj-part="div-smp" readonly tabindex="-1"></div></td></tr></table></div><div class="wj-dialog-footer"><button wj-part="btn-apply" class="wj-btn wj-hide"></button>&nbsp;&nbsp;<button wj-part="btn-cancel" class="wj-btn wj-hide"></button></div></div>';return PivotFieldEditor}(e.Control);t.PivotFieldEditor=i}(e.olap||(e.olap={}))}(wijmo||(wijmo={}));!function(e){e.olap||(e.olap={}),e._registerModule("wijmo.olap",e.olap)}(wijmo||(wijmo={}));