/*!
    *
    * Wijmo Library 5.20201.664
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var wijmo,__extends=this&&this.__extends||function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){extendStatics(t,e);function __(){this.constructor=t}t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();!function(t){!function(e){e.softGrid=function softGrid(){return t._getModule("wijmo.grid")};e.softFilter=function softFilter(){return t._getModule("wijmo.grid.filter")}}(t.odata||(t.odata={}))}(wijmo||(wijmo={}));!function(t){!function(e){"use strict";var i=function(i){__extends(ODataCollectionView,i);function ODataCollectionView(e,o,r){var n=i.call(this)||this;n._count=0;n._sortOnServer=!0;n._pageOnServer=!0;n._filterOnServer=!0;n._deferCommits=!1;n._showDatesAsGmt=!1;n._inferDataTypes=!0;n._reviverBnd=n._reviver.bind(n);n.loading=new t.Event;n.loaded=new t.Event;n.error=new t.Event;n._url=t.asString(e,!1);n._tbl=t.asString(o);r&&t.copy(n,r);n.sortDescriptions.collectionChanged.addHandler((function(){n.sortOnServer&&n._getData()}));n._getData();return n}Object.defineProperty(ODataCollectionView.prototype,"tableName",{get:function(){return this._tbl},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"entityType",{get:function(){return this._entityType},set:function(e){this._entityType=t.asString(e)},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"fields",{get:function(){return this._fields},set:function(e){if(this._fields!=e){this._fields=t.asArray(e);this._getData()}},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"requestHeaders",{get:function(){return this._requestHeaders},set:function(t){this._requestHeaders=t},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"keys",{get:function(){return this._keys},set:function(e){this._keys=t.asArray(e)},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"expand",{get:function(){return this._expand},set:function(e){this._expand=t.asString(e)},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"jsonReviver",{get:function(){return this._jsonReviver},set:function(e){this._jsonReviver=t.asFunction(e)},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"dataTypes",{get:function(){return this._dataTypes},set:function(t){this._dataTypes=t},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"inferDataTypes",{get:function(){return this._inferDataTypes},set:function(e){if(e!=this.inferDataTypes){this._inferDataTypes=t.asBoolean(e);this._getData()}},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"showDatesAsGmt",{get:function(){return this._showDatesAsGmt},set:function(e){if(e!=this.showDatesAsGmt){this._showDatesAsGmt=t.asBoolean(e);this._getData()}},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"sortOnServer",{get:function(){return this._sortOnServer},set:function(e){if(e!=this._sortOnServer){this._sortOnServer=t.asBoolean(e);this._getData()}},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"pageOnServer",{get:function(){return this._pageOnServer},set:function(e){if(e!=this._pageOnServer){this._pageOnServer=t.asBoolean(e);this.pageSize&&this._getData()}},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"filterOnServer",{get:function(){return this._filterOnServer},set:function(e){if(e!=this._filterOnServer){this._filterOnServer=t.asBoolean(e);this._getData()}},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"filterDefinition",{get:function(){return this._filterDef},set:function(e){if(e!=this._filterDef){this._filterDef=t.asString(e);this._getData()}},enumerable:!0,configurable:!0});ODataCollectionView.prototype.updateFilterDefinition=function(t){this.filterOnServer&&e.softGrid()&&e.softFilter()&&t instanceof e.softFilter().FlexGridFilter&&(this.filterDefinition=this._asODataFilter(t))};Object.defineProperty(ODataCollectionView.prototype,"oDataVersion",{get:function(){return this._odv},set:function(e){this._odv=t.asNumber(e)},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"deferCommits",{get:function(){return this._deferCommits},set:function(e){this._deferCommits=t.asBoolean(e);this.deferCommits&&(this.trackChanges=!0)},enumerable:!0,configurable:!0});ODataCollectionView.prototype.onLoading=function(t){this.loading.raise(this,t)};ODataCollectionView.prototype.onLoaded=function(t){this.loaded.raise(this,t)};ODataCollectionView.prototype.load=function(){this._getData()};ODataCollectionView.prototype.onError=function(t){this.error.raise(this,t);return!t.cancel};ODataCollectionView.prototype.implementsInterface=function(t){return"IEditableCollectionView"==t?null!=this.keys&&this.keys.length>0:i.prototype.implementsInterface.call(this,t)};ODataCollectionView.prototype.commitNew=function(){var e=this;if(!this.deferCommits){var o={Accept:"application/json"};if(this.requestHeaders)for(var r in this.requestHeaders)o[r]=this.requestHeaders[r];var n=this.currentAddItem;if(n){var a=this._getWriteUrl();t.httpRequest(a,{method:"POST",requestHeaders:o,data:this._convertToDbFormat(n),success:function(t){var i=JSON.parse(t.responseText,e._reviverBnd);e.keys.forEach((function(t){n[t]=i[t]}));e.refresh()},error:this._error.bind(this)})}}i.prototype.commitNew.call(this)};ODataCollectionView.prototype.commitEdit=function(){if(!this.deferCommits){var e=this.currentEditItem;if(e&&!this.currentAddItem&&this._getChangedFields(e,this._edtClone)){var o=this._getWriteUrl(this._edtClone);t.httpRequest(o,{method:"PATCH",requestHeaders:this.requestHeaders,data:this._convertToDbFormat(e),error:this._error.bind(this)})}}i.prototype.commitEdit.call(this)};ODataCollectionView.prototype.remove=function(e){if(!this.deferCommits&&e&&e!=this.currentAddItem&&this.items.indexOf(e)>-1){var o=this._getWriteUrl(e);t.httpRequest(o,{method:"DELETE",requestHeaders:this.requestHeaders,error:this._error.bind(this)})}i.prototype.remove.call(this,e)};ODataCollectionView.prototype.commitChanges=function(e){var i=this;if(this.deferCommits){var o=[];this.itemsEdited.forEach((function(t){o.push({method:"PATCH",url:i._getWriteUrl(t),data:i._convertToDbFormat(t)})}));this.itemsAdded.forEach((function(t){o.push({method:"POST",url:i._getWriteUrl(),data:i._convertToDbFormat(t)})}));this.itemsRemoved.forEach((function(t){o.push({method:"DELETE",url:i._getWriteUrl(t)})}));if(o.length){var r=(new Date).getTime().toString();t.httpRequest(this._getServiceUrl()+"$batch",{method:"POST",requestHeaders:{"Content-Type":'multipart/mixed; boundary="'+r+'"'},data:this._encodeBatch(o,r),success:function(t){i.clearChanges();i.load()},error:function(e){if(i.onError(new t.RequestErrorEventArgs(e)))throw"HttpRequest Error: "+e.status+" "+e.statusText},complete:function(i){t.isFunction(e)&&e(i)}})}}};ODataCollectionView.prototype.cancelChanges=function(){if(this.deferCommits){this.clearChanges();this.load()}};Object.defineProperty(ODataCollectionView.prototype,"totalItemCount",{get:function(){return this._count},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"pageCount",{get:function(){return this.pageSize?Math.ceil(this.totalItemCount/this.pageSize):1},enumerable:!0,configurable:!0});Object.defineProperty(ODataCollectionView.prototype,"pageSize",{get:function(){return this._pgSz},set:function(e){if(e!=this._pgSz){this._pgSz=t.asInt(e);if(this.pageOnServer){this._pgIdx=t.clamp(this._pgIdx,0,this.pageCount-1);this._getData()}else this.refresh()}},enumerable:!0,configurable:!0});ODataCollectionView.prototype.onPageChanging=function(t){i.prototype.onPageChanging.call(this,t);!t.cancel&&this.pageOnServer&&this._getData();return!t.cancel};ODataCollectionView.prototype._getPageView=function(){return this.pageOnServer?this._view:i.prototype._getPageView.call(this)};ODataCollectionView.prototype._performRefresh=function(){var t=this._canFilter,e=this._canSort;this._canFilter=!this._filterOnServer;this._canSort=!this._sortOnServer;i.prototype._performRefresh.call(this);this._canFilter=t;this._canSort=e};ODataCollectionView.prototype._storeItems=function(t,e){e?Array.prototype.push.apply(this.sourceCollection,t):this.sourceCollection=t};ODataCollectionView.prototype._getReadUrl=function(t){var e=this._getServiceUrl();t?e=0==t.indexOf("http")?t:e+t:this._tbl&&(e+=this._tbl);return e};ODataCollectionView.prototype._getReadParams=function(t){var e={};(!t||t.indexOf("$format")<0)&&(e.$format="json");if(!t&&this._tbl){this._odv<4?e.$inlinecount="allpages":e.$count=!0;this.fields&&(e.$select=this.fields.join(","));this.expand&&(e.$expand=this.expand);if(this.sortOnServer&&this.sortDescriptions.length){var i="";this.sortDescriptions.forEach((function(t){i&&(i+=",");i+=t.property;t.ascending||(i+=" desc")}));e.$orderby=i}if(this.pageOnServer&&this.pageSize>0){e.$skip=this.pageIndex*this.pageSize;e.$top=this.pageSize}this.filterDefinition&&(e.$filter=this._encodeFilterDefinition())}return e};ODataCollectionView.prototype._encodeFilterDefinition=function(){return this.filterDefinition.replace(/%/g,"%25").replace(/\+/g,"%2B").replace(/\//g,"%2F").replace(/\?/g,"%3F").replace(/#/g,"%23").replace(/&/g,"%26")};ODataCollectionView.prototype._getData=function(e,i){var o=this;this._toGetData&&clearTimeout(this._toGetData);this._toGetData=setTimeout((function(){if(null!=o._odv){o._loading=!0;o.onLoading();var r=t.httpRequest(o._getReadUrl(e),{requestHeaders:o.requestHeaders,data:o._getReadParams(e),success:function(t){var i=JSON.parse(t.responseText,o._reviverBnd),r=i.d?i.d.results:i.value,n=i.d?i.d.__count:i["odata.count"]||i["@odata.count"];null!=n&&(o._count=parseInt(n));if(o.pageIndex>0&&o.pageIndex>=o.pageCount){var a=o.pageIndex;o.moveToLastPage();if(o.pageIndex!=a)return}e||o.inferDataTypes&&!o._dataTypesInferred&&(o._dataTypesInferred=o._getInferredDataTypes(r));var s=o.dataTypes?o.dataTypes:o._dataTypesInferred;s&&r.forEach((function(t){o._convertItem(s,t)}));o._storeItems(r,null!=e);o.refresh();if(e=i.d?i.d.__next:i["odata.nextLink"]||i["@odata.nextLink"])o._getData(e);else{o._loading=!1;o.onLoaded()}},error:function(e){o._loading=!1;o.onLoaded();if(o.onError(new t.RequestErrorEventArgs(e)))throw"HttpRequest Error: "+e.status+" "+e.statusText}});t.isFunction(i)&&i(r)}else o._getSchema()}),100)};ODataCollectionView.prototype._convertToDbFormat=function(e){var i={};for(var o in e){var r=e[o];t.isDate(r)&&this._showDatesAsGmt?r=new Date(r.getTime()-6e4*r.getTimezoneOffset()):t.isNumber(r)&&this._odv<4&&(r=r.toString());i[o]=r}this.entityType&&(i["odata.type"]=this.entityType);return i};ODataCollectionView.prototype._reviver=function(e,i){if("string"==typeof i&&ODataCollectionView._rxDate.test(i)){i=0==i.indexOf("/Date(")?new Date(parseInt(i.substr(6))):new Date(i);t.isDate(i)&&this._showDatesAsGmt&&(i=new Date(i.getTime()+6e4*i.getTimezoneOffset()))}return this._jsonReviver?this._jsonReviver(e,i):i};ODataCollectionView.prototype._convertItem=function(e,i){for(var o in e){var r=e[o],n=i[o];if(null!=n){n=r==t.DataType.Date&&t.isString(n)&&0==n.indexOf("/Date(")?new Date(parseInt(n.substr(6))):t.changeType(n,r,null);t.isDate(n)&&this._showDatesAsGmt&&(n=new Date(n.getTime()+6e4*n.getTimezoneOffset()));i[o]=n}}};ODataCollectionView.prototype._getInferredDataTypes=function(e){var i=this,o=null;if(e.length>0){var r={};e.forEach((function(t){i._extend(r,t)}));for(var n in r){var a=r[n];if(t.isString(a)&&ODataCollectionView._rxDate.test(a)){o||(o={});o[n]=t.DataType.Date}}}return o};ODataCollectionView.prototype._getServiceUrl=function(){var t=this._url;"/"!=t[t.length-1]&&(t+="/");return t};ODataCollectionView.prototype._getSchema=function(){var e=this,i=this._getServiceUrl()+"$metadata",o=ODataCollectionView._odvCache;this._odv=o[i];this._odv?this._getData():t.httpRequest(i,{requestHeaders:this.requestHeaders,success:function(t){var r=t.responseText.match(/<.*Version\s*=\s*"([0-9.]+)"/),n=r?parseFloat(r[1]):4;o[i]=e._odv=n},error:function(t){o[i]=e._odv=4},complete:function(t){e._getData()}})};ODataCollectionView.prototype._getWriteUrl=function(e){var i=this,o=this._getServiceUrl()+this._tbl;if(e){t.assert(this.keys&&this.keys.length>0,"write operations require keys.");var r=[];this.keys.forEach((function(o){var n=e[o];null==n&&(n="");t.isString(n)&&(n="'"+n+"'");r.push(1==i.keys.length?n:o+"="+n)}));r.length&&(o+="("+r.join(",")+")")}return o};ODataCollectionView.prototype._asODataFilter=function(t){for(var e="",i=0;i<t.grid.columns.length;i++){var o=t.grid.columns[i],r=t.getColumnFilter(o,!1);if(r&&r.isActive){e&&(e+=" and ");r.conditionFilter&&r.conditionFilter.isActive?e+=this._asODataConditionFilter(r.conditionFilter):r.valueFilter&&r.valueFilter.isActive&&(e+=this._asODataValueFilter(r.valueFilter))}}return e};ODataCollectionView.prototype._asODataValueFilter=function(e){var i=e.column,o=i.binding,r=i.dataMap,n="";for(var a in e.showValues){var s=t.changeType(a,i.dataType,i.format);r&&t.isString(s)&&(s=r.getKeyValue(s));n&&(n+=" or ");n+=this._asEquals(o,s,i.dataType)}n.length&&(n="("+n+")");return n};ODataCollectionView.prototype._asEquals=function(e,i,o){return o==t.DataType.Date?"("+e+" ge "+this._asODataValue(i,o)+" and "+e+" lt "+this._asODataValue(t.DateTime.addDays(i,1),o)+")":""==i?"("+e+" eq null or "+e+" eq '')":"("+e+" eq "+this._asODataValue(i,o)+")"};ODataCollectionView.prototype._asODataConditionFilter=function(t){var e=this._asODataCondition(t,t.condition1),i=this._asODataCondition(t,t.condition2);return e&&i?"("+e+(t.and?" and ":" or ")+i+")":e?"("+e+")":i?"("+i+")":null};ODataCollectionView.prototype._asODataCondition=function(t,e){var i=t.column.binding,o=this._asODataValue(e.value,t.column.dataType);switch(e.operator){case 0:return this._asEquals(i,e.value,t.column.dataType);case 1:return i+" ne "+o;case 2:return i+" gt "+o;case 3:return i+" ge "+o;case 4:return i+" lt "+o;case 5:return i+" le "+o;case 6:return"startswith("+i+","+o+")";case 7:return"endswith("+i+","+o+")";case 8:return this._odv>=4?"contains("+i+","+o+")":"substringof("+o.toLowerCase()+", tolower("+i+"))";case 9:return this._odv>=4?"not contains("+i+","+o+")":"not substringof("+o.toLowerCase()+", tolower("+i+"))"}};ODataCollectionView.prototype._asODataValue=function(e,i){if(t.isDate(e)){this._showDatesAsGmt&&(e=new Date(e.getTime()-6e4*e.getTimezoneOffset()));e=e.toJSON();this._odv<4&&(e="datetime'"+e.substr(0,10)+"'");return e}return t.isString(e)?"'"+e.replace(/'/g,"''")+"'":null!=e?e.toString():i==t.DataType.String?"''":null};ODataCollectionView.prototype._error=function(e){if(this.onError(new t.RequestErrorEventArgs(e))){this._getData();throw"HttpRequest Error: "+e.status+" "+e.statusText}};ODataCollectionView.prototype._encodeBatch=function(t,e){var i=[],o="changeset-"+e;i.push("--"+e,"Content-Type: multipart/mixed; boundary="+o,"");t.forEach((function(t,e){i.push("--"+o,"Content-Type: application/http","Content-Transfer-Encoding: binary","Content-ID: "+e,"",t.method.toUpperCase()+" "+t.url+" HTTP/1.1","Host: "+location.host);t.data&&i.push("Content-Type: application/json","",JSON.stringify(t.data));i.push("")}));i.push("--"+o+"--","");i.push("--"+e+"--","");return i.join("\r\n")};ODataCollectionView._odvCache={};ODataCollectionView._rxDate=/^\d{4}\-\d{2}\-\d{2}T\d{2}\:\d{2}\:\d{2}|\/Date\([\d\-]*?\)/;return ODataCollectionView}(t.collections.CollectionView);e.ODataCollectionView=i}(t.odata||(t.odata={}))}(wijmo||(wijmo={}));!function(t){!function(e){"use strict";var i=function(e){__extends(ODataVirtualCollectionView,e);function ODataVirtualCollectionView(t,i,o){var r=this;null==o&&(o={});o.pageOnServer=!0;o.sortOnServer=!0;o.canGroup=!1;o.pageSize||(o.pageSize=100);(r=e.call(this,t,i,o)||this)._data=[];r.sourceCollection=r._data;r._skip=0;r.setWindow(0,r.pageSize);return r}ODataVirtualCollectionView.prototype.setWindow=function(t,e){var i=this;this._toSetWindow&&clearTimeout(this._toSetWindow);this._toSetWindow=setTimeout((function(){i._toSetWindow=null;i._performSetWindow(t,e)}),50)};Object.defineProperty(ODataVirtualCollectionView.prototype,"requestCanceled",{get:function(){this._requestCanceled||(this._requestCanceled=new t.Event);return this._requestCanceled},enumerable:!0,configurable:!0});ODataVirtualCollectionView.prototype.onRequestCanceled=function(t){this.requestCanceled.raise(this,t)};Object.defineProperty(ODataVirtualCollectionView.prototype,"pageOnServer",{get:function(){return!0},set:function(t){if(!t)throw"ODataVirtualCollectionView requires pageOnServer = true."},enumerable:!0,configurable:!0});Object.defineProperty(ODataVirtualCollectionView.prototype,"sortOnServer",{get:function(){return!0},set:function(e){if(!t.asBoolean(e))throw"ODataVirtualCollectionView requires sortOnServer = true."},enumerable:!0,configurable:!0});Object.defineProperty(ODataVirtualCollectionView.prototype,"filterOnServer",{get:function(){return!0},set:function(e){if(!t.asBoolean(e))throw"ODataVirtualCollectionView requires filterOnServer = true."},enumerable:!0,configurable:!0});Object.defineProperty(ODataVirtualCollectionView.prototype,"canGroup",{get:function(){return this._canGroup},set:function(e){if(t.asBoolean(e))throw"ODataVirtualCollectionView does not support grouping."},enumerable:!0,configurable:!0});ODataVirtualCollectionView.prototype._performRefresh=function(){this.isLoading||(this._refresh=!0);e.prototype._performRefresh.call(this)};ODataVirtualCollectionView.prototype._getReadParams=function(t){var i=e.prototype._getReadParams.call(this,t);if(!t){i.$skip=this._skip||0;i.$top=this.pageSize}return i};ODataVirtualCollectionView.prototype._storeItems=function(t,e){if(this._refresh||this._data.length!=this.totalItemCount){this._data.length=this.totalItemCount;for(var i=0;i<this._data.length;i++)this._data[i]=null;this._refresh=!1}if(!e){this.currentPosition<0&&this.moveCurrentToFirst();this._loadOffset=0}var o=this._loadOffset+(this._skip||0);for(i=0;i<t.length;i++)this._data[i+o]=t[i];this._loadOffset+=t.length};ODataVirtualCollectionView.prototype._performSetWindow=function(e,i){var o=this;if(this._pendingRequest){this._pendingRequest.abort();this._pendingRequest=null;this.onRequestCanceled()}e=t.asInt(e);i=t.asInt(i);t.assert(i>=e,"Start must be smaller than end.");var r=t.isNumber(this._start)&&e>this._start;this._start=e;this._end=i;for(var n=!1,a=e;a<i&&a<this._data.length&&!n;a++)n=null==this._data[a];if(n){var s=Math.max(0,r?e:i-this.pageSize);for(a=s;a<this._data.length&&null!=this._data[a];a++)s++;this._skip=s;this._getData(null,(function(t){o._pendingRequest=t}))}};return ODataVirtualCollectionView}(e.ODataCollectionView);e.ODataVirtualCollectionView=i}(t.odata||(t.odata={}))}(wijmo||(wijmo={}));!function(t){t.odata||(t.odata={}),t._registerModule("wijmo.odata",t.odata)}(wijmo||(wijmo={}));