/*!
    *
    * Wijmo Library 5.20201.664
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var wijmo,__extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();!function(e){!function(t){!function(t){"use strict";var r=function(t){__extends(GroupPanel,t);function GroupPanel(r,i){var n=t.call(this,r)||this;n._hideGroupedCols=!0;n._showDragGlyphs=!0;n._maxGroups=6;n._hiddenCols=[];var o=n.getTemplate();n.applyTemplate("wj-grouppanel wj-control",o,{_divMarkers:"div-markers",_divPH:"div-ph"});e.setCss(n._divMarkers.parentElement,{width:"100%",height:"100%",minHeight:"1em",overflow:"hidden",cursor:"default"});var l=n.hostElement;n.addEventListener(l,"dragstart",n._dragStart.bind(n));n.addEventListener(l,"dragover",n._dragOver.bind(n));n.addEventListener(l,"drop",n._drop.bind(n));n.addEventListener(l,"dragend",n._dragEnd.bind(n));n.addEventListener(l,"click",n._click.bind(n));n.initialize(i);return n}Object.defineProperty(GroupPanel.prototype,"hideGroupedColumns",{get:function(){return this._hideGroupedCols},set:function(t){t!=this._hideGroupedCols&&(this._hideGroupedCols=e.asBoolean(t))},enumerable:!0,configurable:!0});Object.defineProperty(GroupPanel.prototype,"showDragGlyphs",{get:function(){return this._showDragGlyphs},set:function(t){if(t!=this._showDragGlyphs){this._showDragGlyphs=e.asBoolean(t);this.refresh()}},enumerable:!0,configurable:!0});Object.defineProperty(GroupPanel.prototype,"maxGroups",{get:function(){return this._maxGroups},set:function(t){if(t!=this._maxGroups){this._maxGroups=e.asNumber(t);var r=this._gds,i=this._maxGroups;r&&i>-1&&i<r.length&&r.splice(i,r.length-i)}},enumerable:!0,configurable:!0});Object.defineProperty(GroupPanel.prototype,"placeholder",{get:function(){return this._divPH.textContent},set:function(e){this._divPH.textContent=e},enumerable:!0,configurable:!0});Object.defineProperty(GroupPanel.prototype,"grid",{get:function(){return this._g},set:function(t){if((t=e.asType(t,e.grid.FlexGrid,!0))!=this._g){var r=this._g;if(r){r.draggingColumn.removeHandler(this._draggingColumn);r.itemsSourceChanging.removeHandler(this._itemsSourceChanging);r.itemsSourceChanged.removeHandler(this._itemsSourceChanged);r.columns.collectionChanged.removeHandler(this._itemsSourceChanged)}r=this._g=t;this._hiddenCols=[];if(r){r.draggingColumn.addHandler(this._draggingColumn,this);r.itemsSourceChanging.addHandler(this._itemsSourceChanging,this);r.itemsSourceChanged.addHandler(this._itemsSourceChanged,this);r.columns.collectionChanged.addHandler(this._itemsSourceChanged,this)}this._itemsSourceChanged(r,null)}},enumerable:!0,configurable:!0});Object.defineProperty(GroupPanel.prototype,"filter",{get:function(){return this._filter},set:function(t){if((t=e.asType(t,e.grid.filter.FlexGridFilter,!0))!=this._filter){var r=this._filter;r&&r.filterApplied.removeHandler(this.refresh,this);(r=this._filter=t)&&r.filterApplied.addHandler(this.refresh,this);this.refresh()}},enumerable:!0,configurable:!0});Object.defineProperty(GroupPanel.prototype,"groupDescriptionCreator",{get:function(){return this._gdc},set:function(e){this._gdc=e},enumerable:!0,configurable:!0});GroupPanel.prototype.refresh=function(){t.prototype.refresh.call(this);this._divMarkers.innerHTML="";this._dragMarker=this._dragCol=null;if(this._gds){for(var r=this._g,i=r.columnHeaders,n=0;n<this._gds.length;n++){var o=this._gds[n],l=-1,s=-1;if(o instanceof e.collections.PropertyGroupDescription)for(var a=i.rows.length-1;a>=0&&s<0;a--)for(var d=0;d<i.columns.length&&s<0;d++){var p=r._getBindingColumn(i,a,i.columns[d]);if(p&&p.binding==o.propertyName){s=d;l=a;break}}if(s>-1&&l>-1){var h=document.createElement("div");r.cellFactory.updateCell(this._g.columnHeaders,l,s,h);h.setAttribute("class","wj-cell wj-header wj-groupmarker");e.setCss(h,{position:"static",display:"inline-block",verticalAlign:"top",left:"",right:"",top:"",width:"",height:"",paddingLeft:"",paddingRight:""});e.removeChild(h.querySelector(".wj-elem-filter"));e.removeChild(h.querySelector(".wj-column-selector"));if(this.showDragGlyphs){var u=e.createElement('<span class="wj-glyph-drag"></span>');h.insertBefore(u,h.firstChild)}var g=r._getBindingColumn(i,l,i.columns[s]),c=this._getColumnFilter(g);if(c){var _=e.createElement('<span class="wj-filter wj-glyph-filter"></span>',h);e.toggleClass(_,"wj-filter-on",c.isActive);e.toggleClass(_,"wj-filter-off",!c.isActive)}e.createElement('<span class="wj-remove">&times;</span>',h);this._divMarkers.appendChild(h)}}var f=this._divMarkers.children.length>0;this._divPH.style.display=f?"none":"";this._divMarkers.style.display=f?"":"none"}};GroupPanel.prototype._getColumnFilter=function(e){var t=this._filter,r=null;t&&(r=t.filterColumns&&t.filterColumns.indexOf(e.binding)<0?null:t.getColumnFilter(e));return r};GroupPanel.prototype._editFilter=function(t){var r=this._gds,i=this._getElementIndex(t),n=r&&i>-1?r[i]:null,o=n instanceof e.collections.PropertyGroupDescription?n.propertyName:null,l=o?this._g.getColumn(o):null;l&&this._filter.editColumnFilter(l,null,t)};GroupPanel.prototype._addGroup=function(t,r){for(var i=this._getIndex(r),n=this._gds,o=this._maxGroups,l=0;l<n.length;l++){var s=n[l];if(s instanceof e.collections.PropertyGroupDescription&&s.propertyName==t.binding){n.removeAt(l);l<i&&i--;break}}if(o>-1)for(l=o-1;l<n.length;l++){this._removeGroup(l,n);l<i&&i--}if(o<0||n.length<o){var a=this._gdc?this._gdc(t.binding):null;a||(a=new e.collections.PropertyGroupDescription(t.binding));n.insert(i,a);if(t&&this.hideGroupedColumns){t.visible=!1;this._hiddenCols.push(t)}}};GroupPanel.prototype._moveGroup=function(e,t){var r=this._gds,i=this._getElementIndex(this._dragMarker),n=this._getIndex(t);n>i&&n--;n>=this._gds.length&&(n=this._gds.length);i!=n&&r.deferUpdate((function(){var e=r[i];r.removeAt(i);r.insert(n,e)}))};GroupPanel.prototype._removeGroup=function(e,t){void 0===t&&(t=this._gds);var r=null;if(t&&e>-1){r=t[e];t.removeAt(e)}var i=r?r.propertyName:null,n=i?this._g.columns.getColumn(i):null;if(n){n.visible=!0;var o=this._hiddenCols.indexOf(n);o>-1&&this._hiddenCols.splice(o,1)}};GroupPanel.prototype._getIndex=function(e){for(var t=e.clientX,r=this._divMarkers.children,i=0;i<r.length;i++){var n=r[i].getBoundingClientRect();if((t-n.left)*(t-n.right)<0)return i}return r.length};GroupPanel.prototype._getElementIndex=function(e){if(e&&e.parentElement)for(var t=e.parentElement.children,r=0;r<t.length;r++)if(t[r]==e)return r;return-1};GroupPanel.prototype._draggingColumn=function(e,t){var r=this._g,i=r._getBindingColumn(t.panel,t.row,r.columns[t.col]);this._dragCol=i.binding?i:null};GroupPanel.prototype._itemsSourceChanging=function(e,t){this._hiddenCols.forEach((function(e){e.visible=!0}));this._hiddenCols=[]};GroupPanel.prototype._itemsSourceChanged=function(e,t){this._view&&this._view.collectionChanged.removeHandler(this._collectionChanged);this._view=this._g?this._g.collectionView:null;this._gds=this._view?this._view.groupDescriptions:null;this._view&&this._view.collectionChanged.addHandler(this._collectionChanged,this);this.invalidate()};GroupPanel.prototype._collectionChanged=function(t,r){r.action==e.collections.NotifyCollectionChangedAction.Reset&&this.invalidate()};GroupPanel.prototype._dragStart=function(t){e._startDrag(t.dataTransfer,"move");this._dragMarker=t.target;this._dragCol=null};GroupPanel.prototype._dragOver=function(e){if(this._dragCol||this._dragMarker){e.dataTransfer.dropEffect="move";e.preventDefault();e.stopPropagation()}};GroupPanel.prototype._drop=function(e){this._dragMarker?this._moveGroup(this._dragMarker,e):this._dragCol&&this._addGroup(this._dragCol,e)};GroupPanel.prototype._dragEnd=function(e){this._dragMarker=this._dragCol=null};GroupPanel.prototype._click=function(t){var r=t.target,i=e.hasClass(r,"wj-remove"),n=e.hasClass(r,"wj-filter"),o=e.closest(r,".wj-cell");if(e.hasClass(o,"wj-cell"))if(n)this._editFilter(o);else if(i){var l=this._getElementIndex(o);this._removeGroup(l)}else this._updateSort(t,o)};GroupPanel.prototype._updateSort=function(t,r){for(var i=this,n=this._getElementIndex(r),o=this._gds[n],l=o instanceof e.collections.PropertyGroupDescription?o.propertyName:null,s=-1,a=this._g.collectionView.sortDescriptions,d=t.ctrlKey||t.metaKey,p=t.shiftKey,h=0;h<a.length;h++)if(a[h].property==l){s=h;break}a.deferUpdate((function(){if(d&&p)a.clear();else if(s<0){i._g.allowSorting!=e.grid.AllowSorting.MultiColumn&&a.clear();var t=new e.collections.SortDescription(l,!0);a.push(t)}else if(d)a.splice(s,1);else{t=new e.collections.SortDescription(l,!a[s].ascending);a.splice(s,1,t)}}))};GroupPanel.controlTemplate='<div><div wj-part="div-ph"></div><div wj-part="div-markers"></div></div>';return GroupPanel}(e.Control);t.GroupPanel=r}(t.grouppanel||(t.grouppanel={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));!function(e){!function(t){t.grouppanel||(t.grouppanel={}),e._registerModule("wijmo.grid.grouppanel",e.grid.grouppanel)}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));